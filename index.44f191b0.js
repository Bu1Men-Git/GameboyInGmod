function e(e){return e&&e.__esModule?e.default:e}var t,r,i,n,s,a,o=globalThis,h={},c={},u=o.parcelRequire8f79;null==u&&((u=function(e){if(e in h)return h[e].exports;if(e in c){var t=c[e];delete c[e];var r={id:e,exports:{}};return h[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){c[e]=t},o.parcelRequire8f79=u);var l=u.register;l("gOdab",function(e,t){//Dump of the post-BOOT I/O register state (From gambatte):
e.exports=[15,0,124,255,0,0,0,248,255,255,255,255,255,255,255,1,128,191,243,255,191,255,63,0,255,191,127,255,159,255,191,255,255,0,0,191,119,243,241,255,255,255,255,255,255,255,255,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,145,128,0,0,0,0,0,252,0,0,0,0,255,126,255,254,255,255,255,255,255,255,62,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,192,255,193,0,254,255,255,255,248,255,0,0,0,143,0,0,255,255,255,255,255,255,255,255,206,237,102,102,204,13,0,11,3,115,0,131,0,12,0,13,0,8,17,31,136,137,0,14,220,204,110,230,221,221,217,153,187,187,103,99,110,14,236,204,221,220,153,159,187,185,51,62,69,236,82,250,8,183,7,93,1,253,192,255,8,252,0,229,11,248,194,206,244,249,15,127,69,109,61,254,70,151,51,94,8,239,241,255,134,131,36,116,18,252,0,159,180,183,6,213,208,122,0,158,4,95,65,47,29,119,54,117,129,170,112,58,152,209,113,2,77,1,193,255,13,0,211,5,249,0,11,0]}),l("kE7dz",function(e,t){var r=[//NOP
//#0x00:
function(e){//Do Nothing...
},//LD BC, nn
//#0x01:
function(e){e.registerC=e.memoryReader[e.programCounter](e,e.programCounter),e.registerB=e.memoryRead(e.programCounter+1&65535),e.programCounter=e.programCounter+2&65535},//LD (BC), A
//#0x02:
function(e){e.memoryWrite(e.registerB<<8|e.registerC,e.registerA)},//INC BC
//#0x03:
function(e){var t=(e.registerB<<8|e.registerC)+1;e.registerB=t>>8&255,e.registerC=255&t},//INC B
//#0x04:
function(e){e.registerB=e.registerB+1&255,e.FZero=0==e.registerB,e.FHalfCarry=(15&e.registerB)==0,e.FSubtract=!1},//DEC B
//#0x05:
function(e){e.registerB=e.registerB-1&255,e.FZero=0==e.registerB,e.FHalfCarry=(15&e.registerB)==15,e.FSubtract=!0},//LD B, n
//#0x06:
function(e){e.registerB=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//RLCA
//#0x07:
function(e){e.FCarry=e.registerA>127,e.registerA=e.registerA<<1&255|e.registerA>>7,e.FZero=e.FSubtract=e.FHalfCarry=!1},//LD (nn), SP
//#0x08:
function(e){var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.memoryWrite(t,255&e.stackPointer),e.memoryWrite(t+1&65535,e.stackPointer>>8)},//ADD HL, BC
//#0x09:
function(e){var t=e.registersHL+(e.registerB<<8|e.registerC);e.FHalfCarry=(4095&e.registersHL)>(4095&t),e.FCarry=t>65535,e.registersHL=65535&t,e.FSubtract=!1},//LD A, (BC)
//#0x0A:
function(e){e.registerA=e.memoryRead(e.registerB<<8|e.registerC)},//DEC BC
//#0x0B:
function(e){var t=(e.registerB<<8|e.registerC)-1&65535;e.registerB=t>>8,e.registerC=255&t},//INC C
//#0x0C:
function(e){e.registerC=e.registerC+1&255,e.FZero=0==e.registerC,e.FHalfCarry=(15&e.registerC)==0,e.FSubtract=!1},//DEC C
//#0x0D:
function(e){e.registerC=e.registerC-1&255,e.FZero=0==e.registerC,e.FHalfCarry=(15&e.registerC)==15,e.FSubtract=!0},//LD C, n
//#0x0E:
function(e){e.registerC=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//RRCA
//#0x0F:
function(e){e.registerA=e.registerA>>1|(1&e.registerA)<<7,e.FCarry=e.registerA>127,e.FZero=e.FSubtract=e.FHalfCarry=!1},//STOP
//#0x10:
function(e){e.cGBC&&(1&e.memory[65357])==1?(e.memory[65357]>127?(// console.log("Going into single clock speed mode.", 0);
e.doubleSpeedShifter=0,e.memory[65357]&=127):(// console.log("Going into double clock speed mode.", 0);
e.doubleSpeedShifter=1,e.memory[65357]|=128),e.memory[65357]&=254):e.handleSTOP()},//LD DE, nn
//#0x11:
function(e){e.registerE=e.memoryReader[e.programCounter](e,e.programCounter),e.registerD=e.memoryRead(e.programCounter+1&65535),e.programCounter=e.programCounter+2&65535},//LD (DE), A
//#0x12:
function(e){e.memoryWrite(e.registerD<<8|e.registerE,e.registerA)},//INC DE
//#0x13:
function(e){var t=(e.registerD<<8|e.registerE)+1;e.registerD=t>>8&255,e.registerE=255&t},//INC D
//#0x14:
function(e){e.registerD=e.registerD+1&255,e.FZero=0==e.registerD,e.FHalfCarry=(15&e.registerD)==0,e.FSubtract=!1},//DEC D
//#0x15:
function(e){e.registerD=e.registerD-1&255,e.FZero=0==e.registerD,e.FHalfCarry=(15&e.registerD)==15,e.FSubtract=!0},//LD D, n
//#0x16:
function(e){e.registerD=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//RLA
//#0x17:
function(e){var t=e.FCarry?1:0;e.FCarry=e.registerA>127,e.registerA=e.registerA<<1&255|t,e.FZero=e.FSubtract=e.FHalfCarry=!1},//JR n
//#0x18:
function(e){e.programCounter=e.programCounter+(e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24)+1&65535},//ADD HL, DE
//#0x19:
function(e){var t=e.registersHL+(e.registerD<<8|e.registerE);e.FHalfCarry=(4095&e.registersHL)>(4095&t),e.FCarry=t>65535,e.registersHL=65535&t,e.FSubtract=!1},//LD A, (DE)
//#0x1A:
function(e){e.registerA=e.memoryRead(e.registerD<<8|e.registerE)},//DEC DE
//#0x1B:
function(e){var t=(e.registerD<<8|e.registerE)-1&65535;e.registerD=t>>8,e.registerE=255&t},//INC E
//#0x1C:
function(e){e.registerE=e.registerE+1&255,e.FZero=0==e.registerE,e.FHalfCarry=(15&e.registerE)==0,e.FSubtract=!1},//DEC E
//#0x1D:
function(e){e.registerE=e.registerE-1&255,e.FZero=0==e.registerE,e.FHalfCarry=(15&e.registerE)==15,e.FSubtract=!0},//LD E, n
//#0x1E:
function(e){e.registerE=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//RRA
//#0x1F:
function(e){var t=e.FCarry?128:0;e.FCarry=(1&e.registerA)==1,e.registerA=e.registerA>>1|t,e.FZero=e.FSubtract=e.FHalfCarry=!1},//JR NZ, n
//#0x20:
function(e){e.FZero?e.programCounter=e.programCounter+1&65535:(e.programCounter=e.programCounter+(e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24)+1&65535,e.CPUTicks+=4)},//LD HL, nn
//#0x21:
function(e){e.registersHL=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+2&65535},//LDI (HL), A
//#0x22:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerA),e.registersHL=e.registersHL+1&65535},//INC HL
//#0x23:
function(e){e.registersHL=e.registersHL+1&65535},//INC H
//#0x24:
function(e){var t=(e.registersHL>>8)+1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==0,e.FSubtract=!1,e.registersHL=t<<8|255&e.registersHL},//DEC H
//#0x25:
function(e){var t=(e.registersHL>>8)-1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==15,e.FSubtract=!0,e.registersHL=t<<8|255&e.registersHL},//LD H, n
//#0x26:
function(e){e.registersHL=e.memoryReader[e.programCounter](e,e.programCounter)<<8|255&e.registersHL,e.programCounter=e.programCounter+1&65535},//DAA
//#0x27:
function(e){e.FSubtract?e.FCarry&&e.FHalfCarry?(e.registerA=e.registerA+154&255,e.FHalfCarry=!1):e.FCarry?e.registerA=e.registerA+160&255:e.FHalfCarry&&(e.registerA=e.registerA+250&255,e.FHalfCarry=!1):((e.FCarry||e.registerA>153)&&(e.registerA=e.registerA+96&255,e.FCarry=!0),(e.FHalfCarry||(15&e.registerA)>9)&&(e.registerA=e.registerA+6&255,e.FHalfCarry=!1)),e.FZero=0==e.registerA},//JR Z, n
//#0x28:
function(e){e.FZero?(e.programCounter=e.programCounter+(e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24)+1&65535,e.CPUTicks+=4):e.programCounter=e.programCounter+1&65535},//ADD HL, HL
//#0x29:
function(e){e.FHalfCarry=(4095&e.registersHL)>2047,e.FCarry=e.registersHL>32767,e.registersHL=e.registersHL<<1&65535,e.FSubtract=!1},//LDI A, (HL)
//#0x2A:
function(e){e.registerA=e.memoryReader[e.registersHL](e,e.registersHL),e.registersHL=e.registersHL+1&65535},//DEC HL
//#0x2B:
function(e){e.registersHL=e.registersHL-1&65535},//INC L
//#0x2C:
function(e){var t=e.registersHL+1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==0,e.FSubtract=!1,e.registersHL=65280&e.registersHL|t},//DEC L
//#0x2D:
function(e){var t=e.registersHL-1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==15,e.FSubtract=!0,e.registersHL=65280&e.registersHL|t},//LD L, n
//#0x2E:
function(e){e.registersHL=65280&e.registersHL|e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//CPL
//#0x2F:
function(e){e.registerA^=255,e.FSubtract=e.FHalfCarry=!0},//JR NC, n
//#0x30:
function(e){e.FCarry?e.programCounter=e.programCounter+1&65535:(e.programCounter=e.programCounter+(e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24)+1&65535,e.CPUTicks+=4)},//LD SP, nn
//#0x31:
function(e){e.stackPointer=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+2&65535},//LDD (HL), A
//#0x32:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerA),e.registersHL=e.registersHL-1&65535},//INC SP
//#0x33:
function(e){e.stackPointer=e.stackPointer+1&65535},//INC (HL)
//#0x34:
function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL)+1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==0,e.FSubtract=!1,e.memoryWriter[e.registersHL](e,e.registersHL,t)},//DEC (HL)
//#0x35:
function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL)-1&255;e.FZero=0==t,e.FHalfCarry=(15&t)==15,e.FSubtract=!0,e.memoryWriter[e.registersHL](e,e.registersHL,t)},//LD (HL), n
//#0x36:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.memoryReader[e.programCounter](e,e.programCounter)),e.programCounter=e.programCounter+1&65535},//SCF
//#0x37:
function(e){e.FCarry=!0,e.FSubtract=e.FHalfCarry=!1},//JR C, n
//#0x38:
function(e){e.FCarry?(e.programCounter=e.programCounter+(e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24)+1&65535,e.CPUTicks+=4):e.programCounter=e.programCounter+1&65535},//ADD HL, SP
//#0x39:
function(e){var t=e.registersHL+e.stackPointer;e.FHalfCarry=(4095&e.registersHL)>(4095&t),e.FCarry=t>65535,e.registersHL=65535&t,e.FSubtract=!1},//LDD A, (HL)
//#0x3A:
function(e){e.registerA=e.memoryReader[e.registersHL](e,e.registersHL),e.registersHL=e.registersHL-1&65535},//DEC SP
//#0x3B:
function(e){e.stackPointer=e.stackPointer-1&65535},//INC A
//#0x3C:
function(e){e.registerA=e.registerA+1&255,e.FZero=0==e.registerA,e.FHalfCarry=(15&e.registerA)==0,e.FSubtract=!1},//DEC A
//#0x3D:
function(e){e.registerA=e.registerA-1&255,e.FZero=0==e.registerA,e.FHalfCarry=(15&e.registerA)==15,e.FSubtract=!0},//LD A, n
//#0x3E:
function(e){e.registerA=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535},//CCF
//#0x3F:
function(e){e.FCarry=!e.FCarry,e.FSubtract=e.FHalfCarry=!1},//LD B, B
//#0x40:
function(e){//Do nothing...
},//LD B, C
//#0x41:
function(e){e.registerB=e.registerC},//LD B, D
//#0x42:
function(e){e.registerB=e.registerD},//LD B, E
//#0x43:
function(e){e.registerB=e.registerE},//LD B, H
//#0x44:
function(e){e.registerB=e.registersHL>>8},//LD B, L
//#0x45:
function(e){e.registerB=255&e.registersHL},//LD B, (HL)
//#0x46:
function(e){e.registerB=e.memoryReader[e.registersHL](e,e.registersHL)},//LD B, A
//#0x47:
function(e){e.registerB=e.registerA},//LD C, B
//#0x48:
function(e){e.registerC=e.registerB},//LD C, C
//#0x49:
function(e){//Do nothing...
},//LD C, D
//#0x4A:
function(e){e.registerC=e.registerD},//LD C, E
//#0x4B:
function(e){e.registerC=e.registerE},//LD C, H
//#0x4C:
function(e){e.registerC=e.registersHL>>8},//LD C, L
//#0x4D:
function(e){e.registerC=255&e.registersHL},//LD C, (HL)
//#0x4E:
function(e){e.registerC=e.memoryReader[e.registersHL](e,e.registersHL)},//LD C, A
//#0x4F:
function(e){e.registerC=e.registerA},//LD D, B
//#0x50:
function(e){e.registerD=e.registerB},//LD D, C
//#0x51:
function(e){e.registerD=e.registerC},//LD D, D
//#0x52:
function(e){//Do nothing...
},//LD D, E
//#0x53:
function(e){e.registerD=e.registerE},//LD D, H
//#0x54:
function(e){e.registerD=e.registersHL>>8},//LD D, L
//#0x55:
function(e){e.registerD=255&e.registersHL},//LD D, (HL)
//#0x56:
function(e){e.registerD=e.memoryReader[e.registersHL](e,e.registersHL)},//LD D, A
//#0x57:
function(e){e.registerD=e.registerA},//LD E, B
//#0x58:
function(e){e.registerE=e.registerB},//LD E, C
//#0x59:
function(e){e.registerE=e.registerC},//LD E, D
//#0x5A:
function(e){e.registerE=e.registerD},//LD E, E
//#0x5B:
function(e){//Do nothing...
},//LD E, H
//#0x5C:
function(e){e.registerE=e.registersHL>>8},//LD E, L
//#0x5D:
function(e){e.registerE=255&e.registersHL},//LD E, (HL)
//#0x5E:
function(e){e.registerE=e.memoryReader[e.registersHL](e,e.registersHL)},//LD E, A
//#0x5F:
function(e){e.registerE=e.registerA},//LD H, B
//#0x60:
function(e){e.registersHL=e.registerB<<8|255&e.registersHL},//LD H, C
//#0x61:
function(e){e.registersHL=e.registerC<<8|255&e.registersHL},//LD H, D
//#0x62:
function(e){e.registersHL=e.registerD<<8|255&e.registersHL},//LD H, E
//#0x63:
function(e){e.registersHL=e.registerE<<8|255&e.registersHL},//LD H, H
//#0x64:
function(e){//Do nothing...
},//LD H, L
//#0x65:
function(e){e.registersHL=(255&e.registersHL)*257},//LD H, (HL)
//#0x66:
function(e){e.registersHL=e.memoryReader[e.registersHL](e,e.registersHL)<<8|255&e.registersHL},//LD H, A
//#0x67:
function(e){e.registersHL=e.registerA<<8|255&e.registersHL},//LD L, B
//#0x68:
function(e){e.registersHL=65280&e.registersHL|e.registerB},//LD L, C
//#0x69:
function(e){e.registersHL=65280&e.registersHL|e.registerC},//LD L, D
//#0x6A:
function(e){e.registersHL=65280&e.registersHL|e.registerD},//LD L, E
//#0x6B:
function(e){e.registersHL=65280&e.registersHL|e.registerE},//LD L, H
//#0x6C:
function(e){e.registersHL=65280&e.registersHL|e.registersHL>>8},//LD L, L
//#0x6D:
function(e){//Do nothing...
},//LD L, (HL)
//#0x6E:
function(e){e.registersHL=65280&e.registersHL|e.memoryReader[e.registersHL](e,e.registersHL)},//LD L, A
//#0x6F:
function(e){e.registersHL=65280&e.registersHL|e.registerA},//LD (HL), B
//#0x70:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerB)},//LD (HL), C
//#0x71:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerC)},//LD (HL), D
//#0x72:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerD)},//LD (HL), E
//#0x73:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerE)},//LD (HL), H
//#0x74:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registersHL>>8)},//LD (HL), L
//#0x75:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,255&e.registersHL)},//HALT
//#0x76:
function(e){//See if there's already an IRQ match:
(e.interruptsEnabled&e.interruptsRequested&31)>0?e.cGBC||e.usedBootROM?e.CPUTicks+=4:e.skipPCIncrement=!0:e.calculateHALTPeriod()},//LD (HL), A
//#0x77:
function(e){e.memoryWriter[e.registersHL](e,e.registersHL,e.registerA)},//LD A, B
//#0x78:
function(e){e.registerA=e.registerB},//LD A, C
//#0x79:
function(e){e.registerA=e.registerC},//LD A, D
//#0x7A:
function(e){e.registerA=e.registerD},//LD A, E
//#0x7B:
function(e){e.registerA=e.registerE},//LD A, H
//#0x7C:
function(e){e.registerA=e.registersHL>>8},//LD A, L
//#0x7D:
function(e){e.registerA=255&e.registersHL},//LD, A, (HL)
//#0x7E:
function(e){e.registerA=e.memoryReader[e.registersHL](e,e.registersHL)},//LD A, A
//#0x7F:
function(e){//Do Nothing...
},//ADD A, B
//#0x80:
function(e){var t=e.registerA+e.registerB;e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, C
//#0x81:
function(e){var t=e.registerA+e.registerC;e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, D
//#0x82:
function(e){var t=e.registerA+e.registerD;e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, E
//#0x83:
function(e){var t=e.registerA+e.registerE;e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, H
//#0x84:
function(e){var t=e.registerA+(e.registersHL>>8);e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, L
//#0x85:
function(e){var t=e.registerA+(255&e.registersHL);e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, (HL)
//#0x86:
function(e){var t=e.registerA+e.memoryReader[e.registersHL](e,e.registersHL);e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADD A, A
//#0x87:
function(e){e.FHalfCarry=(8&e.registerA)==8,e.FCarry=e.registerA>127,e.registerA=e.registerA<<1&255,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, B
//#0x88:
function(e){var t=e.registerA+e.registerB+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&e.registerB)+(e.FCarry?1:0)>15,e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, C
//#0x89:
function(e){var t=e.registerA+e.registerC+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&e.registerC)+(e.FCarry?1:0)>15,e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, D
//#0x8A:
function(e){var t=e.registerA+e.registerD+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&e.registerD)+(e.FCarry?1:0)>15,e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, E
//#0x8B:
function(e){var t=e.registerA+e.registerE+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&e.registerE)+(e.FCarry?1:0)>15,e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, H
//#0x8C:
function(e){var t=e.registersHL>>8,r=e.registerA+t+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&t)+(e.FCarry?1:0)>15,e.FCarry=r>255,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, L
//#0x8D:
function(e){var t=255&e.registersHL,r=e.registerA+t+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&t)+(e.FCarry?1:0)>15,e.FCarry=r>255,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, (HL)
//#0x8E:
function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL),r=e.registerA+t+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&t)+(e.FCarry?1:0)>15,e.FCarry=r>255,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!1},//ADC A, A
//#0x8F:
function(e){//shift left register A one bit for some ops here as an optimization:
var t=e.registerA<<1|(e.FCarry?1:0);e.FHalfCarry=(e.registerA<<1&30|(e.FCarry?1:0))>15,e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//SUB A, B
//#0x90:
function(e){var t=e.registerA-e.registerB;e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, C
//#0x91:
function(e){var t=e.registerA-e.registerC;e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, D
//#0x92:
function(e){var t=e.registerA-e.registerD;e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, E
//#0x93:
function(e){var t=e.registerA-e.registerE;e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, H
//#0x94:
function(e){var t=e.registerA-(e.registersHL>>8);e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, L
//#0x95:
function(e){var t=e.registerA-(255&e.registersHL);e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, (HL)
//#0x96:
function(e){var t=e.registerA-e.memoryReader[e.registersHL](e,e.registersHL);e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//SUB A, A
//#0x97:
function(e){//number - same number == 0
e.registerA=0,e.FHalfCarry=e.FCarry=!1,e.FZero=e.FSubtract=!0},//SBC A, B
//#0x98:
function(e){var t=e.registerA-e.registerB-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&e.registerB)-(e.FCarry?1:0)<0,e.FCarry=t<0,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, C
//#0x99:
function(e){var t=e.registerA-e.registerC-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&e.registerC)-(e.FCarry?1:0)<0,e.FCarry=t<0,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, D
//#0x9A:
function(e){var t=e.registerA-e.registerD-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&e.registerD)-(e.FCarry?1:0)<0,e.FCarry=t<0,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, E
//#0x9B:
function(e){var t=e.registerA-e.registerE-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&e.registerE)-(e.FCarry?1:0)<0,e.FCarry=t<0,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, H
//#0x9C:
function(e){var t=e.registersHL>>8,r=e.registerA-t-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&t)-(e.FCarry?1:0)<0,e.FCarry=r<0,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, L
//#0x9D:
function(e){var t=e.registerA-(255&e.registersHL)-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&e.registersHL)-(e.FCarry?1:0)<0,e.FCarry=t<0,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, (HL)
//#0x9E:
function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL),r=e.registerA-t-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&t)-(e.FCarry?1:0)<0,e.FCarry=r<0,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!0},//SBC A, A
//#0x9F:
function(e){//Optimized SBC A:
e.FCarry?(e.FZero=!1,e.FSubtract=e.FHalfCarry=e.FCarry=!0,e.registerA=255):(e.FHalfCarry=e.FCarry=!1,e.FSubtract=e.FZero=!0,e.registerA=0)},//AND B
//#0xA0:
function(e){e.registerA&=e.registerB,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND C
//#0xA1:
function(e){e.registerA&=e.registerC,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND D
//#0xA2:
function(e){e.registerA&=e.registerD,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND E
//#0xA3:
function(e){e.registerA&=e.registerE,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND H
//#0xA4:
function(e){e.registerA&=e.registersHL>>8,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND L
//#0xA5:
function(e){e.registerA&=e.registersHL,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND (HL)
//#0xA6:
function(e){e.registerA&=e.memoryReader[e.registersHL](e,e.registersHL),e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//AND A
//#0xA7:
function(e){//number & same number = same number
e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//XOR B
//#0xA8:
function(e){e.registerA^=e.registerB,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR C
//#0xA9:
function(e){e.registerA^=e.registerC,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR D
//#0xAA:
function(e){e.registerA^=e.registerD,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR E
//#0xAB:
function(e){e.registerA^=e.registerE,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR H
//#0xAC:
function(e){e.registerA^=e.registersHL>>8,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR L
//#0xAD:
function(e){e.registerA^=255&e.registersHL,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR (HL)
//#0xAE:
function(e){e.registerA^=e.memoryReader[e.registersHL](e,e.registersHL),e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//XOR A
//#0xAF:
function(e){//number ^ same number == 0
e.registerA=0,e.FZero=!0,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//OR B
//#0xB0:
function(e){e.registerA|=e.registerB,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR C
//#0xB1:
function(e){e.registerA|=e.registerC,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR D
//#0xB2:
function(e){e.registerA|=e.registerD,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR E
//#0xB3:
function(e){e.registerA|=e.registerE,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR H
//#0xB4:
function(e){e.registerA|=e.registersHL>>8,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR L
//#0xB5:
function(e){e.registerA|=255&e.registersHL,e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR (HL)
//#0xB6:
function(e){e.registerA|=e.memoryReader[e.registersHL](e,e.registersHL),e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//OR A
//#0xB7:
function(e){//number | same number == same number
e.FZero=0==e.registerA,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//CP B
//#0xB8:
function(e){var t=e.registerA-e.registerB;e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP C
//#0xB9:
function(e){var t=e.registerA-e.registerC;e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP D
//#0xBA:
function(e){var t=e.registerA-e.registerD;e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP E
//#0xBB:
function(e){var t=e.registerA-e.registerE;e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP H
//#0xBC:
function(e){var t=e.registerA-(e.registersHL>>8);e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP L
//#0xBD:
function(e){var t=e.registerA-(255&e.registersHL);e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP (HL)
//#0xBE:
function(e){var t=e.registerA-e.memoryReader[e.registersHL](e,e.registersHL);e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//CP A
//#0xBF:
function(e){e.FHalfCarry=e.FCarry=!1,e.FZero=e.FSubtract=!0},//RET !FZ
//#0xC0:
function(e){e.FZero||(e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535,e.CPUTicks+=12)},//POP BC
//#0xC1:
function(e){e.registerC=e.memoryReader[e.stackPointer](e,e.stackPointer),e.registerB=e.memoryRead(e.stackPointer+1&65535),e.stackPointer=e.stackPointer+2&65535},//JP !FZ, nn
//#0xC2:
function(e){e.FZero?e.programCounter=e.programCounter+2&65535:(e.programCounter=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.CPUTicks+=4)},//JP nn
//#0xC3:
function(e){e.programCounter=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter)},//CALL !FZ, nn
//#0xC4:
function(e){if(e.FZero)e.programCounter=e.programCounter+2&65535;else{var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=t,e.CPUTicks+=12}},//PUSH BC
//#0xC5:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registerB),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registerC)},//ADD, n
//#0xC6:
function(e){var t=e.registerA+e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+1&65535,e.FHalfCarry=(15&t)<(15&e.registerA),e.FCarry=t>255,e.registerA=255&t,e.FZero=0==e.registerA,e.FSubtract=!1},//RST 0
//#0xC7:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=0},//RET FZ
//#0xC8:
function(e){e.FZero&&(e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535,e.CPUTicks+=12)},//RET
//#0xC9:
function(e){e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535},//JP FZ, nn
//#0xCA:
function(e){e.FZero?(e.programCounter=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.CPUTicks+=4):e.programCounter=e.programCounter+2&65535},//Secondary OP Code Set:
//#0xCB:
function(e){var t=e.memoryReader[e.programCounter](e,e.programCounter);//Increment the program counter to the next instruction:
e.programCounter=e.programCounter+1&65535,//Get how many CPU cycles the current 0xCBXX op code counts for:
e.CPUTicks+=e.SecondaryTICKTable[t],//Execute secondary OP codes for the 0xCB OP code call.
e.CBOPCODE[t](e)},//CALL FZ, nn
//#0xCC:
function(e){if(e.FZero){var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=t,e.CPUTicks+=12}else e.programCounter=e.programCounter+2&65535},//CALL nn
//#0xCD:
function(e){var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=t},//ADC A, n
//#0xCE:
function(e){var t=e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+1&65535;var r=e.registerA+t+(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)+(15&t)+(e.FCarry?1:0)>15,e.FCarry=r>255,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!1},//RST 0x8
//#0xCF:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=8},//RET !FC
//#0xD0:
function(e){e.FCarry||(e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535,e.CPUTicks+=12)},//POP DE
//#0xD1:
function(e){e.registerE=e.memoryReader[e.stackPointer](e,e.stackPointer),e.registerD=e.memoryRead(e.stackPointer+1&65535),e.stackPointer=e.stackPointer+2&65535},//JP !FC, nn
//#0xD2:
function(e){e.FCarry?e.programCounter=e.programCounter+2&65535:(e.programCounter=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.CPUTicks+=4)},//0xD3 - Illegal
//#0xD3:
function(e){console.log("Illegal op code 0xD3 called, pausing emulation.");//pause();
},//CALL !FC, nn
//#0xD4:
function(e){if(e.FCarry)e.programCounter=e.programCounter+2&65535;else{var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=t,e.CPUTicks+=12}},//PUSH DE
//#0xD5:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registerD),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registerE)},//SUB A, n
//#0xD6:
function(e){var t=e.registerA-e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+1&65535,e.FHalfCarry=(15&e.registerA)<(15&t),e.FCarry=t<0,e.registerA=255&t,e.FZero=0==t,e.FSubtract=!0},//RST 0x10
//#0xD7:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=16},//RET FC
//#0xD8:
function(e){e.FCarry&&(e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535,e.CPUTicks+=12)},//RETI
//#0xD9:
function(e){e.programCounter=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535,//Immediate for HALT:
e.IRQEnableDelay=2==e.IRQEnableDelay||118==e.memoryReader[e.programCounter](e,e.programCounter)?1:2},//JP FC, nn
//#0xDA:
function(e){e.FCarry?(e.programCounter=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.CPUTicks+=4):e.programCounter=e.programCounter+2&65535},//0xDB - Illegal
//#0xDB:
function(e){console.log("Illegal op code 0xDB called, pausing emulation.");//pause();
},//CALL FC, nn
//#0xDC:
function(e){if(e.FCarry){var t=e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+2&65535,e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=t,e.CPUTicks+=12}else e.programCounter=e.programCounter+2&65535},//0xDD - Illegal
//#0xDD:
function(e){console.log("Illegal op code 0xDD called, pausing emulation.");//pause();
},//SBC A, n
//#0xDE:
function(e){var t=e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+1&65535;var r=e.registerA-t-(e.FCarry?1:0);e.FHalfCarry=(15&e.registerA)-(15&t)-(e.FCarry?1:0)<0,e.FCarry=r<0,e.registerA=255&r,e.FZero=0==e.registerA,e.FSubtract=!0},//RST 0x18
//#0xDF:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=24},//LDH (n), A
//#0xE0:
function(e){e.memoryHighWrite(e.memoryReader[e.programCounter](e,e.programCounter),e.registerA),e.programCounter=e.programCounter+1&65535},//POP HL
//#0xE1:
function(e){e.registersHL=e.memoryRead(e.stackPointer+1&65535)<<8|e.memoryReader[e.stackPointer](e,e.stackPointer),e.stackPointer=e.stackPointer+2&65535},//LD (0xFF00 + C), A
//#0xE2:
function(e){e.memoryHighWriter[e.registerC](e,e.registerC,e.registerA)},//0xE3 - Illegal
//#0xE3:
function(e){console.log("Illegal op code 0xE3 called, pausing emulation.",2);//pause();
},//0xE4 - Illegal
//#0xE4:
function(e){console.log("Illegal op code 0xE4 called, pausing emulation.",2);//pause();
},//PUSH HL
//#0xE5:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registersHL>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.registersHL)},//AND n
//#0xE6:
function(e){e.registerA&=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535,e.FZero=0==e.registerA,e.FHalfCarry=!0,e.FSubtract=e.FCarry=!1},//RST 0x20
//#0xE7:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=32},//ADD SP, n
//#0xE8:
function(e){var t=e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24;e.programCounter=e.programCounter+1&65535;var r=e.stackPointer+t&65535;t=e.stackPointer^t^r,e.stackPointer=r,e.FCarry=(256&t)==256,e.FHalfCarry=(16&t)==16,e.FZero=e.FSubtract=!1},//JP, (HL)
//#0xE9:
function(e){e.programCounter=e.registersHL},//LD n, A
//#0xEA:
function(e){e.memoryWrite(e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter),e.registerA),e.programCounter=e.programCounter+2&65535},//0xEB - Illegal
//#0xEB:
function(e){console.log("Illegal op code 0xEB called, pausing emulation.",2);//pause();
},//0xEC - Illegal
//#0xEC:
function(e){console.log("Illegal op code 0xEC called, pausing emulation.",2);//pause();
},//0xED - Illegal
//#0xED:
function(e){console.log("Illegal op code 0xED called, pausing emulation.",2);//pause();
},//XOR n
//#0xEE:
function(e){e.registerA^=e.memoryReader[e.programCounter](e,e.programCounter),e.programCounter=e.programCounter+1&65535,e.FZero=0==e.registerA,e.FSubtract=e.FHalfCarry=e.FCarry=!1},//RST 0x28
//#0xEF:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=40},//LDH A, (n)
//#0xF0:
function(e){e.registerA=e.memoryHighRead(e.memoryReader[e.programCounter](e,e.programCounter)),e.programCounter=e.programCounter+1&65535},//POP AF
//#0xF1:
function(e){var t=e.memoryReader[e.stackPointer](e,e.stackPointer);e.FZero=t>127,e.FSubtract=(64&t)==64,e.FHalfCarry=(32&t)==32,e.FCarry=(16&t)==16,e.registerA=e.memoryRead(e.stackPointer+1&65535),e.stackPointer=e.stackPointer+2&65535},//LD A, (0xFF00 + C)
//#0xF2:
function(e){e.registerA=e.memoryHighReader[e.registerC](e,e.registerC)},//DI
//#0xF3:
function(e){e.IME=!1,e.IRQEnableDelay=0},//0xF4 - Illegal
//#0xF4:
function(e){console.log("Illegal op code 0xF4 called, pausing emulation.",2);//pause();
},//PUSH AF
//#0xF5:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.registerA),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,(e.FZero?128:0)|(e.FSubtract?64:0)|(e.FHalfCarry?32:0)|(e.FCarry?16:0))},//OR n
//#0xF6:
function(e){e.registerA|=e.memoryReader[e.programCounter](e,e.programCounter),e.FZero=0==e.registerA,e.programCounter=e.programCounter+1&65535,e.FSubtract=e.FCarry=e.FHalfCarry=!1},//RST 0x30
//#0xF7:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=48},//LDHL SP, n
//#0xF8:
function(e){var t=e.memoryReader[e.programCounter](e,e.programCounter)<<24>>24;e.programCounter=e.programCounter+1&65535,e.registersHL=e.stackPointer+t&65535,t=e.stackPointer^t^e.registersHL,e.FCarry=(256&t)==256,e.FHalfCarry=(16&t)==16,e.FZero=e.FSubtract=!1},//LD SP, HL
//#0xF9:
function(e){e.stackPointer=e.registersHL},//LD A, (nn)
//#0xFA:
function(e){e.registerA=e.memoryRead(e.memoryRead(e.programCounter+1&65535)<<8|e.memoryReader[e.programCounter](e,e.programCounter)),e.programCounter=e.programCounter+2&65535},//EI
//#0xFB:
function(e){//Immediate for HALT:
e.IRQEnableDelay=2==e.IRQEnableDelay||118==e.memoryReader[e.programCounter](e,e.programCounter)?1:2},//0xFC - Illegal
//#0xFC:
function(e){console.log("Illegal op code 0xFC called, pausing emulation.",2);//pause();
},//0xFD - Illegal
//#0xFD:
function(e){console.log("Illegal op code 0xFD called, pausing emulation.",2);//pause();
},//CP n
//#0xFE:
function(e){var t=e.registerA-e.memoryReader[e.programCounter](e,e.programCounter);e.programCounter=e.programCounter+1&65535,e.FHalfCarry=(15&t)>(15&e.registerA),e.FCarry=t<0,e.FZero=0==t,e.FSubtract=!0},//RST 0x38
//#0xFF:
function(e){e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,e.programCounter>>8),e.stackPointer=e.stackPointer-1&65535,e.memoryWriter[e.stackPointer](e,e.stackPointer,255&e.programCounter),e.programCounter=56}];e.exports=r}),l("aN2Be",function(e,t){var r=[//RLC B
//#0x00:
function(e){e.FCarry=e.registerB>127,e.registerB=e.registerB<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){e.FCarry=e.registerC>127,e.registerC=e.registerC<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){e.FCarry=e.registerD>127,e.registerD=e.registerD<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){e.FCarry=e.registerE>127,e.registerE=e.registerE<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){e.FCarry=e.registersHL>32767,e.registersHL=e.registersHL<<1&65024|(e.FCarry?256:0)|255&e.registersHL,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){e.FCarry=(128&e.registersHL)==128,e.registersHL=65280&e.registersHL|e.registersHL<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);e.FCarry=t>127,t=t<<1&255|(e.FCarry?1:0),e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){e.FCarry=e.registerA>127,e.registerA=e.registerA<<1&255|(e.FCarry?1:0),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){e.FCarry=(1&e.registerB)==1,e.registerB=(e.FCarry?128:0)|e.registerB>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){e.FCarry=(1&e.registerC)==1,e.registerC=(e.FCarry?128:0)|e.registerC>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){e.FCarry=(1&e.registerD)==1,e.registerD=(e.FCarry?128:0)|e.registerD>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){e.FCarry=(1&e.registerE)==1,e.registerE=(e.FCarry?128:0)|e.registerE>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){e.FCarry=(256&e.registersHL)==256,e.registersHL=(e.FCarry?32768:0)|e.registersHL>>1&65280|255&e.registersHL,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){e.FCarry=(1&e.registersHL)==1,e.registersHL=65280&e.registersHL|(e.FCarry?128:0)|(255&e.registersHL)>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);e.FCarry=(1&t)==1,t=(e.FCarry?128:0)|t>>1,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){e.FCarry=(1&e.registerA)==1,e.registerA=(e.FCarry?128:0)|e.registerA>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){var t=e.registerB>127;e.registerB=e.registerB<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){var t=e.registerC>127;e.registerC=e.registerC<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){var t=e.registerD>127;e.registerD=e.registerD<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){var t=e.registerE>127;e.registerE=e.registerE<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){var t=e.registersHL>32767;e.registersHL=e.registersHL<<1&65024|(e.FCarry?256:0)|255&e.registersHL,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){var t=(128&e.registersHL)==128;e.registersHL=65280&e.registersHL|e.registersHL<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL),r=t>127;t=t<<1&255|(e.FCarry?1:0),e.FCarry=r,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){var t=e.registerA>127;e.registerA=e.registerA<<1&255|(e.FCarry?1:0),e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){var t=(1&e.registerB)==1;e.registerB=(e.FCarry?128:0)|e.registerB>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){var t=(1&e.registerC)==1;e.registerC=(e.FCarry?128:0)|e.registerC>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){var t=(1&e.registerD)==1;e.registerD=(e.FCarry?128:0)|e.registerD>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){var t=(1&e.registerE)==1;e.registerE=(e.FCarry?128:0)|e.registerE>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){var t=(256&e.registersHL)==256;e.registersHL=(e.FCarry?32768:0)|e.registersHL>>1&65280|255&e.registersHL,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){var t=(1&e.registersHL)==1;e.registersHL=65280&e.registersHL|(e.FCarry?128:0)|(255&e.registersHL)>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL),r=(1&t)==1;t=(e.FCarry?128:0)|t>>1,e.FCarry=r,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){var t=(1&e.registerA)==1;e.registerA=(e.FCarry?128:0)|e.registerA>>1,e.FCarry=t,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){e.FCarry=e.registerB>127,e.registerB=e.registerB<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){e.FCarry=e.registerC>127,e.registerC=e.registerC<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){e.FCarry=e.registerD>127,e.registerD=e.registerD<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){e.FCarry=e.registerE>127,e.registerE=e.registerE<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){e.FCarry=e.registersHL>32767,e.registersHL=e.registersHL<<1&65024|255&e.registersHL,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){e.FCarry=(128&e.registersHL)==128,e.registersHL=65280&e.registersHL|e.registersHL<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);e.FCarry=t>127,t=t<<1&255,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){e.FCarry=e.registerA>127,e.registerA=e.registerA<<1&255,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){e.FCarry=(1&e.registerB)==1,e.registerB=128&e.registerB|e.registerB>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){e.FCarry=(1&e.registerC)==1,e.registerC=128&e.registerC|e.registerC>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){e.FCarry=(1&e.registerD)==1,e.registerD=128&e.registerD|e.registerD>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){e.FCarry=(1&e.registerE)==1,e.registerE=128&e.registerE|e.registerE>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){e.FCarry=(256&e.registersHL)==256,e.registersHL=e.registersHL>>1&65280|33023&e.registersHL,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){e.FCarry=(1&e.registersHL)==1,e.registersHL=65408&e.registersHL|(255&e.registersHL)>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);e.FCarry=(1&t)==1,t=128&t|t>>1,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FHalfCarry=e.FSubtract=!1,e.FZero=0==t},function(e){e.FCarry=(1&e.registerA)==1,e.registerA=128&e.registerA|e.registerA>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){e.registerB=(15&e.registerB)<<4|e.registerB>>4,e.FZero=0==e.registerB,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registerC=(15&e.registerC)<<4|e.registerC>>4,e.FZero=0==e.registerC,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registerD=(15&e.registerD)<<4|e.registerD>>4,e.FZero=0==e.registerD,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registerE=(15&e.registerE)<<4|e.registerE>>4,e.FZero=0==e.registerE,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registersHL=(3840&e.registersHL)<<4|(61440&e.registersHL)>>4|255&e.registersHL,e.FZero=e.registersHL<256,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registersHL=65280&e.registersHL|(15&e.registersHL)<<4|(240&e.registersHL)>>4,e.FZero=(255&e.registersHL)==0,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);t=(15&t)<<4|t>>4,e.memoryWriter[e.registersHL](e,e.registersHL,t),e.FZero=0==t,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.registerA=(15&e.registerA)<<4|e.registerA>>4,e.FZero=0==e.registerA,e.FCarry=e.FHalfCarry=e.FSubtract=!1},function(e){e.FCarry=(1&e.registerB)==1,e.registerB>>=1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerB},function(e){e.FCarry=(1&e.registerC)==1,e.registerC>>=1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerC},function(e){e.FCarry=(1&e.registerD)==1,e.registerD>>=1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerD},function(e){e.FCarry=(1&e.registerE)==1,e.registerE>>=1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerE},function(e){e.FCarry=(256&e.registersHL)==256,e.registersHL=e.registersHL>>1&65280|255&e.registersHL,e.FHalfCarry=e.FSubtract=!1,e.FZero=e.registersHL<256},function(e){e.FCarry=(1&e.registersHL)==1,e.registersHL=65280&e.registersHL|(255&e.registersHL)>>1,e.FHalfCarry=e.FSubtract=!1,e.FZero=(255&e.registersHL)==0},function(e){var t=e.memoryReader[e.registersHL](e,e.registersHL);e.FCarry=(1&t)==1,e.memoryWriter[e.registersHL](e,e.registersHL,t>>1),e.FHalfCarry=e.FSubtract=!1,e.FZero=t<2},function(e){e.FCarry=(1&e.registerA)==1,e.registerA>>=1,e.FHalfCarry=e.FSubtract=!1,e.FZero=0==e.registerA},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(256&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(512&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(1024&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(2048&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(4096&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(8192&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(16384&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(64&e.registerA)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registerB)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registerC)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registerD)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registerE)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(32768&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registersHL)==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.memoryReader[e.registersHL](e,e.registersHL))==0},function(e){e.FHalfCarry=!0,e.FSubtract=!1,e.FZero=(128&e.registerA)==0},function(e){e.registerB&=254},function(e){e.registerC&=254},function(e){e.registerD&=254},function(e){e.registerE&=254},function(e){e.registersHL&=65279},function(e){e.registersHL&=65534},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,254&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=254},function(e){e.registerB&=253},function(e){e.registerC&=253},function(e){e.registerD&=253},function(e){e.registerE&=253},function(e){e.registersHL&=65023},function(e){e.registersHL&=65533},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,253&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=253},function(e){e.registerB&=251},function(e){e.registerC&=251},function(e){e.registerD&=251},function(e){e.registerE&=251},function(e){e.registersHL&=64511},function(e){e.registersHL&=65531},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,251&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=251},function(e){e.registerB&=247},function(e){e.registerC&=247},function(e){e.registerD&=247},function(e){e.registerE&=247},function(e){e.registersHL&=63487},function(e){e.registersHL&=65527},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,247&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=247},function(e){e.registerB&=239},function(e){e.registerC&=239},function(e){e.registerD&=239},function(e){e.registerE&=239},function(e){e.registersHL&=61439},function(e){e.registersHL&=65519},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,239&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=239},function(e){e.registerB&=223},function(e){e.registerC&=223},function(e){e.registerD&=223},function(e){e.registerE&=223},function(e){e.registersHL&=57343},function(e){e.registersHL&=65503},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,223&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=223},function(e){e.registerB&=191},function(e){e.registerC&=191},function(e){e.registerD&=191},function(e){e.registerE&=191},function(e){e.registersHL&=49151},function(e){e.registersHL&=65471},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,191&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=191},function(e){e.registerB&=127},function(e){e.registerC&=127},function(e){e.registerD&=127},function(e){e.registerE&=127},function(e){e.registersHL&=32767},function(e){e.registersHL&=65407},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,127&e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA&=127},function(e){e.registerB|=1},function(e){e.registerC|=1},function(e){e.registerD|=1},function(e){e.registerE|=1},function(e){e.registersHL|=256},function(e){e.registersHL|=1},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,1|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=1},function(e){e.registerB|=2},function(e){e.registerC|=2},function(e){e.registerD|=2},function(e){e.registerE|=2},function(e){e.registersHL|=512},function(e){e.registersHL|=2},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,2|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=2},function(e){e.registerB|=4},function(e){e.registerC|=4},function(e){e.registerD|=4},function(e){e.registerE|=4},function(e){e.registersHL|=1024},function(e){e.registersHL|=4},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,4|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=4},function(e){e.registerB|=8},function(e){e.registerC|=8},function(e){e.registerD|=8},function(e){e.registerE|=8},function(e){e.registersHL|=2048},function(e){e.registersHL|=8},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,8|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=8},function(e){e.registerB|=16},function(e){e.registerC|=16},function(e){e.registerD|=16},function(e){e.registerE|=16},function(e){e.registersHL|=4096},function(e){e.registersHL|=16},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,16|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=16},function(e){e.registerB|=32},function(e){e.registerC|=32},function(e){e.registerD|=32},function(e){e.registerE|=32},function(e){e.registersHL|=8192},function(e){e.registersHL|=32},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,32|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=32},function(e){e.registerB|=64},function(e){e.registerC|=64},function(e){e.registerD|=64},function(e){e.registerE|=64},function(e){e.registersHL|=16384},function(e){e.registersHL|=64},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,64|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=64},function(e){e.registerB|=128},function(e){e.registerC|=128},function(e){e.registerD|=128},function(e){e.registerE|=128},function(e){e.registersHL|=32768},function(e){e.registersHL|=128},function(e){e.memoryWriter[e.registersHL](e,e.registersHL,128|e.memoryReader[e.registersHL](e,e.registersHL))},function(e){e.registerA|=128}];e.exports=r}),l("8QGsE",function(e,t){//Number of machine cycles for each instruction:
e.exports=[/*   0,  1,  2,  3,  4,  5,  6,  7,      8,  9,  A, B,  C,  D, E,  F*/4,12,8,8,4,4,8,4,20,8,8,8,4,4,8,4,4,12,8,8,4,4,8,4,12,8,8,8,4,4,8,4,8,12,8,8,4,4,8,4,8,8,8,8,4,4,8,4,8,12,8,8,12,12,12,4,8,8,8,8,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,8,8,8,8,8,8,4,8,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,4,4,4,4,4,4,8,4,8,12,12,16,12,16,8,16,8,16,12,0,12,24,8,16,8,12,12,4,12,16,8,16,8,16,12,4,12,4,8,16,12,12,8,4,4,16,8,16,16,4,16,4,4,4,8,16,12,12,8,4,4,16,8,16,12,8,16,4,0,4,8,16//F
]}),l("gOFKk",function(e,t){//Number of machine cycles for each 0xCBXX instruction:
e.exports=[/*  0, 1, 2, 3, 4, 5,  6, 7,        8, 9, A, B, C, D,  E, F*/8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,16,8//F
]});var m={},f={},g={},y=g={};function C(){throw Error("setTimeout has not been defined")}function p(){throw Error("clearTimeout has not been defined")}function d(e){if(t===setTimeout)return setTimeout(e,0);// if setTimeout wasn't available but was latter defined
if((t===C||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{// when when somebody has screwed with setTimeout but no I.E. maddness
return t(e,0)}catch(r){try{// When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
return t.call(null,e,0)}catch(r){// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:C}catch(e){t=C}try{r="function"==typeof clearTimeout?clearTimeout:p}catch(e){r=p}}();var B=[],R=!1,F=-1;function S(){R&&i&&(R=!1,i.length?B=i.concat(B):F=-1,B.length&&T())}function T(){if(!R){var e=d(S);R=!0;for(var t=B.length;t;){for(i=B,B=[];++F<t;)i&&i[F].run();F=-1,t=B.length}i=null,R=!1,function(e){if(r===clearTimeout)return clearTimeout(e);// if clearTimeout wasn't available but was latter defined
if((r===p||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{// when when somebody has screwed with setTimeout but no I.E. maddness
r(e)}catch(t){try{// When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
return r.call(null,e)}catch(t){// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
// Some versions of I.E. have different rules for clearTimeout vs setTimeout
return r.call(this,e)}}}(e)}}// v8 likes predictible objects
function H(e,t){this.fun=e,this.array=t}function k(){}y.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];B.push(new H(e,t)),1!==B.length||R||d(T)},H.prototype.run=function(){this.fun.apply(null,this.array)},y.title="browser",y.browser=!0,y.env={},y.argv=[],y.version="",y.versions={},y.on=k,y.addListener=k,y.once=k,y.off=k,y.removeListener=k,y.removeAllListeners=k,y.emit=k,y.prependListener=k,y.prependOnceListener=k,y.listeners=function(e){return[]},y.binding=function(e){throw Error("process.binding is not supported")},y.cwd=function(){return"/"},y.chdir=function(e){throw Error("process.chdir is not supported")},y.umask=function(){return 0};var L={},b={};b=function(e){//My added variables--------------
this.frameDone=!1,this.currentScreen=[],this.lastScreen=[],this.partialScreen={},//Params, etc...
this.currentFrame=[],this.drawContext=null,this.ROMImage=e,//CPU Registers and Flags:
this.registerA=1,this.FZero=!0,this.FSubtract=!1,this.FHalfCarry=!0,this.FCarry=!0,this.registerB=0,this.registerC=19,this.registerD=0,this.registerE=216,this.registersHL=333,this.stackPointer=65534,this.programCounter=256,//Some CPU Emulation State Variables:
this.CPUCyclesTotal=0,this.CPUCyclesTotalBase=0,this.CPUCyclesTotalCurrent=0,this.CPUCyclesTotalRoundoff=0,this.baseCPUCyclesPerIteration=0,this.remainingClocks=0,this.inBootstrap=!0,this.usedBootROM=!1,this.usedGBCBootROM=!1,this.halt=!1,this.skipPCIncrement=!1,this.stopEmulator=3,this.IME=!0,this.IRQLineMatched=0,this.interruptsRequested=0,this.interruptsEnabled=0,this.hdmaRunning=!1,this.CPUTicks=0,this.doubleSpeedShifter=0,this.JoyPad=255,this.CPUStopped=!1,//Main RAM, MBC RAM, GBC Main RAM, VRAM, etc.
this.memoryReader=[],this.memoryWriter=[],this.memoryHighReader=[],this.memoryHighWriter=[],this.ROM=[],this.memory=[],this.MBCRam=[],this.VRAM=[],this.GBCMemory=[],this.MBC1Mode=!1,this.MBCRAMBanksEnabled=!1,this.currMBCRAMBank=0,this.currMBCRAMBankPosition=-40960,this.cGBC=!1,this.gbcRamBank=1,this.gbcRamBankPosition=-53248,this.gbcRamBankPositionECHO=-61440,this.RAMBanks=[0,1,2,4,16],this.ROMBank1offs=0,this.currentROMBank=0,this.cartridgeType=0,this.name="",this.gameCode="",this.fromSaveState=!1,this.savedStateFileName="",this.STATTracker=0,this.modeSTAT=0,this.spriteCount=252,this.LYCMatchTriggerSTAT=!1,this.mode2TriggerSTAT=!1,this.mode1TriggerSTAT=!1,this.mode0TriggerSTAT=!1,this.LCDisOn=!1,this.LINECONTROL=[],this.DISPLAYOFFCONTROL=[function(e){//Array of line 0 function to handle the LCD controller when it's off (Do nothing!).
}],this.LCDCONTROL=null,this.initializeLCDController(),//RTC (Real Time Clock for MBC3):
this.RTCisLatched=!1,this.latchedSeconds=0,this.latchedMinutes=0,this.latchedHours=0,this.latchedLDays=0,this.latchedHDays=0,this.RTCSeconds=0,this.RTCMinutes=0,this.RTCHours=0,this.RTCDays=0,this.RTCDayOverFlow=!1,this.RTCHALT=!1,//Gyro:
this.highX=127,this.lowX=127,this.highY=127,this.lowY=127,//Sound variables:
this.audioHandle=null,this.numSamplesTotal=0,this.dutyLookup=[[!1,!1,!1,!1,!1,!1,!1,!0],[!0,!1,!1,!1,!1,!1,!1,!0],[!0,!1,!1,!1,!1,!0,!0,!0],[!1,!0,!0,!0,!0,!0,!0,!1]],this.bufferContainAmount=0,this.LSFR15Table=null,this.LSFR7Table=null,this.noiseSampleTable=null,this.initializeAudioStartState(),this.soundMasterEnabled=!1,this.channel3PCM=null,//Vin Shit:
this.VinLeftChannelMasterVolume=8,this.VinRightChannelMasterVolume=8,//Channel paths enabled:
this.leftChannel1=!1,this.leftChannel2=!1,this.leftChannel3=!1,this.leftChannel4=!1,this.rightChannel1=!1,this.rightChannel2=!1,this.rightChannel3=!1,this.rightChannel4=!1,this.audioClocksUntilNextEvent=1,this.audioClocksUntilNextEventCounter=1,//Channel output level caches:
this.channel1currentSampleLeft=0,this.channel1currentSampleRight=0,this.channel2currentSampleLeft=0,this.channel2currentSampleRight=0,this.channel3currentSampleLeft=0,this.channel3currentSampleRight=0,this.channel4currentSampleLeft=0,this.channel4currentSampleRight=0,this.channel1currentSampleLeftSecondary=0,this.channel1currentSampleRightSecondary=0,this.channel2currentSampleLeftSecondary=0,this.channel2currentSampleRightSecondary=0,this.channel3currentSampleLeftSecondary=0,this.channel3currentSampleRightSecondary=0,this.channel4currentSampleLeftSecondary=0,this.channel4currentSampleRightSecondary=0,this.channel1currentSampleLeftTrimary=0,this.channel1currentSampleRightTrimary=0,this.channel2currentSampleLeftTrimary=0,this.channel2currentSampleRightTrimary=0,this.mixerOutputCache=0,//Pre-multipliers to cache some calculations:
this.emulatorSpeed=1,this.initializeTiming(),//Audio generation counters:
this.audioTicks=0,this.audioIndex=0,this.downsampleInput=0,this.audioDestinationPosition=0,this.rollover=0,//Timing Variables
this.emulatorTicks=0,this.DIVTicks=56,this.LCDTicks=60,this.timerTicks=0,this.TIMAEnabled=!1,this.TACClocker=1024,this.serialTimer=0,this.serialShiftTimer=0,this.serialShiftTimerAllocated=0,this.IRQEnableDelay=0;var t=new Date;this.lastIteration=t.getTime(),t=new Date,this.firstIteration=t.getTime(),this.iterations=0,this.actualScanLine=0,this.lastUnrenderedLine=0,this.queuedScanLines=0,this.totalLinesPassed=0,this.haltPostClocks=0,//ROM Cartridge Components:
this.cMBC1=!1,this.cMBC2=!1,this.cMBC3=!1,this.cMBC5=!1,this.cMBC7=!1,this.cSRAM=!1,this.cMMMO1=!1,this.cRUMBLE=!1,this.cCamera=!1,this.cTAMA5=!1,this.cHuC3=!1,this.cHuC1=!1,this.cTIMER=!1,this.ROMBanks=[2,4,8,16,32,64,128,256,512],this.ROMBanks[82]=72,this.ROMBanks[83]=80,this.ROMBanks[84]=96,this.numRAMBanks=0,////Graphics Variables
this.currVRAMBank=0,this.backgroundX=0,this.backgroundY=0,this.gfxWindowDisplay=!1,this.gfxSpriteShow=!1,this.gfxSpriteNormalHeight=!0,this.bgEnabled=!0,this.BGPriorityEnabled=!0,this.gfxWindowCHRBankPosition=0,this.gfxBackgroundCHRBankPosition=0,this.gfxBackgroundBankOffset=128,this.windowY=0,this.windowX=0,this.drewBlank=0,this.drewFrame=!1,this.midScanlineOffset=-1,this.pixelEnd=0,this.currentX=0,//BG Tile Pointer Caches:
this.BGCHRBank1=null,this.BGCHRBank2=null,this.BGCHRCurrentBank=null,//Tile Data Cache:
this.tileCache=null,//Palettes:
this.colors=[15728606,11392916,5411443,1586242],this.OBJPalette=null,this.BGPalette=null,this.gbcOBJRawPalette=null,this.gbcBGRawPalette=null,this.gbOBJPalette=null,this.gbBGPalette=null,this.gbcOBJPalette=null,this.gbcBGPalette=null,this.gbBGColorizedPalette=null,this.gbOBJColorizedPalette=null,this.cachedBGPaletteConversion=null,this.cachedOBJPaletteConversion=null,this.updateGBBGPalette=this.updateGBRegularBGPalette,this.updateGBOBJPalette=this.updateGBRegularOBJPalette,this.colorizedGBPalettes=!1,this.BGLayerRender=null,this.WindowLayerRender=null,this.SpriteLayerRender=null,this.frameBuffer=[],this.swizzledFrame=null,this.canvasBuffer=null,this.pixelStart=0,//Variables used for scaling in JS:
this.onscreenWidth=this.offscreenWidth=160,this.onscreenHeight=this.offScreenheight=144,this.offscreenRGBCount=this.onscreenWidth*this.onscreenHeight*4,this.resizePathClear=!0,//Initialize the white noise cache tables ahead of time:
this.intializeWhiteNoise()};var A={};function M(e){b.call(this,e),this.ROMImageIsString="string"==typeof e}A=[!0,!0,!1,1,!0,!1,8,10,20,!1,!1,!1,!1,!0,[!0,!0,!0,!0]//User controlled channel enables.
],M.prototype={constructor:M,//-----------------ARCHITECTURE-------------------------
GBBOOTROM:[],GBCBOOTROM:[],ffxxDump:u("gOdab"),OPCODE:u("kE7dz"),CBOPCODE:u("aN2Be"),TICKTable:u("8QGsE"),SecondaryTICKTable:u("gOFKk"),//-------------------------------------------------------
//------------SAVE/LOAD----------------------------------
saveState:function(){return[this.fromTypedArray(this.ROM),this.inBootstrap,this.registerA,this.FZero,this.FSubtract,this.FHalfCarry,this.FCarry,this.registerB,this.registerC,this.registerD,this.registerE,this.registersHL,this.stackPointer,this.programCounter,this.halt,this.IME,this.hdmaRunning,this.CPUTicks,this.doubleSpeedShifter,this.fromTypedArray(this.memory),this.fromTypedArray(this.MBCRam),this.fromTypedArray(this.VRAM),this.currVRAMBank,this.fromTypedArray(this.GBCMemory),this.MBC1Mode,this.MBCRAMBanksEnabled,this.currMBCRAMBank,this.currMBCRAMBankPosition,this.cGBC,this.gbcRamBank,this.gbcRamBankPosition,this.ROMBank1offs,this.currentROMBank,this.cartridgeType,this.name,this.gameCode,this.modeSTAT,this.LYCMatchTriggerSTAT,this.mode2TriggerSTAT,this.mode1TriggerSTAT,this.mode0TriggerSTAT,this.LCDisOn,this.gfxWindowCHRBankPosition,this.gfxWindowDisplay,this.gfxSpriteShow,this.gfxSpriteNormalHeight,this.gfxBackgroundCHRBankPosition,this.gfxBackgroundBankOffset,this.TIMAEnabled,this.DIVTicks,this.LCDTicks,this.timerTicks,this.TACClocker,this.serialTimer,this.serialShiftTimer,this.serialShiftTimerAllocated,this.IRQEnableDelay,this.lastIteration,this.cMBC1,this.cMBC2,this.cMBC3,this.cMBC5,this.cMBC7,this.cSRAM,this.cMMMO1,this.cRUMBLE,this.cCamera,this.cTAMA5,this.cHuC3,this.cHuC1,this.drewBlank,this.fromTypedArray(this.frameBuffer),this.bgEnabled,this.BGPriorityEnabled,this.channel1FrequencyTracker,this.channel1FrequencyCounter,this.channel1totalLength,this.channel1envelopeVolume,this.channel1envelopeType,this.channel1envelopeSweeps,this.channel1envelopeSweepsLast,this.channel1consecutive,this.channel1frequency,this.channel1SweepFault,this.channel1ShadowFrequency,this.channel1timeSweep,this.channel1lastTimeSweep,this.channel1Swept,this.channel1frequencySweepDivider,this.channel1decreaseSweep,this.channel2FrequencyTracker,this.channel2FrequencyCounter,this.channel2totalLength,this.channel2envelopeVolume,this.channel2envelopeType,this.channel2envelopeSweeps,this.channel2envelopeSweepsLast,this.channel2consecutive,this.channel2frequency,this.channel3canPlay,this.channel3totalLength,this.channel3patternType,this.channel3frequency,this.channel3consecutive,this.fromTypedArray(this.channel3PCM),this.channel4FrequencyPeriod,this.channel4lastSampleLookup,this.channel4totalLength,this.channel4envelopeVolume,this.channel4currentVolume,this.channel4envelopeType,this.channel4envelopeSweeps,this.channel4envelopeSweepsLast,this.channel4consecutive,this.channel4BitRange,this.soundMasterEnabled,this.VinLeftChannelMasterVolume,this.VinRightChannelMasterVolume,this.leftChannel1,this.leftChannel2,this.leftChannel3,this.leftChannel4,this.rightChannel1,this.rightChannel2,this.rightChannel3,this.rightChannel4,this.channel1currentSampleLeft,this.channel1currentSampleRight,this.channel2currentSampleLeft,this.channel2currentSampleRight,this.channel3currentSampleLeft,this.channel3currentSampleRight,this.channel4currentSampleLeft,this.channel4currentSampleRight,this.channel1currentSampleLeftSecondary,this.channel1currentSampleRightSecondary,this.channel2currentSampleLeftSecondary,this.channel2currentSampleRightSecondary,this.channel3currentSampleLeftSecondary,this.channel3currentSampleRightSecondary,this.channel4currentSampleLeftSecondary,this.channel4currentSampleRightSecondary,this.channel1currentSampleLeftTrimary,this.channel1currentSampleRightTrimary,this.channel2currentSampleLeftTrimary,this.channel2currentSampleRightTrimary,this.mixerOutputCache,this.channel1DutyTracker,this.channel1CachedDuty,this.channel2DutyTracker,this.channel2CachedDuty,this.channel1Enabled,this.channel2Enabled,this.channel3Enabled,this.channel4Enabled,this.sequencerClocks,this.sequencePosition,this.channel3Counter,this.channel4Counter,this.cachedChannel3Sample,this.cachedChannel4Sample,this.channel3FrequencyPeriod,this.channel3lastSampleLookup,this.actualScanLine,this.lastUnrenderedLine,this.queuedScanLines,this.RTCisLatched,this.latchedSeconds,this.latchedMinutes,this.latchedHours,this.latchedLDays,this.latchedHDays,this.RTCSeconds,this.RTCMinutes,this.RTCHours,this.RTCDays,this.RTCDayOverFlow,this.RTCHALT,this.usedBootROM,this.skipPCIncrement,this.STATTracker,this.gbcRamBankPositionECHO,this.numRAMBanks,this.windowY,this.windowX,this.fromTypedArray(this.gbcOBJRawPalette),this.fromTypedArray(this.gbcBGRawPalette),this.fromTypedArray(this.gbOBJPalette),this.fromTypedArray(this.gbBGPalette),this.fromTypedArray(this.gbcOBJPalette),this.fromTypedArray(this.gbcBGPalette),this.fromTypedArray(this.gbBGColorizedPalette),this.fromTypedArray(this.gbOBJColorizedPalette),this.fromTypedArray(this.cachedBGPaletteConversion),this.fromTypedArray(this.cachedOBJPaletteConversion),this.fromTypedArray(this.BGCHRBank1),this.fromTypedArray(this.BGCHRBank2),this.haltPostClocks,this.interruptsRequested,this.interruptsEnabled,this.remainingClocks,this.colorizedGBPalettes,this.backgroundY,this.backgroundX,this.CPUStopped,this.audioClocksUntilNextEvent,this.audioClocksUntilNextEventCounter]},saving:function(e){var t=0,r=e.slice(0);this.ROM=this.toTypedArray(r[t++],"uint8"),this.ROMBankEdge=Math.floor(this.ROM.length/16384),this.inBootstrap=r[t++],this.registerA=r[t++],this.FZero=r[t++],this.FSubtract=r[t++],this.FHalfCarry=r[t++],this.FCarry=r[t++],this.registerB=r[t++],this.registerC=r[t++],this.registerD=r[t++],this.registerE=r[t++],this.registersHL=r[t++],this.stackPointer=r[t++],this.programCounter=r[t++],this.halt=r[t++],this.IME=r[t++],this.hdmaRunning=r[t++],this.CPUTicks=r[t++],this.doubleSpeedShifter=r[t++],this.memory=this.toTypedArray(r[t++],"uint8"),this.MBCRam=this.toTypedArray(r[t++],"uint8"),this.VRAM=this.toTypedArray(r[t++],"uint8"),this.currVRAMBank=r[t++],this.GBCMemory=this.toTypedArray(r[t++],"uint8"),this.MBC1Mode=r[t++],this.MBCRAMBanksEnabled=r[t++],this.currMBCRAMBank=r[t++],this.currMBCRAMBankPosition=r[t++],this.cGBC=r[t++],this.gbcRamBank=r[t++],this.gbcRamBankPosition=r[t++],this.ROMBank1offs=r[t++],this.currentROMBank=r[t++],this.cartridgeType=r[t++],this.name=r[t++],this.gameCode=r[t++],this.modeSTAT=r[t++],this.LYCMatchTriggerSTAT=r[t++],this.mode2TriggerSTAT=r[t++],this.mode1TriggerSTAT=r[t++],this.mode0TriggerSTAT=r[t++],this.LCDisOn=r[t++],this.gfxWindowCHRBankPosition=r[t++],this.gfxWindowDisplay=r[t++],this.gfxSpriteShow=r[t++],this.gfxSpriteNormalHeight=r[t++],this.gfxBackgroundCHRBankPosition=r[t++],this.gfxBackgroundBankOffset=r[t++],this.TIMAEnabled=r[t++],this.DIVTicks=r[t++],this.LCDTicks=r[t++],this.timerTicks=r[t++],this.TACClocker=r[t++],this.serialTimer=r[t++],this.serialShiftTimer=r[t++],this.serialShiftTimerAllocated=r[t++],this.IRQEnableDelay=r[t++],this.lastIteration=r[t++],this.cMBC1=r[t++],this.cMBC2=r[t++],this.cMBC3=r[t++],this.cMBC5=r[t++],this.cMBC7=r[t++],this.cSRAM=r[t++],this.cMMMO1=r[t++],this.cRUMBLE=r[t++],this.cCamera=r[t++],this.cTAMA5=r[t++],this.cHuC3=r[t++],this.cHuC1=r[t++],this.drewBlank=r[t++],this.frameBuffer=this.toTypedArray(r[t++],"int32"),this.bgEnabled=r[t++],this.BGPriorityEnabled=r[t++],this.channel1FrequencyTracker=r[t++],this.channel1FrequencyCounter=r[t++],this.channel1totalLength=r[t++],this.channel1envelopeVolume=r[t++],this.channel1envelopeType=r[t++],this.channel1envelopeSweeps=r[t++],this.channel1envelopeSweepsLast=r[t++],this.channel1consecutive=r[t++],this.channel1frequency=r[t++],this.channel1SweepFault=r[t++],this.channel1ShadowFrequency=r[t++],this.channel1timeSweep=r[t++],this.channel1lastTimeSweep=r[t++],this.channel1Swept=r[t++],this.channel1frequencySweepDivider=r[t++],this.channel1decreaseSweep=r[t++],this.channel2FrequencyTracker=r[t++],this.channel2FrequencyCounter=r[t++],this.channel2totalLength=r[t++],this.channel2envelopeVolume=r[t++],this.channel2envelopeType=r[t++],this.channel2envelopeSweeps=r[t++],this.channel2envelopeSweepsLast=r[t++],this.channel2consecutive=r[t++],this.channel2frequency=r[t++],this.channel3canPlay=r[t++],this.channel3totalLength=r[t++],this.channel3patternType=r[t++],this.channel3frequency=r[t++],this.channel3consecutive=r[t++],this.channel3PCM=this.toTypedArray(r[t++],"int8"),this.channel4FrequencyPeriod=r[t++],this.channel4lastSampleLookup=r[t++],this.channel4totalLength=r[t++],this.channel4envelopeVolume=r[t++],this.channel4currentVolume=r[t++],this.channel4envelopeType=r[t++],this.channel4envelopeSweeps=r[t++],this.channel4envelopeSweepsLast=r[t++],this.channel4consecutive=r[t++],this.channel4BitRange=r[t++],this.soundMasterEnabled=r[t++],this.VinLeftChannelMasterVolume=r[t++],this.VinRightChannelMasterVolume=r[t++],this.leftChannel1=r[t++],this.leftChannel2=r[t++],this.leftChannel3=r[t++],this.leftChannel4=r[t++],this.rightChannel1=r[t++],this.rightChannel2=r[t++],this.rightChannel3=r[t++],this.rightChannel4=r[t++],this.channel1currentSampleLeft=r[t++],this.channel1currentSampleRight=r[t++],this.channel2currentSampleLeft=r[t++],this.channel2currentSampleRight=r[t++],this.channel3currentSampleLeft=r[t++],this.channel3currentSampleRight=r[t++],this.channel4currentSampleLeft=r[t++],this.channel4currentSampleRight=r[t++],this.channel1currentSampleLeftSecondary=r[t++],this.channel1currentSampleRightSecondary=r[t++],this.channel2currentSampleLeftSecondary=r[t++],this.channel2currentSampleRightSecondary=r[t++],this.channel3currentSampleLeftSecondary=r[t++],this.channel3currentSampleRightSecondary=r[t++],this.channel4currentSampleLeftSecondary=r[t++],this.channel4currentSampleRightSecondary=r[t++],this.channel1currentSampleLeftTrimary=r[t++],this.channel1currentSampleRightTrimary=r[t++],this.channel2currentSampleLeftTrimary=r[t++],this.channel2currentSampleRightTrimary=r[t++],this.mixerOutputCache=r[t++],this.channel1DutyTracker=r[t++],this.channel1CachedDuty=r[t++],this.channel2DutyTracker=r[t++],this.channel2CachedDuty=r[t++],this.channel1Enabled=r[t++],this.channel2Enabled=r[t++],this.channel3Enabled=r[t++],this.channel4Enabled=r[t++],this.sequencerClocks=r[t++],this.sequencePosition=r[t++],this.channel3Counter=r[t++],this.channel4Counter=r[t++],this.cachedChannel3Sample=r[t++],this.cachedChannel4Sample=r[t++],this.channel3FrequencyPeriod=r[t++],this.channel3lastSampleLookup=r[t++],this.actualScanLine=r[t++],this.lastUnrenderedLine=r[t++],this.queuedScanLines=r[t++],this.RTCisLatched=r[t++],this.latchedSeconds=r[t++],this.latchedMinutes=r[t++],this.latchedHours=r[t++],this.latchedLDays=r[t++],this.latchedHDays=r[t++],this.RTCSeconds=r[t++],this.RTCMinutes=r[t++],this.RTCHours=r[t++],this.RTCDays=r[t++],this.RTCDayOverFlow=r[t++],this.RTCHALT=r[t++],this.usedBootROM=r[t++],this.skipPCIncrement=r[t++],this.STATTracker=r[t++],this.gbcRamBankPositionECHO=r[t++],this.numRAMBanks=r[t++],this.windowY=r[t++],this.windowX=r[t++],this.gbcOBJRawPalette=this.toTypedArray(r[t++],"uint8"),this.gbcBGRawPalette=this.toTypedArray(r[t++],"uint8"),this.gbOBJPalette=this.toTypedArray(r[t++],"int32"),this.gbBGPalette=this.toTypedArray(r[t++],"int32"),this.gbcOBJPalette=this.toTypedArray(r[t++],"int32"),this.gbcBGPalette=this.toTypedArray(r[t++],"int32"),this.gbBGColorizedPalette=this.toTypedArray(r[t++],"int32"),this.gbOBJColorizedPalette=this.toTypedArray(r[t++],"int32"),this.cachedBGPaletteConversion=this.toTypedArray(r[t++],"int32"),this.cachedOBJPaletteConversion=this.toTypedArray(r[t++],"int32"),this.BGCHRBank1=this.toTypedArray(r[t++],"uint8"),this.BGCHRBank2=this.toTypedArray(r[t++],"uint8"),this.haltPostClocks=r[t++],this.interruptsRequested=r[t++],this.interruptsEnabled=r[t++],this.checkIRQMatching(),this.remainingClocks=r[t++],this.colorizedGBPalettes=r[t++],this.backgroundY=r[t++],this.backgroundX=r[t++],this.CPUStopped=r[t++],this.audioClocksUntilNextEvent=r[t++],this.audioClocksUntilNextEventCounter=r[t],this.fromSaveState=!0,this.TICKTable=this.toTypedArray(this.TICKTable,"uint8"),this.SecondaryTICKTable=this.toTypedArray(this.SecondaryTICKTable,"uint8"),this.initializeReferencesFromSaveState(),this.memoryReadJumpCompile(),this.memoryWriteJumpCompile(),this.initLCD(),this.initSound(),this.noiseSampleTable=32767==this.channel4BitRange?this.LSFR15Table:this.LSFR7Table,this.channel4VolumeShifter=32767==this.channel4BitRange?15:7},saveSRAMState:function(){return this.cBATT&&0!=this.MBCRam.length?this.fromTypedArray(this.MBCRam):[]//No bettery backup...
},saveRTCState:function(){return this.cTIMER?[this.lastIteration,this.RTCisLatched,this.latchedSeconds,this.latchedMinutes,this.latchedHours,this.latchedLDays,this.latchedHDays,this.RTCSeconds,this.RTCMinutes,this.RTCHours,this.RTCDays,this.RTCDayOverFlow,this.RTCHALT]:[]//No battery backup
}},M.prototype.returnFromRTCState=function(){if("function"==typeof this.openRTC&&this.cTIMER){var e=this.openRTC(this.name),t=0;this.lastIteration=e[t++],this.RTCisLatched=e[t++],this.latchedSeconds=e[t++],this.latchedMinutes=e[t++],this.latchedHours=e[t++],this.latchedLDays=e[t++],this.latchedHDays=e[t++],this.RTCSeconds=e[t++],this.RTCMinutes=e[t++],this.RTCHours=e[t++],this.RTCDays=e[t++],this.RTCDayOverFlow=e[t++],this.RTCHALT=e[t]}},M.prototype.start=function(){this.initMemory(),this.ROMLoad(),this.initLCD(),this.initSound(),this.run()},M.prototype.initMemory=function(){//Initialize the RAM:
this.memory=this.getTypedArray(65536,0,"uint8"),this.frameBuffer=this.getTypedArray(23040,16316664,"int32"),this.BGCHRBank1=this.getTypedArray(2048,0,"uint8"),this.TICKTable=this.toTypedArray(this.TICKTable,"uint8"),this.SecondaryTICKTable=this.toTypedArray(this.SecondaryTICKTable,"uint8"),this.channel3PCM=this.getTypedArray(32,0,"int8")},M.prototype.generateCacheArray=function(e){for(var t=[],r=0;r<e;)t[r++]=this.getTypedArray(64,0,"uint8");return t},M.prototype.initSkipBootstrap=function(){for(//Fill in the boot ROM set register values
//Default values to the GB boot ROM values, then fill in the GBC boot ROM values after ROM loading
var e=255;e>=0;){if(e>=48&&e<64)this.memoryWrite(65280|e,this.ffxxDump[e]);else switch(e){case 0:case 1:case 2:case 5:case 7:case 15:case 255:this.memoryWrite(65280|e,this.ffxxDump[e]);break;default:this.memory[65280|e]=this.ffxxDump[e]}--e}this.cGBC?(this.memory[65388]=254,this.memory[65396]=254):(this.memory[65352]=255,this.memory[65353]=255,this.memory[65388]=255,this.memory[65396]=255),this.registerA=this.cGBC?17:1,this.registerB=0,this.registerC=19,this.registerD=0,this.registerE=216,this.FZero=!0,this.FSubtract=!1,this.FHalfCarry=!0,this.FCarry=!0,this.registersHL=333,this.LCDCONTROL=this.LINECONTROL,this.IME=!1,this.IRQLineMatched=0,this.interruptsRequested=225,this.interruptsEnabled=0,this.hdmaRunning=!1,this.CPUTicks=12,this.STATTracker=0,this.modeSTAT=1,this.spriteCount=252,this.LYCMatchTriggerSTAT=!1,this.mode2TriggerSTAT=!1,this.mode1TriggerSTAT=!1,this.mode0TriggerSTAT=!1,this.LCDisOn=!0,this.channel1FrequencyTracker=8192,this.channel1DutyTracker=0,this.channel1CachedDuty=this.dutyLookup[2],this.channel1totalLength=0,this.channel1envelopeVolume=0,this.channel1envelopeType=!1,this.channel1envelopeSweeps=0,this.channel1envelopeSweepsLast=0,this.channel1consecutive=!0,this.channel1frequency=1985,this.channel1SweepFault=!0,this.channel1ShadowFrequency=1985,this.channel1timeSweep=1,this.channel1lastTimeSweep=0,this.channel1Swept=!1,this.channel1frequencySweepDivider=0,this.channel1decreaseSweep=!1,this.channel2FrequencyTracker=8192,this.channel2DutyTracker=0,this.channel2CachedDuty=this.dutyLookup[2],this.channel2totalLength=0,this.channel2envelopeVolume=0,this.channel2envelopeType=!1,this.channel2envelopeSweeps=0,this.channel2envelopeSweepsLast=0,this.channel2consecutive=!0,this.channel2frequency=0,this.channel3canPlay=!1,this.channel3totalLength=0,this.channel3patternType=4,this.channel3frequency=0,this.channel3consecutive=!0,this.channel3Counter=1048,this.channel4FrequencyPeriod=8,this.channel4totalLength=0,this.channel4envelopeVolume=0,this.channel4currentVolume=0,this.channel4envelopeType=!1,this.channel4envelopeSweeps=0,this.channel4envelopeSweepsLast=0,this.channel4consecutive=!0,this.channel4BitRange=32767,this.channel4VolumeShifter=15,this.channel1FrequencyCounter=512,this.channel2FrequencyCounter=512,this.channel3Counter=2048,this.channel3FrequencyPeriod=2048,this.channel3lastSampleLookup=0,this.channel4lastSampleLookup=0,this.VinLeftChannelMasterVolume=8,this.VinRightChannelMasterVolume=8,this.soundMasterEnabled=!0,this.leftChannel1=!0,this.leftChannel2=!0,this.leftChannel3=!0,this.leftChannel4=!0,this.rightChannel1=!0,this.rightChannel2=!0,this.rightChannel3=!1,this.rightChannel4=!1,this.DIVTicks=27044,this.LCDTicks=160,this.timerTicks=0,this.TIMAEnabled=!1,this.TACClocker=1024,this.serialTimer=0,this.serialShiftTimer=0,this.serialShiftTimerAllocated=0,this.IRQEnableDelay=0,this.actualScanLine=144,this.lastUnrenderedLine=0,this.gfxWindowDisplay=!1,this.gfxSpriteShow=!1,this.gfxSpriteNormalHeight=!0,this.bgEnabled=!0,this.BGPriorityEnabled=!0,this.gfxWindowCHRBankPosition=0,this.gfxBackgroundCHRBankPosition=0,this.gfxBackgroundBankOffset=0,this.windowY=0,this.windowX=0,this.drewBlank=0,this.midScanlineOffset=-1,this.currentX=0},M.prototype.initBootstrap=function(){this.programCounter=0,this.stackPointer=0,this.IME=!1,this.LCDTicks=0,this.DIVTicks=0,this.registerA=0,this.registerB=0,this.registerC=0,this.registerD=0,this.registerE=0,this.FZero=this.FSubtract=this.FHalfCarry=this.FCarry=!1,this.registersHL=0,this.leftChannel1=!1,this.leftChannel2=!1,this.leftChannel3=!1,this.leftChannel4=!1,this.rightChannel1=!1,this.rightChannel2=!1,this.rightChannel3=!1,this.rightChannel4=!1,this.channel2frequency=this.channel1frequency=0,this.channel4consecutive=this.channel2consecutive=this.channel1consecutive=!1,this.VinLeftChannelMasterVolume=8,this.VinRightChannelMasterVolume=8,this.memory[65280]=15},M.prototype.ROMLoad=function(){//Load the first two ROM banks (0x0000 - 0x7FFF) into regular gameboy memory:
this.ROM=[],this.usedBootROM=A[1]&&(!A[11]&&2048==this.GBCBOOTROM.length||A[11]&&256==this.GBBOOTROM.length);var e=this.ROMImage.length;if(e<16384)throw Error("ROM image size too small.");this.ROM=this.getTypedArray(e,0,"uint8");var t=0;if(this.usedBootROM){if(A[11]){if(this.ROMImageIsString)for(;t<256;++t)this.memory[t]=this.GBBOOTROM[t],this.ROM[t]=255&this.ROMImage.charCodeAt(t);else for(;t<256;++t)this.memory[t]=this.GBBOOTROM[t],this.ROM[t]=this.ROMImage.romIndex}else{//Patch in the GBC boot ROM into the memory map:
if(this.ROMImageIsString){for(;t<256;++t)this.memory[t]=this.GBCBOOTROM[t],this.ROM[t]=255&this.ROMImage.charCodeAt(t);for(;t<512;++t)this.memory[t]=this.ROM[t]=255&this.ROMImage.charCodeAt(t);//Load in the game ROM.
for(;t<2304;++t)this.memory[t]=this.GBCBOOTROM[t-256],this.ROM[t]=255&this.ROMImage.charCodeAt(t)}else{for(;t<256;++t)this.memory[t]=this.GBCBOOTROM[t],this.ROM[t]=this.ROMImage[t];for(;t<512;++t)this.memory[t]=this.ROM[t]=this.ROMImage[t];//Load in the game ROM.
for(;t<2304;++t)this.memory[t]=this.GBCBOOTROM[t-256],this.ROM[t]=this.ROMImage[t]}this.usedGBCBootROM=!0}if(this.ROMImageIsString)for(;t<16384;++t)this.memory[t]=this.ROM[t]=255&this.ROMImage.charCodeAt(t);//Load in the game ROM.
else for(;t<16384;++t)this.memory[t]=this.ROM[t]=this.ROMImage[t];//Load in the game ROM.
}else if(this.ROMImageIsString)for(;t<16384;++t)this.memory[t]=this.ROM[t]=255&this.ROMImage.charCodeAt(t);//Load in the game ROM.
else for(;t<16384;++t)this.memory[t]=this.ROM[t]=this.ROMImage[t];//Load in the game ROM.
//Finish the decoding of the ROM binary:
if(this.ROMImageIsString)for(;t<e;++t)this.ROM[t]=255&this.ROMImage.charCodeAt(t);else for(;t<e;++t)this.ROM[t]=this.ROMImage[t];this.ROMBankEdge=Math.floor(this.ROM.length/16384),//Set up the emulator for the cartidge specifics:
this.interpretCartridge(),//Check for IRQ matching upon initialization:
this.checkIRQMatching()},M.prototype.getROMImage=function(){//Return the binary version of the ROM image currently running:
if(this.ROMImage.length>0)return this.ROMImage.length;for(var e=this.ROM.length,t=0;t<e;t++)this.ROMImage+=String.fromCharCode(this.ROM[t]);return this.ROMImage},M.prototype.interpretCartridge=function(){if(this.ROMImageIsString){// ROM name
for(var e=308;e<319;e++)this.ROMImage[e]>0&&(this.name+=this.ROMImage[e]);// ROM game code (for newer games)
for(var e=319;e<323;e++)this.ROMImage[e]>0&&(this.gameCode+=this.ROMImage[e]);this.ROMImage[323]}else{// ROM name
for(var e=308;e<319;e++)this.ROMImage[e]>0&&(this.name+=String.fromCharCode(this.ROMImage[e]));// ROM game code (for newer games)
for(var e=319;e<323;e++)this.ROMImage[e]>0&&(this.gameCode+=String.fromCharCode(this.ROMImage[e]));String.fromCharCode(this.ROMImage[323])}// You don't want extra output, do you?
// console.log("Game Title: " + this.name + "[" + this.gameCode + "][" + this.ROMImage[0x143] + "]");
// Cartridge type
this.cartridgeType=this.ROM[327];switch(this.cartridgeType){case 0://ROM w/o bank switching
if(!A[9])break;case 1:this.cMBC1=!0;break;case 2:this.cMBC1=!0,this.cSRAM=!0;break;case 3:this.cMBC1=!0,this.cSRAM=!0,this.cBATT=!0;break;case 5:this.cMBC2=!0;break;case 6:this.cMBC2=!0,this.cBATT=!0;break;case 8:this.cSRAM=!0;break;case 9:this.cSRAM=!0,this.cBATT=!0;break;case 11:this.cMMMO1=!0;break;case 12:this.cMMMO1=!0,this.cSRAM=!0;break;case 13:this.cMMMO1=!0,this.cSRAM=!0,this.cBATT=!0;break;case 15:this.cMBC3=!0,this.cTIMER=!0,this.cBATT=!0;break;case 16:this.cMBC3=!0,this.cTIMER=!0,this.cBATT=!0,this.cSRAM=!0;break;case 17:this.cMBC3=!0;break;case 18:this.cMBC3=!0,this.cSRAM=!0;break;case 19:this.cMBC3=!0,this.cSRAM=!0,this.cBATT=!0;break;case 25:this.cMBC5=!0;break;case 26:this.cMBC5=!0,this.cSRAM=!0;break;case 27:this.cMBC5=!0,this.cSRAM=!0,this.cBATT=!0;break;case 28:this.cRUMBLE=!0;break;case 29:this.cRUMBLE=!0,this.cSRAM=!0;break;case 30:this.cRUMBLE=!0,this.cSRAM=!0,this.cBATT=!0;break;case 31:this.cCamera=!0;break;case 34:this.cMBC7=!0,this.cSRAM=!0,this.cBATT=!0;break;case 253:this.cTAMA5=!0;break;case 254:this.cHuC3=!0;break;case 255:this.cHuC1=!0;break;default:console.log("Cartridge type is unknown.")}//Check the GB/GBC mode byte:
if(// ROM and RAM banks
this.numROMBanks=this.ROMBanks[this.ROM[328]],this.numROMBanks,this.RAMBanks[this.ROM[329]],this.usedBootROM)this.cGBC=this.usedGBCBootROM,this.setupRAM(),this.initBootstrap();else{switch(this.ROM[323]){case 0:this.cGBC=!1;break;case 50:A[2]||this.name+this.gameCode+this.ROM[323]!="Game and Watch 50"?this.cGBC=!1:this.cGBC=!0;break;case 128:this.cGBC=!A[2];break;case 192:this.cGBC=!0;break;default:this.cGBC=!1,this.ROM[323]}this.inBootstrap=!1,this.setupRAM(),this.initSkipBootstrap()}this.initializeModeSpecificArrays(),this.ROM[331],this.ROM[324],this.ROM[325],this.ROMImage=""},M.prototype.disableBootROM=function(){//Remove any traces of the boot ROM from ROM memory.
for(var e=0;e<256;++e)this.memory[e]=this.ROM[e];//Replace the GameBoy or GameBoy Color boot ROM with the game ROM.
if(this.usedGBCBootROM){//Remove any traces of the boot ROM from ROM memory.
for(e=512;e<2304;++e)this.memory[e]=this.ROM[e];//Replace the GameBoy Color boot ROM with the game ROM.
this.cGBC?this.recompileBootIOWriteHandling():this.GBCtoGBModeAdjust()}else this.recompileBootIOWriteHandling()},M.prototype.initializeTiming=function(){//Emulator Timing:
this.clocksPerSecond=4194304*this.emulatorSpeed,this.baseCPUCyclesPerIteration=this.clocksPerSecond/1e3*A[6],this.CPUCyclesTotalRoundoff=this.baseCPUCyclesPerIteration%4,this.CPUCyclesTotalBase=this.CPUCyclesTotal=this.baseCPUCyclesPerIteration-this.CPUCyclesTotalRoundoff|0,this.CPUCyclesTotalCurrent=0},M.prototype.setSpeed=function(e){this.emulatorSpeed=e,this.initializeTiming(),this.audioHandle&&this.initSound()},M.prototype.setupRAM=function(){if(this.cMBC2?this.numRAMBanks=1/16:this.cMBC1||this.cRUMBLE||this.cMBC3||this.cHuC3?this.numRAMBanks=4:this.cMBC5?this.numRAMBanks=16:this.cSRAM&&(this.numRAMBanks=1),this.numRAMBanks>0){this.MBCRAMUtilized()||(this.MBCRAMBanksEnabled=!0);//Switched RAM Used
var e="function"==typeof this.openMBC?this.openMBC(this.name):[];e.length>0?this.MBCRam=this.toTypedArray(e,"uint8"):this.MBCRam=this.getTypedArray(8192*this.numRAMBanks,0,"uint8")}this.numRAMBanks,this.returnFromRTCState(),this.cGBC&&(this.VRAM=this.getTypedArray(8192,0,"uint8"),this.GBCMemory=this.getTypedArray(28672,0,"uint8")),this.memoryReadJumpCompile(),this.memoryWriteJumpCompile()},M.prototype.MBCRAMUtilized=function(){return this.cMBC1||this.cMBC2||this.cMBC3||this.cMBC5||this.cMBC7||this.cRUMBLE},M.prototype.recomputeDimension=function(){//Cache some dimension info:
this.onscreenWidth=160,this.onscreenHeight=144,this.offscreenWidth=160,this.offscreenHeight=144,this.offscreenRGBCount=this.offscreenWidth*this.offscreenHeight*4},M.prototype.initLCD=function(){this.recomputeDimension(),92160!=this.offscreenRGBCount?this.compileResizeFrameBufferFunction():this.resizer=null;try{this.canvasBuffer={data:new Uint8ClampedArray(92160),height:144,width:160};//Taking canvas out of the picture.
//this.canvasBuffer = this.drawContextOffScreen.createImageData(144, 160);
//this.canvasBuffer.prototype = ImageData;
//new ImageData(160, 144);//{'width':160, 'height':144, 'data':new Array(160*144*4)};//this.drawContextOffscreen.createImageData(this.offscreenWidth, this.offscreenHeight);
}catch(e){console.log("hack failed: "+e.message+": falling back to getImageData initialization");//cout("Falling back to the getImageData initialization (Error \"" + error.message + "\").", 1);
//this.canvasBuffer = this.drawContextOffscreen.getImageData(0, 0, this.offscreenWidth, this.offscreenHeight);
}for(var e=this.offscreenRGBCount;e>0;)this.canvasBuffer.data[e-=4]=248,this.canvasBuffer.data[e+1]=248,this.canvasBuffer.data[e+2]=248,this.canvasBuffer.data[e+3]=255;null==this.swizzledFrame&&(this.swizzledFrame=this.getTypedArray(69120,255,"uint8")),//Test the draw system and browser vblank latching:
this.drewFrame=!0,this.requestDraw()},//I think I'm just copying out framebuffer.  So maybe I dont' need to do anything?
M.prototype.graphicsBlit=function(){this.currentScreenFixed||(this.currentScreenFixed=[]),this.lastScreen=this.currentScreenFixed,this.currentScreen=[],this.partialScreen=[];for(var e=0;e<this.canvasBuffer.data.length;e++)this.lastScreen[e]!=this.canvasBuffer.data[e]&&(this.partialScreen.push(e),this.partialScreen.push(this.canvasBuffer.data[e])),//Build full frame.
this.currentScreenFixed[e]=this.canvasBuffer.data[e],//this.currentScreen.push(i);
this.currentScreen.push(this.canvasBuffer.data[e])},M.prototype.JoyPadEvent=function(e,t){t?(this.JoyPad&=255^1<<e,this.cGBC||this.usedBootROM&&this.usedGBCBootROM||(this.interruptsRequested|=16,this.remainingClocks=0,this.checkIRQMatching())):this.JoyPad|=1<<e,this.memory[65280]=(48&this.memory[65280])+(((32&this.memory[65280])==0?this.JoyPad>>4:15)&((16&this.memory[65280])==0?15&this.JoyPad:15)),this.CPUStopped=!1},M.prototype.GyroEvent=function(e,t){e*=-100,e+=2047,this.highX=e>>8,this.lowX=255&e,t*=-100,t+=2047,this.highY=t>>8,this.lowY=255&t},M.prototype.initSound=function(){this.audioResamplerFirstPassFactor=Math.max(Math.min(Math.floor(this.clocksPerSecond/44100),Math.floor(136.53125)),1),this.downSampleInputDivider=1/(240*this.audioResamplerFirstPassFactor),A[0]?//     2,
//     this.clocksPerSecond / this.audioResamplerFirstPassFactor,
//     0,
//     Math.max(this.baseCPUCyclesPerIteration * settings[8] / this.audioResamplerFirstPassFactor, 8192) << 1,
//     null,
//     settings[3],
//     function () {
//         settings[0] = false;
//     });
// console.log('Initializing Audio Buffer:');
// console.log(`Sample Rate: ${ this.clocksPerSecond / this.audioResamplerFirstPassFactor }`);
// console.log(`Max Buffer Size: ${ Math.max(this.baseCPUCyclesPerIteration * settings[8] / this.audioResamplerFirstPassFactor, 8192) << 1 }`);
this.initAudioBuffer():this.audioHandle&&this.audioHandle.changeVolume(0)},M.prototype.changeVolume=function(){A[0]&&this.audioHandle&&this.audioHandle.changeVolume(A[3])},M.prototype.initAudioBuffer=function(){this.audioIndex=0,this.audioDestinationPosition=0,this.downsampleInput=0,this.bufferContainAmount=Math.max(this.baseCPUCyclesPerIteration*A[7]/this.audioResamplerFirstPassFactor,4096)<<1,this.numSamplesTotal=this.baseCPUCyclesPerIteration/this.audioResamplerFirstPassFactor<<1,this.audioBuffer=this.getTypedArray(this.numSamplesTotal,0,"float32")},M.prototype.intializeWhiteNoise=function(){//Noise Sample Tables:
var e=1;//15-bit LSFR Cache Generation:
this.LSFR15Table=this.getTypedArray(524288,0,"int8");for(var t=32767,r=16383,i=0;i<32768;++i)//Normalize the last LSFR value for usage:
e=1-(1&t),//Cache the different volume level results:
this.LSFR15Table[32768|i]=e,this.LSFR15Table[65536|i]=2*e,this.LSFR15Table[98304|i]=3*e,this.LSFR15Table[131072|i]=4*e,this.LSFR15Table[163840|i]=5*e,this.LSFR15Table[196608|i]=6*e,this.LSFR15Table[229376|i]=7*e,this.LSFR15Table[262144|i]=8*e,this.LSFR15Table[294912|i]=9*e,this.LSFR15Table[327680|i]=10*e,this.LSFR15Table[360448|i]=11*e,this.LSFR15Table[393216|i]=12*e,this.LSFR15Table[425984|i]=13*e,this.LSFR15Table[458752|i]=14*e,this.LSFR15Table[491520|i]=15*e,t=//Recompute the LSFR algorithm:
(r=t>>1)|((r^t)&1)<<14;for(i=0,//7-bit LSFR Cache Generation:
this.LSFR7Table=this.getTypedArray(2048,0,"int8"),t=127;i<128;++i)//Normalize the last LSFR value for usage:
e=1-(1&t),//Cache the different volume level results:
this.LSFR7Table[128|i]=e,this.LSFR7Table[256|i]=2*e,this.LSFR7Table[384|i]=3*e,this.LSFR7Table[512|i]=4*e,this.LSFR7Table[640|i]=5*e,this.LSFR7Table[768|i]=6*e,this.LSFR7Table[896|i]=7*e,this.LSFR7Table[1024|i]=8*e,this.LSFR7Table[1152|i]=9*e,this.LSFR7Table[1280|i]=10*e,this.LSFR7Table[1408|i]=11*e,this.LSFR7Table[1536|i]=12*e,this.LSFR7Table[1664|i]=13*e,this.LSFR7Table[1792|i]=14*e,this.LSFR7Table[1920|i]=15*e,t=//Recompute the LSFR algorithm:
(r=t>>1)|((r^t)&1)<<6;//Set the default noise table:
this.noiseSampleTable=this.LSFR15Table},M.prototype.audioUnderrunAdjustment=function(){A[0]},M.prototype.initializeAudioStartState=function(){this.channel1FrequencyTracker=8192,this.channel1DutyTracker=0,this.channel1CachedDuty=this.dutyLookup[2],this.channel1totalLength=0,this.channel1envelopeVolume=0,this.channel1envelopeType=!1,this.channel1envelopeSweeps=0,this.channel1envelopeSweepsLast=0,this.channel1consecutive=!0,this.channel1frequency=0,this.channel1SweepFault=!1,this.channel1ShadowFrequency=0,this.channel1timeSweep=1,this.channel1lastTimeSweep=0,this.channel1Swept=!1,this.channel1frequencySweepDivider=0,this.channel1decreaseSweep=!1,this.channel2FrequencyTracker=8192,this.channel2DutyTracker=0,this.channel2CachedDuty=this.dutyLookup[2],this.channel2totalLength=0,this.channel2envelopeVolume=0,this.channel2envelopeType=!1,this.channel2envelopeSweeps=0,this.channel2envelopeSweepsLast=0,this.channel2consecutive=!0,this.channel2frequency=0,this.channel3canPlay=!1,this.channel3totalLength=0,this.channel3patternType=4,this.channel3frequency=0,this.channel3consecutive=!0,this.channel3Counter=2048,this.channel4FrequencyPeriod=8,this.channel4totalLength=0,this.channel4envelopeVolume=0,this.channel4currentVolume=0,this.channel4envelopeType=!1,this.channel4envelopeSweeps=0,this.channel4envelopeSweepsLast=0,this.channel4consecutive=!0,this.channel4BitRange=32767,this.noiseSampleTable=this.LSFR15Table,this.channel4VolumeShifter=15,this.channel1FrequencyCounter=8192,this.channel2FrequencyCounter=8192,this.channel3Counter=2048,this.channel3FrequencyPeriod=2048,this.channel3lastSampleLookup=0,this.channel4lastSampleLookup=0,this.VinLeftChannelMasterVolume=8,this.VinRightChannelMasterVolume=8,this.mixerOutputCache=0,this.sequencerClocks=8192,this.sequencePosition=0,this.channel4FrequencyPeriod=8,this.channel4Counter=8,this.cachedChannel3Sample=0,this.cachedChannel4Sample=0,this.channel1Enabled=!1,this.channel2Enabled=!1,this.channel3Enabled=!1,this.channel4Enabled=!1,this.channel1canPlay=!1,this.channel2canPlay=!1,this.channel4canPlay=!1,this.audioClocksUntilNextEvent=1,this.audioClocksUntilNextEventCounter=1,this.channel1OutputLevelCache(),this.channel2OutputLevelCache(),this.channel3OutputLevelCache(),this.channel4OutputLevelCache(),this.noiseSampleTable=this.LSFR15Table},M.prototype.outputAudio=function(){this.audioBuffer[this.audioDestinationPosition++]=(this.downsampleInput>>>16)*this.downSampleInputDivider-1,this.audioBuffer[this.audioDestinationPosition++]=(65535&this.downsampleInput)*this.downSampleInputDivider-1,this.audioDestinationPosition==this.numSamplesTotal&&(this.audioDestinationPosition=0),this.downsampleInput=0},//Below are the audio generation functions timed against the CPU:
M.prototype.generateAudio=function(e){var t=0;if(this.soundMasterEnabled&&!this.CPUStopped)for(var r=0;e>0;){for(r=Math.min(this.audioClocksUntilNextEventCounter,this.sequencerClocks,e),this.audioClocksUntilNextEventCounter-=r,this.sequencerClocks-=r,e-=r;r>0;)t=Math.min(r,this.audioResamplerFirstPassFactor-this.audioIndex),r-=t,this.audioIndex+=t,this.downsampleInput+=this.mixerOutputCache*t,this.audioIndex==this.audioResamplerFirstPassFactor&&(this.audioIndex=0,this.outputAudio());0==this.sequencerClocks&&(this.audioComputeSequencer(),this.sequencerClocks=8192),0==this.audioClocksUntilNextEventCounter&&this.computeAudioChannels()}else for(;e>0;)t=Math.min(e,this.audioResamplerFirstPassFactor-this.audioIndex),e-=t,this.audioIndex+=t,this.audioIndex==this.audioResamplerFirstPassFactor&&(this.audioIndex=0,this.outputAudio())},//Generate audio, but don't actually output it (Used for when sound is disabled by user/browser):
M.prototype.generateAudioFake=function(e){if(this.soundMasterEnabled&&!this.CPUStopped)for(var t=0;e>0;)t=Math.min(this.audioClocksUntilNextEventCounter,this.sequencerClocks,e),this.audioClocksUntilNextEventCounter-=t,this.sequencerClocks-=t,e-=t,0==this.sequencerClocks&&(this.audioComputeSequencer(),this.sequencerClocks=8192),0==this.audioClocksUntilNextEventCounter&&this.computeAudioChannels()},M.prototype.audioJIT=function(){A[0]?this.generateAudio(this.audioTicks):this.generateAudioFake(this.audioTicks),this.audioTicks=0},M.prototype.audioComputeSequencer=function(){switch(this.sequencePosition++){case 0:case 4:this.clockAudioLength();break;case 2:case 6:this.clockAudioLength(),this.clockAudioSweep();break;case 7:this.clockAudioEnvelope(),this.sequencePosition=0}},M.prototype.clockAudioLength=function(){this.channel1totalLength>1?--this.channel1totalLength:1==this.channel1totalLength&&(this.channel1totalLength=0,this.channel1EnableCheck(),this.memory[65318]&=254),this.channel2totalLength>1?--this.channel2totalLength:1==this.channel2totalLength&&(this.channel2totalLength=0,this.channel2EnableCheck(),this.memory[65318]&=253),this.channel3totalLength>1?--this.channel3totalLength:1==this.channel3totalLength&&(this.channel3totalLength=0,this.channel3EnableCheck(),this.memory[65318]&=251),this.channel4totalLength>1?--this.channel4totalLength:1==this.channel4totalLength&&(this.channel4totalLength=0,this.channel4EnableCheck(),this.memory[65318]&=247)},M.prototype.clockAudioSweep=function(){//Channel 1:
!this.channel1SweepFault&&this.channel1timeSweep>0&&0==--this.channel1timeSweep&&this.runAudioSweep()},M.prototype.runAudioSweep=function(){//Channel 1:
this.channel1lastTimeSweep>0&&(this.channel1frequencySweepDivider>0?(this.channel1Swept=!0,this.channel1decreaseSweep?(this.channel1ShadowFrequency-=this.channel1ShadowFrequency>>this.channel1frequencySweepDivider,this.channel1frequency=2047&this.channel1ShadowFrequency,this.channel1FrequencyTracker=2048-this.channel1frequency<<2):(this.channel1ShadowFrequency+=this.channel1ShadowFrequency>>this.channel1frequencySweepDivider,this.channel1frequency=this.channel1ShadowFrequency,this.channel1ShadowFrequency<=2047?(this.channel1FrequencyTracker=2048-this.channel1frequency<<2,this.channel1ShadowFrequency+(this.channel1ShadowFrequency>>this.channel1frequencySweepDivider)>2047&&(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)):(this.channel1frequency&=2047,this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)),this.channel1timeSweep=this.channel1lastTimeSweep):(//Channel has sweep disabled and timer becomes a length counter:
this.channel1SweepFault=!0,this.channel1EnableCheck()))},M.prototype.channel1AudioSweepPerformDummy=function(){//Channel 1:
if(this.channel1frequencySweepDivider>0&&!this.channel1decreaseSweep){var e=this.channel1ShadowFrequency+(this.channel1ShadowFrequency>>this.channel1frequencySweepDivider);e<=2047?e+(e>>this.channel1frequencySweepDivider)>2047&&(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254):(this.channel1SweepFault=!0,this.channel1EnableCheck(),this.memory[65318]&=254)}},M.prototype.clockAudioEnvelope=function(){this.channel1envelopeSweepsLast>-1&&(this.channel1envelopeSweeps>0?--this.channel1envelopeSweeps:this.channel1envelopeType?this.channel1envelopeVolume<15?(++this.channel1envelopeVolume,this.channel1envelopeSweeps=this.channel1envelopeSweepsLast,this.channel1OutputLevelCache()):this.channel1envelopeSweepsLast=-1:this.channel1envelopeVolume>0?(--this.channel1envelopeVolume,this.channel1envelopeSweeps=this.channel1envelopeSweepsLast,this.channel1OutputLevelCache()):this.channel1envelopeSweepsLast=-1),this.channel2envelopeSweepsLast>-1&&(this.channel2envelopeSweeps>0?--this.channel2envelopeSweeps:this.channel2envelopeType?this.channel2envelopeVolume<15?(++this.channel2envelopeVolume,this.channel2envelopeSweeps=this.channel2envelopeSweepsLast,this.channel2OutputLevelCache()):this.channel2envelopeSweepsLast=-1:this.channel2envelopeVolume>0?(--this.channel2envelopeVolume,this.channel2envelopeSweeps=this.channel2envelopeSweepsLast,this.channel2OutputLevelCache()):this.channel2envelopeSweepsLast=-1),this.channel4envelopeSweepsLast>-1&&(this.channel4envelopeSweeps>0?--this.channel4envelopeSweeps:this.channel4envelopeType?this.channel4envelopeVolume<15?(this.channel4currentVolume=++this.channel4envelopeVolume<<this.channel4VolumeShifter,this.channel4envelopeSweeps=this.channel4envelopeSweepsLast,this.channel4UpdateCache()):this.channel4envelopeSweepsLast=-1:this.channel4envelopeVolume>0?(this.channel4currentVolume=--this.channel4envelopeVolume<<this.channel4VolumeShifter,this.channel4envelopeSweeps=this.channel4envelopeSweepsLast,this.channel4UpdateCache()):this.channel4envelopeSweepsLast=-1)},M.prototype.computeAudioChannels=function(){//Clock down the four audio channels to the next closest audio event:
this.channel1FrequencyCounter-=this.audioClocksUntilNextEvent,this.channel2FrequencyCounter-=this.audioClocksUntilNextEvent,this.channel3Counter-=this.audioClocksUntilNextEvent,this.channel4Counter-=this.audioClocksUntilNextEvent,0==this.channel1FrequencyCounter&&(this.channel1FrequencyCounter=this.channel1FrequencyTracker,this.channel1DutyTracker=this.channel1DutyTracker+1&7,this.channel1OutputLevelTrimaryCache()),0==this.channel2FrequencyCounter&&(this.channel2FrequencyCounter=this.channel2FrequencyTracker,this.channel2DutyTracker=this.channel2DutyTracker+1&7,this.channel2OutputLevelTrimaryCache()),0==this.channel3Counter&&(this.channel3canPlay&&(this.channel3lastSampleLookup=this.channel3lastSampleLookup+1&31),this.channel3Counter=this.channel3FrequencyPeriod,this.channel3UpdateCache()),0==this.channel4Counter&&(this.channel4lastSampleLookup=this.channel4lastSampleLookup+1&this.channel4BitRange,this.channel4Counter=this.channel4FrequencyPeriod,this.channel4UpdateCache()),//Find the number of clocks to next closest counter event:
this.audioClocksUntilNextEventCounter=this.audioClocksUntilNextEvent=Math.min(this.channel1FrequencyCounter,this.channel2FrequencyCounter,this.channel3Counter,this.channel4Counter)},M.prototype.channel1EnableCheck=function(){this.channel1Enabled=(this.channel1consecutive||this.channel1totalLength>0)&&!this.channel1SweepFault&&this.channel1canPlay,this.channel1OutputLevelSecondaryCache()},M.prototype.channel1VolumeEnableCheck=function(){this.channel1canPlay=this.memory[65298]>7,this.channel1EnableCheck(),this.channel1OutputLevelSecondaryCache()},M.prototype.channel1OutputLevelCache=function(){this.channel1currentSampleLeft=this.leftChannel1?this.channel1envelopeVolume:0,this.channel1currentSampleRight=this.rightChannel1?this.channel1envelopeVolume:0,this.channel1OutputLevelSecondaryCache()},M.prototype.channel1OutputLevelSecondaryCache=function(){this.channel1Enabled?(this.channel1currentSampleLeftSecondary=this.channel1currentSampleLeft,this.channel1currentSampleRightSecondary=this.channel1currentSampleRight):(this.channel1currentSampleLeftSecondary=0,this.channel1currentSampleRightSecondary=0),this.channel1OutputLevelTrimaryCache()},M.prototype.channel1OutputLevelTrimaryCache=function(){this.channel1CachedDuty[this.channel1DutyTracker]&&A[14][0]?(this.channel1currentSampleLeftTrimary=this.channel1currentSampleLeftSecondary,this.channel1currentSampleRightTrimary=this.channel1currentSampleRightSecondary):(this.channel1currentSampleLeftTrimary=0,this.channel1currentSampleRightTrimary=0),this.mixerOutputLevelCache()},M.prototype.channel2EnableCheck=function(){this.channel2Enabled=(this.channel2consecutive||this.channel2totalLength>0)&&this.channel2canPlay,this.channel2OutputLevelSecondaryCache()},M.prototype.channel2VolumeEnableCheck=function(){this.channel2canPlay=this.memory[65303]>7,this.channel2EnableCheck(),this.channel2OutputLevelSecondaryCache()},M.prototype.channel2OutputLevelCache=function(){this.channel2currentSampleLeft=this.leftChannel2?this.channel2envelopeVolume:0,this.channel2currentSampleRight=this.rightChannel2?this.channel2envelopeVolume:0,this.channel2OutputLevelSecondaryCache()},M.prototype.channel2OutputLevelSecondaryCache=function(){this.channel2Enabled?(this.channel2currentSampleLeftSecondary=this.channel2currentSampleLeft,this.channel2currentSampleRightSecondary=this.channel2currentSampleRight):(this.channel2currentSampleLeftSecondary=0,this.channel2currentSampleRightSecondary=0),this.channel2OutputLevelTrimaryCache()},M.prototype.channel2OutputLevelTrimaryCache=function(){this.channel2CachedDuty[this.channel2DutyTracker]&&A[14][1]?(this.channel2currentSampleLeftTrimary=this.channel2currentSampleLeftSecondary,this.channel2currentSampleRightTrimary=this.channel2currentSampleRightSecondary):(this.channel2currentSampleLeftTrimary=0,this.channel2currentSampleRightTrimary=0),this.mixerOutputLevelCache()},M.prototype.channel3EnableCheck=function(){this.channel3Enabled=/*this.channel3canPlay && */this.channel3consecutive||this.channel3totalLength>0,this.channel3OutputLevelSecondaryCache()},M.prototype.channel3OutputLevelCache=function(){this.channel3currentSampleLeft=this.leftChannel3?this.cachedChannel3Sample:0,this.channel3currentSampleRight=this.rightChannel3?this.cachedChannel3Sample:0,this.channel3OutputLevelSecondaryCache()},M.prototype.channel3OutputLevelSecondaryCache=function(){this.channel3Enabled&&A[14][2]?(this.channel3currentSampleLeftSecondary=this.channel3currentSampleLeft,this.channel3currentSampleRightSecondary=this.channel3currentSampleRight):(this.channel3currentSampleLeftSecondary=0,this.channel3currentSampleRightSecondary=0),this.mixerOutputLevelCache()},M.prototype.channel4EnableCheck=function(){this.channel4Enabled=(this.channel4consecutive||this.channel4totalLength>0)&&this.channel4canPlay,this.channel4OutputLevelSecondaryCache()},M.prototype.channel4VolumeEnableCheck=function(){this.channel4canPlay=this.memory[65313]>7,this.channel4EnableCheck(),this.channel4OutputLevelSecondaryCache()},M.prototype.channel4OutputLevelCache=function(){this.channel4currentSampleLeft=this.leftChannel4?this.cachedChannel4Sample:0,this.channel4currentSampleRight=this.rightChannel4?this.cachedChannel4Sample:0,this.channel4OutputLevelSecondaryCache()},M.prototype.channel4OutputLevelSecondaryCache=function(){this.channel4Enabled&&A[14][3]?(this.channel4currentSampleLeftSecondary=this.channel4currentSampleLeft,this.channel4currentSampleRightSecondary=this.channel4currentSampleRight):(this.channel4currentSampleLeftSecondary=0,this.channel4currentSampleRightSecondary=0),this.mixerOutputLevelCache()},M.prototype.mixerOutputLevelCache=function(){this.mixerOutputCache=(this.channel1currentSampleLeftTrimary+this.channel2currentSampleLeftTrimary+this.channel3currentSampleLeftSecondary+this.channel4currentSampleLeftSecondary)*this.VinLeftChannelMasterVolume<<16|(this.channel1currentSampleRightTrimary+this.channel2currentSampleRightTrimary+this.channel3currentSampleRightSecondary+this.channel4currentSampleRightSecondary)*this.VinRightChannelMasterVolume},M.prototype.channel3UpdateCache=function(){this.cachedChannel3Sample=this.channel3PCM[this.channel3lastSampleLookup]>>this.channel3patternType,this.channel3OutputLevelCache()},M.prototype.channel3WriteRAM=function(e,t){this.channel3canPlay&&this.audioJIT(),this.memory[65328|e]=t,e<<=1,this.channel3PCM[e]=t>>4,this.channel3PCM[1|e]=15&t},M.prototype.channel4UpdateCache=function(){this.cachedChannel4Sample=this.noiseSampleTable[this.channel4currentVolume|this.channel4lastSampleLookup],this.channel4OutputLevelCache()},M.prototype.run=function(){//The preprocessing before the actual iteration loop:
(2&this.stopEmulator)==0&&((1&this.stopEmulator)==1?this.CPUStopped?(this.audioUnderrunAdjustment(),this.audioTicks+=this.CPUCyclesTotal,this.audioJIT(),this.stopEmulator|=1):(this.stopEmulator=0,this.audioUnderrunAdjustment(),this.clockUpdate(),this.halt?(this.CPUTicks=0,this.calculateHALTPeriod(),this.halt?(this.updateCore(),this.iterationEndRoutine()):this.executeIteration()):this.executeIteration(),//Request the graphics target to be updated:
this.requestDraw(),this.frameDone=!0):console.log("Iterator restarted a faulted core."))},M.prototype.executeIteration=function(){for(//Iterate the interpreter loop:
var e=0,t=0;0==this.stopEmulator;){//Interrupt Arming:
switch(this.IRQEnableDelay){case 1:this.IME=!0,this.checkIRQMatching();case 2:--this.IRQEnableDelay}if(this.IRQLineMatched>0&&this.launchIRQ(),//Fetch the current opcode:
e=this.memoryReader[this.programCounter](this,this.programCounter),//Increment the program counter to the next instruction:
this.programCounter=this.programCounter+1&65535,this.skipPCIncrement&&(this.programCounter=this.programCounter-1&65535,this.skipPCIncrement=!1),//Get how many CPU cycles the current instruction counts for:
this.CPUTicks=this.TICKTable[e],//Execute the current instruction:
this.OPCODE[e](this),//Update the state (Inlined updateCoreFull manually here):
//Update the clocking for the LCD emulation:
this.LCDTicks+=this.CPUTicks>>this.doubleSpeedShifter,this.LCDCONTROL[this.actualScanLine](this),//Single-speed relative timing for A/V emulation:
t=this.CPUTicks>>this.doubleSpeedShifter,this.audioTicks+=t,this.emulatorTicks+=t,//CPU Timers:
this.DIVTicks+=this.CPUTicks,this.TIMAEnabled)for(this.timerTicks+=this.CPUTicks;this.timerTicks>=this.TACClocker;)this.timerTicks-=this.TACClocker,256==++this.memory[65285]&&(this.memory[65285]=this.memory[65286],this.interruptsRequested|=4,this.checkIRQMatching());this.serialTimer>0&&(//IRQ Counter:
this.serialTimer-=this.CPUTicks,this.serialTimer<=0&&(this.interruptsRequested|=8,this.checkIRQMatching()),//Bit Shit Counter:
this.serialShiftTimer-=this.CPUTicks,this.serialShiftTimer<=0&&(this.serialShiftTimer=this.serialShiftTimerAllocated,this.memory[65281]=this.memory[65281]<<1&254|1)),this.emulatorTicks>=this.CPUCyclesTotal&&this.iterationEndRoutine()}},M.prototype.iterationEndRoutine=function(){(1&this.stopEmulator)==0&&(this.audioJIT(),//Update DIV Alignment (Integer overflow safety):
this.memory[65284]=this.memory[65284]+(this.DIVTicks>>8)&255,this.DIVTicks&=255,//Update emulator flags:
this.stopEmulator|=1,this.emulatorTicks-=this.CPUCyclesTotal,this.CPUCyclesTotalCurrent+=this.CPUCyclesTotalRoundoff,this.recalculateIterationClockLimit())},M.prototype.handleSTOP=function(){this.CPUStopped=!0,this.iterationEndRoutine(),this.emulatorTicks<0&&(this.audioTicks-=this.emulatorTicks,this.audioJIT())},M.prototype.recalculateIterationClockLimit=function(){var e=this.CPUCyclesTotalCurrent%4;this.CPUCyclesTotal=this.CPUCyclesTotalBase+this.CPUCyclesTotalCurrent-e,this.CPUCyclesTotalCurrent=e},M.prototype.recalculateIterationClockLimitForAudio=function(e){this.CPUCyclesTotal+=Math.min(e>>2<<2,this.CPUCyclesTotalBase<<1)},M.prototype.scanLineMode2=function(){1!=this.STATTracker&&(this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=1,this.modeSTAT=2)},M.prototype.scanLineMode3=function(){3!=this.modeSTAT&&(0==this.STATTracker&&this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=1,this.modeSTAT=3)},M.prototype.scanLineMode0=function(){0!=this.modeSTAT&&(2!=this.STATTracker&&(0==this.STATTracker&&(this.mode2TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.modeSTAT=3),this.incrementScanLineQueue(),this.updateSpriteCount(this.actualScanLine),this.STATTracker=2),this.LCDTicks>=this.spriteCount&&(this.hdmaRunning&&this.executeHDMA(),this.mode0TriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching()),this.STATTracker=3,this.modeSTAT=0))},M.prototype.clocksUntilLYCMatch=function(){return 0!=this.memory[65349]?this.memory[65349]>this.actualScanLine?456*(this.memory[65349]-this.actualScanLine):456*(154-this.actualScanLine+this.memory[65349]):456*(153==this.actualScanLine&&0==this.memory[65348]?154:153-this.actualScanLine)+8},M.prototype.clocksUntilMode0=function(){switch(this.modeSTAT){case 0:if(143==this.actualScanLine)return this.updateSpriteCount(0),this.spriteCount+5016;return this.updateSpriteCount(this.actualScanLine+1),this.spriteCount+456;case 2:case 3:return this.updateSpriteCount(this.actualScanLine),this.spriteCount;case 1:return this.updateSpriteCount(0),this.spriteCount+456*(154-this.actualScanLine)}},M.prototype.updateSpriteCount=function(e){if(this.spriteCount=252,this.cGBC&&this.gfxSpriteShow)for(var t=e+16,r=0,i=this.gfxSpriteNormalHeight?8:16,n=65024;n<65184&&this.spriteCount<312;n+=4)(r=t-this.memory[n])>-1&&r<i&&(this.spriteCount+=6)},M.prototype.matchLYC=function(){this.memory[65348]==this.memory[65349]?(this.memory[65345]|=4,this.LYCMatchTriggerSTAT&&(this.interruptsRequested|=2,this.checkIRQMatching())):this.memory[65345]&=123},M.prototype.updateCore=function(){//Update the clocking for the LCD emulation:
this.LCDTicks+=this.CPUTicks>>this.doubleSpeedShifter,this.LCDCONTROL[this.actualScanLine](this);//Single-speed relative timing for A/V emulation:
var e=this.CPUTicks>>this.doubleSpeedShifter;//CPU clocking can be updated from the LCD handling.
if(this.audioTicks+=e,this.emulatorTicks+=e,//CPU Timers:
this.DIVTicks+=this.CPUTicks,this.TIMAEnabled)for(this.timerTicks+=this.CPUTicks;this.timerTicks>=this.TACClocker;)this.timerTicks-=this.TACClocker,256==++this.memory[65285]&&(this.memory[65285]=this.memory[65286],this.interruptsRequested|=4,this.checkIRQMatching());this.serialTimer>0&&(//IRQ Counter:
this.serialTimer-=this.CPUTicks,this.serialTimer<=0&&(this.interruptsRequested|=8,this.checkIRQMatching()),//Bit Shit Counter:
this.serialShiftTimer-=this.CPUTicks,this.serialShiftTimer<=0&&(this.serialShiftTimer=this.serialShiftTimerAllocated,this.memory[65281]=this.memory[65281]<<1&254|1))},M.prototype.updateCoreFull=function(){//Update the state machine:
this.updateCore(),this.emulatorTicks>=this.CPUCyclesTotal&&this.iterationEndRoutine()},M.prototype.initializeLCDController=function(){for(//Display on hanlding:
var e=0;e<154;)e<143?this.LINECONTROL[e]=function(e){e.LCDTicks<80?e.scanLineMode2():e.LCDTicks<252?e.scanLineMode3():e.LCDTicks<456?e.scanLineMode0():(//We're on a new scan line:
e.LCDTicks-=456,3!=e.STATTracker&&(2!=e.STATTracker&&(0==e.STATTracker&&e.mode2TriggerSTAT&&(e.interruptsRequested|=2),e.incrementScanLineQueue()),e.hdmaRunning&&e.executeHDMA(),e.mode0TriggerSTAT&&(e.interruptsRequested|=2)),//Update the scanline registers and assert the LYC counter:
e.actualScanLine=++e.memory[65348],e.actualScanLine==e.memory[65349]?(e.memory[65345]|=4,e.LYCMatchTriggerSTAT&&(e.interruptsRequested|=2)):e.memory[65345]&=123,e.checkIRQMatching(),//Reset our mode contingency variables:
e.STATTracker=0,e.modeSTAT=2,e.LINECONTROL[e.actualScanLine](e))}:143==e?this.LINECONTROL[143]=function(e){e.LCDTicks<80?e.scanLineMode2():e.LCDTicks<252?e.scanLineMode3():e.LCDTicks<456?e.scanLineMode0():(//Starting V-Blank:
//Just finished the last visible scan line:
e.LCDTicks-=456,3!=e.STATTracker&&(2!=e.STATTracker&&(0==e.STATTracker&&e.mode2TriggerSTAT&&(e.interruptsRequested|=2),e.incrementScanLineQueue()),e.hdmaRunning&&e.executeHDMA(),e.mode0TriggerSTAT&&(e.interruptsRequested|=2)),//Update the scanline registers and assert the LYC counter:
e.actualScanLine=e.memory[65348]=144,144==e.memory[65349]?(e.memory[65345]|=4,e.LYCMatchTriggerSTAT&&(e.interruptsRequested|=2)):e.memory[65345]&=123,//Reset our mode contingency variables:
e.STATTracker=0,//Update our state for v-blank:
e.modeSTAT=1,e.interruptsRequested|=e.mode1TriggerSTAT?3:1,e.checkIRQMatching(),0==e.drewBlank?(e.totalLinesPassed<144||144==e.totalLinesPassed&&e.midScanlineOffset>-1)&&(//Make sure our gfx are up-to-date:
e.graphicsJITVBlank(),//Draw the frame:
e.prepareFrame()):--e.drewBlank,e.LINECONTROL[144](e))}:e<153?this.LINECONTROL[e]=function(e){e.LCDTicks>=456&&(//We're on a new scan line:
e.LCDTicks-=456,e.actualScanLine=++e.memory[65348],e.actualScanLine==e.memory[65349]?(e.memory[65345]|=4,e.LYCMatchTriggerSTAT&&(e.interruptsRequested|=2,e.checkIRQMatching())):e.memory[65345]&=123,e.LINECONTROL[e.actualScanLine](e))}:this.LINECONTROL[153]=function(e){e.LCDTicks>=8&&(4!=e.STATTracker&&153==e.memory[65348]&&(e.memory[65348]=0,0==e.memory[65349]?(e.memory[65345]|=4,e.LYCMatchTriggerSTAT&&(e.interruptsRequested|=2,e.checkIRQMatching())):e.memory[65345]&=123,e.STATTracker=4),e.LCDTicks>=456&&(//We reset back to the beginning:
e.LCDTicks-=456,e.STATTracker=e.actualScanLine=0,e.LINECONTROL[0](e)))},++e},M.prototype.DisplayShowOff=function(){0==this.drewBlank&&(//Output a blank screen to the output framebuffer:
this.clearFrameBuffer(),this.drewFrame=!0),this.drewBlank=2},M.prototype.executeHDMA=function(){this.DMAWrite(1),this.halt?this.LCDTicks-this.spriteCount<(4>>this.doubleSpeedShifter|32)&&(//HALT clocking correction:
this.CPUTicks=4+(32+this.spriteCount<<this.doubleSpeedShifter),this.LCDTicks=this.spriteCount+(4>>this.doubleSpeedShifter|32)):this.LCDTicks+=4>>this.doubleSpeedShifter|32,0==this.memory[65365]?(this.hdmaRunning=!1,this.memory[65365]=255):--this.memory[65365]},M.prototype.clockUpdate=function(){if(this.cTIMER){var e=new Date().getTime(),t=e-this.lastIteration;if(this.lastIteration=e,this.cTIMER&&!this.RTCHALT)for(//Update the MBC3 RTC:
this.RTCSeconds+=t/1e3;this.RTCSeconds>=60;)this.RTCSeconds-=60,++this.RTCMinutes,this.RTCMinutes>=60&&(this.RTCMinutes-=60,++this.RTCHours,this.RTCHours>=24&&(this.RTCHours-=24,++this.RTCDays,this.RTCDays>=512&&(this.RTCDays-=512,this.RTCDayOverFlow=!0)))}},M.prototype.prepareFrame=function(){//Copy the internal frame buffer to the output buffer:
this.swizzleFrameBuffer(),this.drewFrame=!0},M.prototype.requestDraw=function(){this.drewFrame&&this.dispatchDraw()},M.prototype.dispatchDraw=function(){this.offscreenRGBCount>0&&(92160==this.offscreenRGBCount?this.processDraw(this.swizzledFrame):this.resizeFrameBuffer())},//ToDo: Remove this method, I don't think it's necessary.
//Converts rgb canvas into rgba.
M.prototype.processDraw=function(e){for(var t=this.offscreenRGBCount,r=this.canvasBuffer.data,i=0,n=0;n<t;++n)r[n++]=e[i++],r[n++]=e[i++],r[n++]=e[i++];this.graphicsBlit(),this.drewFrame=!1},//Which means I want to grab the swizzledFrame, not the normal frameBuffer(?)
//ToDo: I believe (but am not sure) that I can remove this too.
M.prototype.swizzleFrameBuffer=function(){for(var e=this.frameBuffer,t=this.swizzledFrame,r=0,i=0;i<69120;)t[i++]=e[r]>>16&255,t[i++]=e[r]>>8&255,t[i++]=255&e[r++]},M.prototype.clearFrameBuffer=function(){var e=0,t=this.swizzledFrame;if(this.cGBC||this.colorizedGBPalettes)for(;e<69120;)t[e++]=248;else for(;e<69120;)t[e++]=239,t[e++]=255,t[e++]=222},M.prototype.resizeFrameBuffer=function(){//Resize in javascript with resize.js:
this.resizePathClear&&(this.resizePathClear=!1,this.resizer.resize(this.swizzledFrame))},M.prototype.compileResizeFrameBufferFunction=function(){if(this.offscreenRGBCount>0){var e=this;this.resizer=new Resize(160,144,this.offscreenWidth,this.offscreenHeight,!1,A[13],!1,function(t){t.length/3*4==e.offscreenRGBCount&&e.processDraw(t),e.resizePathClear=!0})}},M.prototype.renderScanLine=function(e){if(this.pixelStart=160*e,this.bgEnabled)this.pixelEnd=160,this.BGLayerRender(e),this.WindowLayerRender(e);else for(var t=(e+1)*160,r=this.cGBC||this.colorizedGBPalettes?16316664:15728606,i=160*e+this.currentX;i<t;i++)this.frameBuffer[i]=r;this.SpriteLayerRender(e),this.currentX=0,this.midScanlineOffset=-1},M.prototype.renderMidScanLine=function(){if(this.actualScanLine<144&&3==this.modeSTAT&&(-1==this.midScanlineOffset&&(this.midScanlineOffset=7&this.backgroundX),this.LCDTicks>=82)){if(this.pixelEnd=this.LCDTicks-74,this.pixelEnd=Math.min(this.pixelEnd-this.midScanlineOffset-this.pixelEnd%8,160),this.bgEnabled)this.pixelStart=160*this.lastUnrenderedLine,this.BGLayerRender(this.lastUnrenderedLine),this.WindowLayerRender(this.lastUnrenderedLine);else for(var e=160*this.lastUnrenderedLine+this.pixelEnd,t=this.cGBC||this.colorizedGBPalettes?16316664:15728606,r=160*this.lastUnrenderedLine+this.currentX;r<e;r++)this.frameBuffer[r]=t;this.currentX=this.pixelEnd}},M.prototype.initializeModeSpecificArrays=function(){this.LCDCONTROL=this.LCDisOn?this.LINECONTROL:this.DISPLAYOFFCONTROL,this.cGBC?(this.gbcOBJRawPalette=this.getTypedArray(64,0,"uint8"),this.gbcBGRawPalette=this.getTypedArray(64,0,"uint8"),this.gbcOBJPalette=this.getTypedArray(32,16777216,"int32"),this.gbcBGPalette=this.getTypedArray(64,0,"int32"),this.BGCHRBank2=this.getTypedArray(2048,0,"uint8"),this.BGCHRCurrentBank=this.currVRAMBank>0?this.BGCHRBank2:this.BGCHRBank1,this.tileCache=this.generateCacheArray(3968)):(this.gbOBJPalette=this.getTypedArray(8,0,"int32"),this.gbBGPalette=this.getTypedArray(4,0,"int32"),this.BGPalette=this.gbBGPalette,this.OBJPalette=this.gbOBJPalette,this.tileCache=this.generateCacheArray(1792),this.sortBuffer=this.getTypedArray(256,0,"uint8"),this.OAMAddressCache=this.getTypedArray(10,0,"int32")),this.renderPathBuild()},M.prototype.GBCtoGBModeAdjust=function(){this.VRAM=this.GBCMemory=this.BGCHRCurrentBank=this.BGCHRBank2=null,this.tileCache.length=1792,A[4]?(this.gbBGColorizedPalette=this.getTypedArray(4,0,"int32"),this.gbOBJColorizedPalette=this.getTypedArray(8,0,"int32"),this.cachedBGPaletteConversion=this.getTypedArray(4,0,"int32"),this.cachedOBJPaletteConversion=this.getTypedArray(8,0,"int32"),this.BGPalette=this.gbBGColorizedPalette,this.OBJPalette=this.gbOBJColorizedPalette,this.gbOBJPalette=this.gbBGPalette=null,this.getGBCColor()):(this.gbOBJPalette=this.getTypedArray(8,0,"int32"),this.gbBGPalette=this.getTypedArray(4,0,"int32"),this.BGPalette=this.gbBGPalette,this.OBJPalette=this.gbOBJPalette),this.sortBuffer=this.getTypedArray(256,0,"uint8"),this.OAMAddressCache=this.getTypedArray(10,0,"int32"),this.renderPathBuild(),this.memoryReadJumpCompile(),this.memoryWriteJumpCompile()},M.prototype.renderPathBuild=function(){this.cGBC?(this.priorityFlaggingPathRebuild(),this.SpriteLayerRender=this.SpriteGBCLayerRender):(this.BGLayerRender=this.BGGBLayerRender,this.WindowLayerRender=this.WindowGBLayerRender,this.SpriteLayerRender=this.SpriteGBLayerRender)},M.prototype.priorityFlaggingPathRebuild=function(){this.BGPriorityEnabled?(this.BGLayerRender=this.BGGBCLayerRender,this.WindowLayerRender=this.WindowGBCLayerRender):(this.BGLayerRender=this.BGGBCLayerRenderNoPriorityFlagging,this.WindowLayerRender=this.WindowGBCLayerRenderNoPriorityFlagging)},M.prototype.initializeReferencesFromSaveState=function(){this.LCDCONTROL=this.LCDisOn?this.LINECONTROL:this.DISPLAYOFFCONTROL;var e=0;if(this.cGBC)for(this.BGCHRCurrentBank=this.currVRAMBank>0?this.BGCHRBank2:this.BGCHRBank1,this.tileCache=this.generateCacheArray(3968);e<6144;e+=16)this.generateGBCTileBank1(e),this.generateGBCTileBank2(e);else{for(this.colorizedGBPalettes?(this.BGPalette=this.gbBGColorizedPalette,this.OBJPalette=this.gbOBJColorizedPalette,this.updateGBBGPalette=this.updateGBColorizedBGPalette,this.updateGBOBJPalette=this.updateGBColorizedOBJPalette):(this.BGPalette=this.gbBGPalette,this.OBJPalette=this.gbOBJPalette),this.tileCache=this.generateCacheArray(1792),e=32768;e<36864;e+=2)this.generateGBOAMTileLine(e);for(e=36864;e<38912;e+=2)this.generateGBTileLine(e);this.sortBuffer=this.getTypedArray(256,0,"uint8"),this.OAMAddressCache=this.getTypedArray(10,0,"int32")}this.renderPathBuild()},M.prototype.RGBTint=function(e){//Adjustment for the GBC's tinting (According to Gambatte):
var t=31&e,r=e>>5&31,i=e>>10&31;return 13*t+2*r+i>>1<<16|3*r+i<<9|3*t+2*r+11*i>>1},M.prototype.getGBCColor=function(){//GBC Colorization of DMG ROMs:
//BG
for(var e=0;e<4;e++){var t=e<<1;//BG
this.cachedBGPaletteConversion[e]=this.RGBTint(this.gbcBGRawPalette[1|t]<<8|this.gbcBGRawPalette[t]),//OBJ 1
this.cachedOBJPaletteConversion[e]=this.RGBTint(this.gbcOBJRawPalette[1|t]<<8|this.gbcOBJRawPalette[t])}//OBJ 2
for(e=4;e<8;e++)t=e<<1,this.cachedOBJPaletteConversion[e]=this.RGBTint(this.gbcOBJRawPalette[1|t]<<8|this.gbcOBJRawPalette[t]);//Update the palette entries:
this.updateGBBGPalette=this.updateGBColorizedBGPalette,this.updateGBOBJPalette=this.updateGBColorizedOBJPalette,this.updateGBBGPalette(this.memory[65351]),this.updateGBOBJPalette(0,this.memory[65352]),this.updateGBOBJPalette(1,this.memory[65353]),this.colorizedGBPalettes=!0},M.prototype.updateGBRegularBGPalette=function(e){this.gbBGPalette[0]=33554432|this.colors[3&e],this.gbBGPalette[1]=this.colors[e>>2&3],this.gbBGPalette[2]=this.colors[e>>4&3],this.gbBGPalette[3]=this.colors[e>>6]},M.prototype.updateGBColorizedBGPalette=function(e){//GB colorization:
this.gbBGColorizedPalette[0]=33554432|this.cachedBGPaletteConversion[3&e],this.gbBGColorizedPalette[1]=this.cachedBGPaletteConversion[e>>2&3],this.gbBGColorizedPalette[2]=this.cachedBGPaletteConversion[e>>4&3],this.gbBGColorizedPalette[3]=this.cachedBGPaletteConversion[e>>6]},M.prototype.updateGBRegularOBJPalette=function(e,t){this.gbOBJPalette[1|e]=this.colors[t>>2&3],this.gbOBJPalette[2|e]=this.colors[t>>4&3],this.gbOBJPalette[3|e]=this.colors[t>>6]},M.prototype.updateGBColorizedOBJPalette=function(e,t){//GB colorization:
this.gbOBJColorizedPalette[1|e]=this.cachedOBJPaletteConversion[e|t>>2&3],this.gbOBJColorizedPalette[2|e]=this.cachedOBJPaletteConversion[e|t>>4&3],this.gbOBJColorizedPalette[3|e]=this.cachedOBJPaletteConversion[e|t>>6]},M.prototype.updateGBCBGPalette=function(e,t){this.gbcBGRawPalette[e]!=t&&(this.midScanLineJIT(),//Update the color palette for BG tiles since it changed:
this.gbcBGRawPalette[e]=t,//Palette 0 (Special tile Priority stuff)
t=(6&e)==0?33554432|this.RGBTint(this.gbcBGRawPalette[1|e]<<8|this.gbcBGRawPalette[62&e]):this.RGBTint(this.gbcBGRawPalette[1|e]<<8|this.gbcBGRawPalette[62&e]),e>>=1,this.gbcBGPalette[e]=t,this.gbcBGPalette[32|e]=16777216|t)},M.prototype.updateGBCOBJPalette=function(e,t){this.gbcOBJRawPalette[e]!=t&&(//Update the color palette for OBJ tiles since it changed:
this.gbcOBJRawPalette[e]=t,(6&e)>0&&(//Regular Palettes (No special crap)
this.midScanLineJIT(),this.gbcOBJPalette[e>>1]=16777216|this.RGBTint(this.gbcOBJRawPalette[1|e]<<8|this.gbcOBJRawPalette[62&e])))},M.prototype.BGGBLayerRender=function(e){var t=this.backgroundY+e&255,r=(7&t)<<3,i=this.gfxBackgroundCHRBankPosition|(248&t)<<2,n=this.backgroundX+this.currentX&255,s=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&e-this.windowY>=0?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),o=i+(n>>3),h=this.BGCHRBank1[o];//The line of the BG we're at.
h<this.gfxBackgroundBankOffset&&(h|=256);for(var c=this.tileCache[h],u=7&n;u<8&&s<a&&n<256;++n)this.frameBuffer[s++]=this.BGPalette[c[r|u++]];var l=Math.min(a-s,256-n)>>3;for(n+=l<<3,l+=o;o<l;)(h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.tileCache[h],u=r,this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u]];if(s<a){if(n<256)for((h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.tileCache[h],u=r-1;s<a&&n<256;++n)this.frameBuffer[s++]=this.BGPalette[c[++u]];for(l=(a-s>>3)+i;i<l;)(h=this.BGCHRBank1[i++])<this.gfxBackgroundBankOffset&&(h|=256),c=this.tileCache[h],u=r,this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u++]],this.frameBuffer[s++]=this.BGPalette[c[u]];if(s<a)switch((h=this.BGCHRBank1[i])<this.gfxBackgroundBankOffset&&(h|=256),c=this.tileCache[h],a-s){case 7:this.frameBuffer[s+6]=this.BGPalette[c[6|r]];case 6:this.frameBuffer[s+5]=this.BGPalette[c[5|r]];case 5:this.frameBuffer[s+4]=this.BGPalette[c[4|r]];case 4:this.frameBuffer[s+3]=this.BGPalette[c[3|r]];case 3:this.frameBuffer[s+2]=this.BGPalette[c[2|r]];case 2:this.frameBuffer[s+1]=this.BGPalette[c[1|r]];case 1:this.frameBuffer[s]=this.BGPalette[c[r]]}}},M.prototype.BGGBCLayerRender=function(e){var t=this.backgroundY+e&255,r=(7&t)<<3,i=this.gfxBackgroundCHRBankPosition|(248&t)<<2,n=this.backgroundX+this.currentX&255,s=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&e-this.windowY>=0?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),o=i+(n>>3),h=this.BGCHRBank1[o];//The line of the BG we're at.
h<this.gfxBackgroundBankOffset&&(h|=256);for(var c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2|(128&c)>>2,m=7&n;m<8&&s<a&&n<256;++n)this.frameBuffer[s++]=this.gbcBGPalette[l|u[r|m++]];var f=Math.min(a-s,256-n)>>3;for(n+=f<<3,f+=o;o<f;)(h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2|(128&c)>>2,m=r,this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m]];if(s<a){if(n<256)for((h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2|(128&c)>>2,m=r-1;s<a&&n<256;++n)this.frameBuffer[s++]=this.gbcBGPalette[l|u[++m]];for(f=(a-s>>3)+i;i<f;)(h=this.BGCHRBank1[i])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[i++],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2|(128&c)>>2,m=r,this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m]];if(s<a)switch((h=this.BGCHRBank1[i])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[i],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2|(128&c)>>2,a-s){case 7:this.frameBuffer[s+6]=this.gbcBGPalette[l|u[6|r]];case 6:this.frameBuffer[s+5]=this.gbcBGPalette[l|u[5|r]];case 5:this.frameBuffer[s+4]=this.gbcBGPalette[l|u[4|r]];case 4:this.frameBuffer[s+3]=this.gbcBGPalette[l|u[3|r]];case 3:this.frameBuffer[s+2]=this.gbcBGPalette[l|u[2|r]];case 2:this.frameBuffer[s+1]=this.gbcBGPalette[l|u[1|r]];case 1:this.frameBuffer[s]=this.gbcBGPalette[l|u[r]]}}},M.prototype.BGGBCLayerRenderNoPriorityFlagging=function(e){var t=this.backgroundY+e&255,r=(7&t)<<3,i=this.gfxBackgroundCHRBankPosition|(248&t)<<2,n=this.backgroundX+this.currentX&255,s=this.pixelStart+this.currentX,a=this.pixelStart+(this.gfxWindowDisplay&&e-this.windowY>=0?Math.min(Math.max(this.windowX,0)+this.currentX,this.pixelEnd):this.pixelEnd),o=i+(n>>3),h=this.BGCHRBank1[o];//The line of the BG we're at.
h<this.gfxBackgroundBankOffset&&(h|=256);for(var c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2,m=7&n;m<8&&s<a&&n<256;++n)this.frameBuffer[s++]=this.gbcBGPalette[l|u[r|m++]];var f=Math.min(a-s,256-n)>>3;for(n+=f<<3,f+=o;o<f;)(h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2,m=r,this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m]];if(s<a){if(n<256)for((h=this.BGCHRBank1[++o])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[o],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2,m=r-1;s<a&&n<256;++n)this.frameBuffer[s++]=this.gbcBGPalette[l|u[++m]];for(f=(a-s>>3)+i;i<f;)(h=this.BGCHRBank1[i])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[i++],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2,m=r,this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m++]],this.frameBuffer[s++]=this.gbcBGPalette[l|u[m]];if(s<a)switch((h=this.BGCHRBank1[i])<this.gfxBackgroundBankOffset&&(h|=256),c=this.BGCHRBank2[i],u=this.tileCache[(8&c)<<8|(96&c)<<4|h],l=(7&c)<<2,a-s){case 7:this.frameBuffer[s+6]=this.gbcBGPalette[l|u[6|r]];case 6:this.frameBuffer[s+5]=this.gbcBGPalette[l|u[5|r]];case 5:this.frameBuffer[s+4]=this.gbcBGPalette[l|u[4|r]];case 4:this.frameBuffer[s+3]=this.gbcBGPalette[l|u[3|r]];case 3:this.frameBuffer[s+2]=this.gbcBGPalette[l|u[2|r]];case 2:this.frameBuffer[s+1]=this.gbcBGPalette[l|u[1|r]];case 1:this.frameBuffer[s]=this.gbcBGPalette[l|u[r]]}}},M.prototype.WindowGBLayerRender=function(e){if(this.gfxWindowDisplay){var t=e-this.windowY;//The line of the BG we're at.
if(t>=0){var r=this.windowX>0?this.windowX+this.currentX:this.currentX,i=this.pixelStart+r,n=this.pixelStart+this.pixelEnd;if(i<n){var s=(7&t)<<3,a=(this.gfxWindowCHRBankPosition|(248&t)<<2)+(this.currentX>>3),o=this.BGCHRBank1[a];o<this.gfxBackgroundBankOffset&&(o|=256);var h=this.tileCache[o],c=r-this.windowX&7;for(r=Math.min(8,c+n-i);c<r;)this.frameBuffer[i++]=this.BGPalette[h[s|c++]];for(r=a+(n-i>>3);a<r;)(o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.tileCache[o],c=s,this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c++]],this.frameBuffer[i++]=this.BGPalette[h[c]];if(i<n)switch((o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.tileCache[o],n-i){case 7:this.frameBuffer[i+6]=this.BGPalette[h[6|s]];case 6:this.frameBuffer[i+5]=this.BGPalette[h[5|s]];case 5:this.frameBuffer[i+4]=this.BGPalette[h[4|s]];case 4:this.frameBuffer[i+3]=this.BGPalette[h[3|s]];case 3:this.frameBuffer[i+2]=this.BGPalette[h[2|s]];case 2:this.frameBuffer[i+1]=this.BGPalette[h[1|s]];case 1:this.frameBuffer[i]=this.BGPalette[h[s]]}}}}},M.prototype.WindowGBCLayerRender=function(e){if(this.gfxWindowDisplay){var t=e-this.windowY;//The line of the BG we're at.
if(t>=0){var r=this.windowX>0?this.windowX+this.currentX:this.currentX,i=this.pixelStart+r,n=this.pixelStart+this.pixelEnd;if(i<n){var s=(7&t)<<3,a=(this.gfxWindowCHRBankPosition|(248&t)<<2)+(this.currentX>>3),o=this.BGCHRBank1[a];o<this.gfxBackgroundBankOffset&&(o|=256);var h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2|(128&h)>>2,l=r-this.windowX&7;for(r=Math.min(8,l+n-i);l<r;)this.frameBuffer[i++]=this.gbcBGPalette[u|c[s|l++]];for(r=a+(n-i>>3);a<r;)(o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2|(128&h)>>2,l=s,this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l]];if(i<n)switch((o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2|(128&h)>>2,n-i){case 7:this.frameBuffer[i+6]=this.gbcBGPalette[u|c[6|s]];case 6:this.frameBuffer[i+5]=this.gbcBGPalette[u|c[5|s]];case 5:this.frameBuffer[i+4]=this.gbcBGPalette[u|c[4|s]];case 4:this.frameBuffer[i+3]=this.gbcBGPalette[u|c[3|s]];case 3:this.frameBuffer[i+2]=this.gbcBGPalette[u|c[2|s]];case 2:this.frameBuffer[i+1]=this.gbcBGPalette[u|c[1|s]];case 1:this.frameBuffer[i]=this.gbcBGPalette[u|c[s]]}}}}},M.prototype.WindowGBCLayerRenderNoPriorityFlagging=function(e){if(this.gfxWindowDisplay){var t=e-this.windowY;//The line of the BG we're at.
if(t>=0){var r=this.windowX>0?this.windowX+this.currentX:this.currentX,i=this.pixelStart+r,n=this.pixelStart+this.pixelEnd;if(i<n){var s=(7&t)<<3,a=(this.gfxWindowCHRBankPosition|(248&t)<<2)+(this.currentX>>3),o=this.BGCHRBank1[a];o<this.gfxBackgroundBankOffset&&(o|=256);var h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2,l=r-this.windowX&7;for(r=Math.min(8,l+n-i);l<r;)this.frameBuffer[i++]=this.gbcBGPalette[u|c[s|l++]];for(r=a+(n-i>>3);a<r;)(o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2,l=s,this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l++]],this.frameBuffer[i++]=this.gbcBGPalette[u|c[l]];if(i<n)switch((o=this.BGCHRBank1[++a])<this.gfxBackgroundBankOffset&&(o|=256),h=this.BGCHRBank2[a],c=this.tileCache[(8&h)<<8|(96&h)<<4|o],u=(7&h)<<2,n-i){case 7:this.frameBuffer[i+6]=this.gbcBGPalette[u|c[6|s]];case 6:this.frameBuffer[i+5]=this.gbcBGPalette[u|c[5|s]];case 5:this.frameBuffer[i+4]=this.gbcBGPalette[u|c[4|s]];case 4:this.frameBuffer[i+3]=this.gbcBGPalette[u|c[3|s]];case 3:this.frameBuffer[i+2]=this.gbcBGPalette[u|c[2|s]];case 2:this.frameBuffer[i+1]=this.gbcBGPalette[u|c[1|s]];case 1:this.frameBuffer[i]=this.gbcBGPalette[u|c[s]]}}}}},M.prototype.SpriteGBLayerRender=function(e){if(this.gfxSpriteShow){//Clear our x-coord sort buffer:
for(var t=e+16,r=65024,i=0,n=1,s=0,a=0,o=0,h=0,c=null,u=0,l=0,m=0,f=0,g=0;n<168;)this.sortBuffer[n++]=255;if(this.gfxSpriteNormalHeight)for(var m=this.findLowestSpriteDrawable(t,7);l<m;++l)for(r=this.OAMAddressCache[l],i=t-this.memory[r]<<3,h=(16&(o=this.memory[3|r]))>>2,c=this.tileCache[(96&o)<<4|this.memory[2|r]],a=Math.min(168-(g=s=this.memory[1|r]),8),n=g>7?0:8-g,f=this.pixelStart+(g>8?g-8:0);n<a;++n,++f,++g)this.sortBuffer[g]>s&&(this.frameBuffer[f]>=33554432?(u=c[i|n])>0&&(this.frameBuffer[f]=this.OBJPalette[h|u],this.sortBuffer[g]=s):this.frameBuffer[f]<16777216&&(u=c[i|n])>0&&o<128&&(this.frameBuffer[f]=this.OBJPalette[h|u],this.sortBuffer[g]=s));else for(var m=this.findLowestSpriteDrawable(t,15);l<m;++l)for(r=this.OAMAddressCache[l],i=t-this.memory[r]<<3,h=(16&(o=this.memory[3|r]))>>2,c=(64&o)==(64&i)?this.tileCache[(96&o)<<4|254&this.memory[2|r]]:this.tileCache[(96&o)<<4|this.memory[2|r]|1],i&=63,a=Math.min(168-(g=s=this.memory[1|r]),8),n=g>7?0:8-g,f=this.pixelStart+(g>8?g-8:0);n<a;++n,++f,++g)this.sortBuffer[g]>s&&(this.frameBuffer[f]>=33554432?(u=c[i|n])>0&&(this.frameBuffer[f]=this.OBJPalette[h|u],this.sortBuffer[g]=s):this.frameBuffer[f]<16777216&&(u=c[i|n])>0&&o<128&&(this.frameBuffer[f]=this.OBJPalette[h|u],this.sortBuffer[g]=s))}},M.prototype.findLowestSpriteDrawable=function(e,t){for(var r=65024,i=0,n=0;r<65184&&i<10;)((n=e-this.memory[r])&t)==n&&(this.OAMAddressCache[i++]=r),r+=4;return i},M.prototype.SpriteGBCLayerRender=function(e){if(this.gfxSpriteShow){var t=65024,r=e+16,i=0,n=0,s=0,a=0,o=0,h=0,c=null,u=0,l=0,m=0;if(this.gfxSpriteNormalHeight){for(;t<65184&&m<10;t+=4)if((7&(i=r-this.memory[t]))==i){for(s=Math.min(160,(n=this.memory[1|t]-8)+8),h=(7&(o=this.memory[3|t]))<<2,c=this.tileCache[(8&o)<<8|(96&o)<<4|this.memory[2|t]],a=n>0?n:0,n-=i<<3,l=this.pixelStart+a;a<s;++a,++l)this.frameBuffer[l]>=33554432?(u=c[a-n])>0&&(this.frameBuffer[l]=this.gbcOBJPalette[h|u]):this.frameBuffer[l]<16777216&&(u=c[a-n])>0&&o<128&&(this.frameBuffer[l]=this.gbcOBJPalette[h|u]);++m}}else for(;t<65184&&m<10;t+=4)if((15&(i=r-this.memory[t]))==i){for(s=Math.min(160,(n=this.memory[1|t]-8)+8),h=(7&(o=this.memory[3|t]))<<2,c=(64&o)==(64&i<<3)?this.tileCache[(8&o)<<8|(96&o)<<4|254&this.memory[2|t]]:this.tileCache[(8&o)<<8|(96&o)<<4|this.memory[2|t]|1],a=n>0?n:0,n-=(7&i)<<3,l=this.pixelStart+a;a<s;++a,++l)this.frameBuffer[l]>=33554432?(u=c[a-n])>0&&(this.frameBuffer[l]=this.gbcOBJPalette[h|u]):this.frameBuffer[l]<16777216&&(u=c[a-n])>0&&o<128&&(this.frameBuffer[l]=this.gbcOBJPalette[h|u]);++m}}},//Generate only a single tile line for the GB tile cache mode:
M.prototype.generateGBTileLine=function(e){var t=this.memory[1|e]<<8|this.memory[40958&e],r=this.tileCache[(8176&e)>>4];r[7|(e=(14&e)<<2)]=(256&t)>>7|1&t,r[6|e]=(512&t)>>8|(2&t)>>1,r[5|e]=(1024&t)>>9|(4&t)>>2,r[4|e]=(2048&t)>>10|(8&t)>>3,r[3|e]=(4096&t)>>11|(16&t)>>4,r[2|e]=(8192&t)>>12|(32&t)>>5,r[1|e]=(16384&t)>>13|(64&t)>>6,r[e]=(32768&t)>>14|(128&t)>>7},//Generate only a single tile line for the GBC tile cache mode (Bank 1):
M.prototype.generateGBCTileLineBank1=function(e){var t=this.memory[1|e]<<8|this.memory[40958&e];e&=8190;var r=this.tileCache[e>>4],i=this.tileCache[512|e>>4],n=this.tileCache[1024|e>>4],s=this.tileCache[1536|e>>4],a=56-(e=(14&e)<<2);s[a]=i[e]=n[7|a]=r[7|e]=(256&t)>>7|1&t,s[1|a]=i[1|e]=n[6|a]=r[6|e]=(512&t)>>8|(2&t)>>1,s[2|a]=i[2|e]=n[5|a]=r[5|e]=(1024&t)>>9|(4&t)>>2,s[3|a]=i[3|e]=n[4|a]=r[4|e]=(2048&t)>>10|(8&t)>>3,s[4|a]=i[4|e]=n[3|a]=r[3|e]=(4096&t)>>11|(16&t)>>4,s[5|a]=i[5|e]=n[2|a]=r[2|e]=(8192&t)>>12|(32&t)>>5,s[6|a]=i[6|e]=n[1|a]=r[1|e]=(16384&t)>>13|(64&t)>>6,s[7|a]=i[7|e]=n[a]=r[e]=(32768&t)>>14|(128&t)>>7},//Generate all the flip combinations for a full GBC VRAM bank 1 tile:
M.prototype.generateGBCTileBank1=function(e){var t=e>>4,r=this.tileCache[t],i=this.tileCache[512|t],n=this.tileCache[1024|t],s=this.tileCache[1536|t],a=0;e|=32768,t=0;var o=56;do a=this.memory[1|e]<<8|this.memory[e],s[o]=i[t]=n[7|o]=r[7|t]=(256&a)>>7|1&a,s[1|o]=i[1|t]=n[6|o]=r[6|t]=(512&a)>>8|(2&a)>>1,s[2|o]=i[2|t]=n[5|o]=r[5|t]=(1024&a)>>9|(4&a)>>2,s[3|o]=i[3|t]=n[4|o]=r[4|t]=(2048&a)>>10|(8&a)>>3,s[4|o]=i[4|t]=n[3|o]=r[3|t]=(4096&a)>>11|(16&a)>>4,s[5|o]=i[5|t]=n[2|o]=r[2|t]=(8192&a)>>12|(32&a)>>5,s[6|o]=i[6|t]=n[1|o]=r[1|t]=(16384&a)>>13|(64&a)>>6,s[7|o]=i[7|t]=n[o]=r[t]=(32768&a)>>14|(128&a)>>7,t+=8,o-=8,e+=2;while(o>-1)},//Generate only a single tile line for the GBC tile cache mode (Bank 2):
M.prototype.generateGBCTileLineBank2=function(e){var t=this.VRAM[1|e]<<8|this.VRAM[8190&e],r=this.tileCache[2048|e>>4],i=this.tileCache[2560|e>>4],n=this.tileCache[3072|e>>4],s=this.tileCache[3584|e>>4],a=56-(e=(14&e)<<2);s[a]=i[e]=n[7|a]=r[7|e]=(256&t)>>7|1&t,s[1|a]=i[1|e]=n[6|a]=r[6|e]=(512&t)>>8|(2&t)>>1,s[2|a]=i[2|e]=n[5|a]=r[5|e]=(1024&t)>>9|(4&t)>>2,s[3|a]=i[3|e]=n[4|a]=r[4|e]=(2048&t)>>10|(8&t)>>3,s[4|a]=i[4|e]=n[3|a]=r[3|e]=(4096&t)>>11|(16&t)>>4,s[5|a]=i[5|e]=n[2|a]=r[2|e]=(8192&t)>>12|(32&t)>>5,s[6|a]=i[6|e]=n[1|a]=r[1|e]=(16384&t)>>13|(64&t)>>6,s[7|a]=i[7|e]=n[a]=r[e]=(32768&t)>>14|(128&t)>>7},//Generate all the flip combinations for a full GBC VRAM bank 2 tile:
M.prototype.generateGBCTileBank2=function(e){var t=e>>4,r=this.tileCache[2048|t],i=this.tileCache[2560|t],n=this.tileCache[3072|t],s=this.tileCache[3584|t],a=0;t=0;var o=56;do a=this.VRAM[1|e]<<8|this.VRAM[e],s[o]=i[t]=n[7|o]=r[7|t]=(256&a)>>7|1&a,s[1|o]=i[1|t]=n[6|o]=r[6|t]=(512&a)>>8|(2&a)>>1,s[2|o]=i[2|t]=n[5|o]=r[5|t]=(1024&a)>>9|(4&a)>>2,s[3|o]=i[3|t]=n[4|o]=r[4|t]=(2048&a)>>10|(8&a)>>3,s[4|o]=i[4|t]=n[3|o]=r[3|t]=(4096&a)>>11|(16&a)>>4,s[5|o]=i[5|t]=n[2|o]=r[2|t]=(8192&a)>>12|(32&a)>>5,s[6|o]=i[6|t]=n[1|o]=r[1|t]=(16384&a)>>13|(64&a)>>6,s[7|o]=i[7|t]=n[o]=r[t]=(32768&a)>>14|(128&a)>>7,t+=8,o-=8,e+=2;while(o>-1)},//Generate only a single tile line for the GB tile cache mode (OAM accessible range):
M.prototype.generateGBOAMTileLine=function(e){var t=this.memory[1|e]<<8|this.memory[40958&e];e&=8190;var r=this.tileCache[e>>4],i=this.tileCache[512|e>>4],n=this.tileCache[1024|e>>4],s=this.tileCache[1536|e>>4],a=56-(e=(14&e)<<2);s[a]=i[e]=n[7|a]=r[7|e]=(256&t)>>7|1&t,s[1|a]=i[1|e]=n[6|a]=r[6|e]=(512&t)>>8|(2&t)>>1,s[2|a]=i[2|e]=n[5|a]=r[5|e]=(1024&t)>>9|(4&t)>>2,s[3|a]=i[3|e]=n[4|a]=r[4|e]=(2048&t)>>10|(8&t)>>3,s[4|a]=i[4|e]=n[3|a]=r[3|e]=(4096&t)>>11|(16&t)>>4,s[5|a]=i[5|e]=n[2|a]=r[2|e]=(8192&t)>>12|(32&t)>>5,s[6|a]=i[6|e]=n[1|a]=r[1|e]=(16384&t)>>13|(64&t)>>6,s[7|a]=i[7|e]=n[a]=r[e]=(32768&t)>>14|(128&t)>>7},M.prototype.graphicsJIT=function(){this.LCDisOn&&(this.totalLinesPassed=0,this.graphicsJITScanlineGroup())},M.prototype.graphicsJITVBlank=function(){//JIT the graphics to v-blank framing:
this.totalLinesPassed+=this.queuedScanLines,this.graphicsJITScanlineGroup()},M.prototype.graphicsJITScanlineGroup=function(){//Normal rendering JIT, where we try to do groups of scanlines at once:
for(;this.queuedScanLines>0;)this.renderScanLine(this.lastUnrenderedLine),this.lastUnrenderedLine<143?++this.lastUnrenderedLine:this.lastUnrenderedLine=0,--this.queuedScanLines},M.prototype.incrementScanLineQueue=function(){this.queuedScanLines<144?++this.queuedScanLines:(this.currentX=0,this.midScanlineOffset=-1,this.lastUnrenderedLine<143?++this.lastUnrenderedLine:this.lastUnrenderedLine=0)},M.prototype.midScanLineJIT=function(){this.graphicsJIT(),this.renderMidScanLine()},//Check for the highest priority IRQ to fire:
M.prototype.launchIRQ=function(){var e=0,t=1;do{//Check to see if an interrupt is enabled AND requested.
if((t&this.IRQLineMatched)==t){this.IME=!1,this.interruptsRequested-=t,this.IRQLineMatched=0,//Interrupts have a certain clock cycle length:
this.CPUTicks=20,//Set the stack pointer to the current program counter value:
this.stackPointer=this.stackPointer-1&65535,this.memoryWriter[this.stackPointer](this,this.stackPointer,this.programCounter>>8),this.stackPointer=this.stackPointer-1&65535,this.memoryWriter[this.stackPointer](this,this.stackPointer,255&this.programCounter),//Set the program counter to the interrupt's address:
this.programCounter=64|e<<3,//Clock the core for mid-instruction updates:
this.updateCore();return;//We only want the highest priority interrupt.
}t=1<<++e}while(e<5)},/*
    Check for IRQs to be fired while not in HALT:
*/M.prototype.checkIRQMatching=function(){this.IME&&(this.IRQLineMatched=this.interruptsEnabled&this.interruptsRequested&31)},/*
    Handle the HALT opcode by predicting all IRQ cases correctly,
    then selecting the next closest IRQ firing from the prediction to
    clock up to. This prevents hacky looping that doesn't predict, but
    instead just clocks through the core update procedure by one which
    is very slow. Not many emulators do this because they have to cover
    all the IRQ prediction cases and they usually get them wrong.
*/M.prototype.calculateHALTPeriod=function(){//Initialize our variables and start our prediction:
if(this.halt)var e=this.remainingClocks;else{this.halt=!0;var e=-1,t=0;this.LCDisOn&&((1&this.interruptsEnabled)==1&&(e=456*((1==this.modeSTAT?298:144)-this.actualScanLine)-this.LCDTicks<<this.doubleSpeedShifter),(2&this.interruptsEnabled)==2&&(this.mode0TriggerSTAT&&((t=this.clocksUntilMode0()-this.LCDTicks<<this.doubleSpeedShifter)<=e||-1==e)&&(e=t),this.mode1TriggerSTAT&&(1&this.interruptsEnabled)==0&&((t=456*((1==this.modeSTAT?298:144)-this.actualScanLine)-this.LCDTicks<<this.doubleSpeedShifter)<=e||-1==e)&&(e=t),this.mode2TriggerSTAT&&((t=(this.actualScanLine>=143?456*(154-this.actualScanLine):456)-this.LCDTicks<<this.doubleSpeedShifter)<=e||-1==e)&&(e=t),this.LYCMatchTriggerSTAT&&this.memory[65349]<=153&&((t=this.clocksUntilLYCMatch()-this.LCDTicks<<this.doubleSpeedShifter)<=e||-1==e)&&(e=t))),this.TIMAEnabled&&(4&this.interruptsEnabled)==4&&(//CPU timer IRQ prediction:
(t=(256-this.memory[65285])*this.TACClocker-this.timerTicks)<=e||-1==e)&&(e=t),this.serialTimer>0&&(8&this.interruptsEnabled)==8&&(this.serialTimer<=e||-1==e)&&(e=this.serialTimer)}var r=this.CPUCyclesTotal-this.emulatorTicks<<this.doubleSpeedShifter;e>=0?e<=r?(//Exit out of HALT normally:
this.CPUTicks=Math.max(e,this.CPUTicks),this.updateCoreFull(),this.halt=!1,this.CPUTicks=0):(//Still in HALT, clock only up to the clocks specified per iteration:
this.CPUTicks=Math.max(r,this.CPUTicks),this.remainingClocks=e-this.CPUTicks)://Will stay in HALT forever (Stuck in HALT forever), but the APU and LCD are still clocked, so don't pause:
this.CPUTicks+=r},//Memory Reading:
M.prototype.memoryRead=function(e){//Act as a wrapper for reading the returns from the compiled jumps to memory.
return this.memoryReader[e](this,e);//This seems to be faster than the usual if/else.
},M.prototype.memoryHighRead=function(e){//Act as a wrapper for reading the returns from the compiled jumps to memory.
return this.memoryHighReader[e](this,e);//This seems to be faster than the usual if/else.
},M.prototype.memoryReadJumpCompile=function(){//Faster in some browsers, since we are doing less conditionals overall by implementing them in advance.
for(var e=0;e<=65535;e++)if(e<16384)this.memoryReader[e]=this.memoryReadNormal;else if(e<32768)this.memoryReader[e]=this.memoryReadROM;else if(e<38912)this.memoryReader[e]=this.cGBC?this.VRAMDATAReadCGBCPU:this.VRAMDATAReadDMGCPU;else if(e<40960)this.memoryReader[e]=this.cGBC?this.VRAMCHRReadCGBCPU:this.VRAMCHRReadDMGCPU;else if(e>=40960&&e<49152)this.numRAMBanks==1/16&&e<41472||this.numRAMBanks>=1?this.cMBC7?this.memoryReader[e]=this.memoryReadMBC7:this.cMBC3?this.memoryReader[e]=this.memoryReadMBC3:this.memoryReader[e]=this.memoryReadMBC:this.memoryReader[e]=this.memoryReadBAD;else if(e>=49152&&e<57344)!this.cGBC||e<53248?this.memoryReader[e]=this.memoryReadNormal:this.memoryReader[e]=this.memoryReadGBCMemory;else if(e>=57344&&e<65024)!this.cGBC||e<61440?this.memoryReader[e]=this.memoryReadECHONormal:this.memoryReader[e]=this.memoryReadECHOGBCMemory;else if(e<65184)this.memoryReader[e]=this.memoryReadOAM;else if(this.cGBC&&e>=65184&&e<65280)this.memoryReader[e]=this.memoryReadNormal;else if(e>=65280)switch(e){case 65280://JOYPAD:
this.memoryHighReader[0]=this.memoryReader[65280]=function(e,t){return 192|e.memory[65280];//Top nibble returns as set.
};break;case 65281://SB
this.memoryHighReader[1]=this.memoryReader[65281]=function(e,t){return e.memory[65282]<128?e.memory[65281]:255};break;case 65282://SC
this.cGBC?this.memoryHighReader[2]=this.memoryReader[65282]=function(e,t){return(e.serialTimer<=0?124:252)|e.memory[65282]}:this.memoryHighReader[2]=this.memoryReader[65282]=function(e,t){return(e.serialTimer<=0?126:254)|e.memory[65282]};break;case 65283:this.memoryHighReader[3]=this.memoryReader[65283]=this.memoryReadBAD;break;case 65284://DIV
this.memoryHighReader[4]=this.memoryReader[65284]=function(e,t){return e.memory[65284]=e.memory[65284]+(e.DIVTicks>>8)&255,e.DIVTicks&=255,e.memory[65284]};break;case 65285:case 65286:case 65313:case 65314:case 65316:case 65317:case 65349:case 65350:case 65351:case 65352:case 65353:case 65360:case 65361:case 65362:case 65363:case 65364:case 65384:case 65385:case 65386:case 65387:this.memoryHighReader[255&e]=this.memoryHighReadNormal,this.memoryReader[e]=this.memoryReadNormal;break;case 65287:this.memoryHighReader[7]=this.memoryReader[65287]=function(e,t){return 248|e.memory[65287]};break;case 65288:case 65289:case 65290:case 65291:case 65292:case 65293:case 65294:case 65311:case 65312:case 65319:case 65320:case 65321:case 65322:case 65323:case 65324:case 65325:case 65326:case 65327:case 65367:case 65368:case 65369:case 65370:case 65371:case 65372:case 65373:case 65374:case 65375:case 65376:case 65377:case 65378:case 65379:case 65380:case 65381:case 65382:case 65383:case 65389:case 65390:case 65391:case 65400:case 65401:case 65402:case 65403:case 65404:case 65405:case 65406:case 65407:this.memoryHighReader[255&e]=this.memoryReader[e]=this.memoryReadBAD;break;case 65295://IF
this.memoryHighReader[15]=this.memoryReader[65295]=function(e,t){return 224|e.interruptsRequested};break;case 65296:this.memoryHighReader[16]=this.memoryReader[65296]=function(e,t){return 128|e.memory[65296]};break;case 65297:this.memoryHighReader[17]=this.memoryReader[65297]=function(e,t){return 63|e.memory[65297]};break;case 65298:this.memoryHighReader[18]=this.memoryHighReadNormal,this.memoryReader[65298]=this.memoryReadNormal;break;case 65299:this.memoryHighReader[19]=this.memoryReader[65299]=this.memoryReadBAD;break;case 65300:this.memoryHighReader[20]=this.memoryReader[65300]=function(e,t){return 191|e.memory[65300]};break;case 65301:this.memoryHighReader[21]=this.memoryReadBAD,this.memoryReader[65301]=this.memoryReadBAD;break;case 65302:this.memoryHighReader[22]=this.memoryReader[65302]=function(e,t){return 63|e.memory[65302]};break;case 65303:this.memoryHighReader[23]=this.memoryHighReadNormal,this.memoryReader[65303]=this.memoryReadNormal;break;case 65304:this.memoryHighReader[24]=this.memoryReader[65304]=this.memoryReadBAD;break;case 65305:this.memoryHighReader[25]=this.memoryReader[65305]=function(e,t){return 191|e.memory[65305]};break;case 65306:this.memoryHighReader[26]=this.memoryReader[65306]=function(e,t){return 127|e.memory[65306]};break;case 65307:this.memoryHighReader[27]=this.memoryReader[65307]=this.memoryReadBAD;break;case 65308:this.memoryHighReader[28]=this.memoryReader[65308]=function(e,t){return 159|e.memory[65308]};break;case 65309:this.memoryHighReader[29]=this.memoryReader[65309]=this.memoryReadBAD;break;case 65310:this.memoryHighReader[30]=this.memoryReader[65310]=function(e,t){return 191|e.memory[65310]};break;case 65315:this.memoryHighReader[35]=this.memoryReader[65315]=function(e,t){return 191|e.memory[65315]};break;case 65318:this.memoryHighReader[38]=this.memoryReader[65318]=function(e,t){return e.audioJIT(),112|e.memory[65318]};break;case 65328:case 65329:case 65330:case 65331:case 65332:case 65333:case 65334:case 65335:case 65336:case 65337:case 65338:case 65339:case 65340:case 65341:case 65342:case 65343:this.memoryReader[e]=function(e,t){return e.channel3canPlay?e.memory[65280|e.channel3lastSampleLookup>>1]:e.memory[t]},this.memoryHighReader[255&e]=function(e,t){return e.channel3canPlay?e.memory[65280|e.channel3lastSampleLookup>>1]:e.memory[65280|t]};break;case 65344:this.memoryHighReader[64]=this.memoryHighReadNormal,this.memoryReader[65344]=this.memoryReadNormal;break;case 65345:this.memoryHighReader[65]=this.memoryReader[65345]=function(e,t){return 128|e.memory[65345]|e.modeSTAT};break;case 65346:this.memoryHighReader[66]=this.memoryReader[65346]=function(e,t){return e.backgroundY};break;case 65347:this.memoryHighReader[67]=this.memoryReader[65347]=function(e,t){return e.backgroundX};break;case 65348:this.memoryHighReader[68]=this.memoryReader[65348]=function(e,t){return e.LCDisOn?e.memory[65348]:0};break;case 65354://WY
this.memoryHighReader[74]=this.memoryReader[65354]=function(e,t){return e.windowY};break;case 65355:this.memoryHighReader[75]=this.memoryHighReadNormal,this.memoryReader[65355]=this.memoryReadNormal;break;case 65356:this.memoryHighReader[76]=this.memoryReader[65356]=this.memoryReadBAD;break;case 65357:this.memoryHighReader[77]=this.memoryHighReadNormal,this.memoryReader[65357]=this.memoryReadNormal;break;case 65358:this.memoryHighReader[78]=this.memoryReader[65358]=this.memoryReadBAD;break;case 65359:this.memoryHighReader[79]=this.memoryReader[65359]=function(e,t){return e.currVRAMBank};break;case 65365:this.cGBC?this.memoryHighReader[85]=this.memoryReader[65365]=function(e,t){return!e.LCDisOn&&e.hdmaRunning&&(//DMA
e.DMAWrite((127&e.memory[65365])+1),e.memory[65365]=255,e.hdmaRunning=!1),e.memory[65365]}:(this.memoryReader[65365]=this.memoryReadNormal,this.memoryHighReader[85]=this.memoryHighReadNormal);break;case 65366:this.cGBC?this.memoryHighReader[86]=this.memoryReader[65366]=function(e,t){//Return IR "not connected" status:
return 60|(e.memory[65366]>=192?2|193&e.memory[65366]:195&e.memory[65366])}:(this.memoryReader[65366]=this.memoryReadNormal,this.memoryHighReader[86]=this.memoryHighReadNormal);break;case 65388:this.cGBC?this.memoryHighReader[108]=this.memoryReader[65388]=function(e,t){return 254|e.memory[65388]}:this.memoryHighReader[108]=this.memoryReader[65388]=this.memoryReadBAD;break;case 65392:this.cGBC?this.memoryHighReader[112]=this.memoryReader[65392]=function(e,t){return 64|e.memory[65392]}:this.memoryHighReader[112]=this.memoryReader[65392]=this.memoryReadBAD;break;case 65393:this.memoryHighReader[113]=this.memoryReader[65393]=this.memoryReadBAD;break;case 65394:case 65395:this.memoryHighReader[255&e]=this.memoryReader[e]=this.memoryReadNormal;break;case 65396:this.cGBC?this.memoryHighReader[116]=this.memoryReader[65396]=this.memoryReadNormal:this.memoryHighReader[116]=this.memoryReader[65396]=this.memoryReadBAD;break;case 65397:this.memoryHighReader[117]=this.memoryReader[65397]=function(e,t){return 143|e.memory[65397]};break;case 65398:case 65399:this.memoryHighReader[255&e]=this.memoryReader[e]=function(e,t){return 0};break;case 65535://IE
this.memoryHighReader[255]=this.memoryReader[65535]=function(e,t){return e.interruptsEnabled};break;default:this.memoryReader[e]=this.memoryReadNormal,this.memoryHighReader[255&e]=this.memoryHighReadNormal}else this.memoryReader[e]=this.memoryReadBAD},M.prototype.memoryReadNormal=function(e,t){return e.memory[t]},M.prototype.memoryHighReadNormal=function(e,t){return e.memory[65280|t]},M.prototype.memoryReadROM=function(e,t){return e.ROM[e.currentROMBank+t]},M.prototype.memoryReadMBC=function(e,t){return(//Switchable RAM
e.MBCRAMBanksEnabled||A[10]?e.MBCRam[t+e.currMBCRAMBankPosition]:255)},M.prototype.memoryReadMBC7=function(e,t){//Switchable RAM
if(e.MBCRAMBanksEnabled||A[10])switch(t){case 40960:case 41056:case 41072:case 41088:return 0;case 41040://Y High Byte
return e.highY;case 41024://Y Low Byte
return e.lowY;case 41008://X High Byte
return e.highX;case 40992://X Low Byte:
return e.lowX;default:return e.MBCRam[t+e.currMBCRAMBankPosition]}//cout("Reading from disabled RAM.", 1);
return 255},M.prototype.memoryReadMBC3=function(e,t){//Switchable RAM
if(e.MBCRAMBanksEnabled||A[10])switch(e.currMBCRAMBank){case 0:case 1:case 2:case 3:return e.MBCRam[t+e.currMBCRAMBankPosition];case 8:return e.latchedSeconds;case 9:return e.latchedMinutes;case 10:return e.latchedHours;case 11:return e.latchedLDays;case 12:return(e.RTCDayOverFlow?128:0)+(e.RTCHALT?64:0)+e.latchedHDays}//cout("Reading from invalid or disabled RAM.", 1);
return 255},M.prototype.memoryReadGBCMemory=function(e,t){return e.GBCMemory[t+e.gbcRamBankPosition]},M.prototype.memoryReadOAM=function(e,t){return e.modeSTAT>1?255:e.memory[t]},M.prototype.memoryReadECHOGBCMemory=function(e,t){return e.GBCMemory[t+e.gbcRamBankPositionECHO]},M.prototype.memoryReadECHONormal=function(e,t){return e.memory[t-8192]},M.prototype.memoryReadBAD=function(e,t){return 255},M.prototype.VRAMDATAReadCGBCPU=function(e,t){//CPU Side Reading The VRAM (Optimized for GameBoy Color)
return e.modeSTAT>2?255:0==e.currVRAMBank?e.memory[t]:e.VRAM[8191&t]},M.prototype.VRAMDATAReadDMGCPU=function(e,t){//CPU Side Reading The VRAM (Optimized for classic GameBoy)
return e.modeSTAT>2?255:e.memory[t]},M.prototype.VRAMCHRReadCGBCPU=function(e,t){//CPU Side Reading the Character Data Map:
return e.modeSTAT>2?255:e.BGCHRCurrentBank[2047&t]},M.prototype.VRAMCHRReadDMGCPU=function(e,t){//CPU Side Reading the Character Data Map:
return e.modeSTAT>2?255:e.BGCHRBank1[2047&t]},M.prototype.setCurrentMBC1ROMBank=function(){//Read the cartridge ROM data from RAM memory:
switch(this.ROMBank1offs){case 0:case 32:case 64:case 96://Bank calls for 0x00, 0x20, 0x40, and 0x60 are really for 0x01, 0x21, 0x41, and 0x61.
this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge<<14;break;default:this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge-1<<14}},M.prototype.setCurrentMBC2AND3ROMBank=function(){//Read the cartridge ROM data from RAM memory:
//Only map bank 0 to bank 1 here (MBC2 is like MBC1, but can only do 16 banks, so only the bank 0 quirk appears for MBC2):
this.currentROMBank=Math.max(this.ROMBank1offs%this.ROMBankEdge-1,0)<<14},M.prototype.setCurrentMBC5ROMBank=function(){//Read the cartridge ROM data from RAM memory:
this.currentROMBank=this.ROMBank1offs%this.ROMBankEdge-1<<14},//Memory Writing:
M.prototype.memoryWrite=function(e,t){//Act as a wrapper for writing by compiled jumps to specific memory writing functions.
this.memoryWriter[e](this,e,t)},//0xFFXX fast path:
M.prototype.memoryHighWrite=function(e,t){//Act as a wrapper for writing by compiled jumps to specific memory writing functions.
this.memoryHighWriter[e](this,e,t)},M.prototype.memoryWriteJumpCompile=function(){//Faster in some browsers, since we are doing less conditionals overall by implementing them in advance.
for(var e=0;e<=65535;e++)e<32768?this.cMBC1?e<8192?this.memoryWriter[e]=this.MBCWriteEnable:e<16384?this.memoryWriter[e]=this.MBC1WriteROMBank:e<24576?this.memoryWriter[e]=this.MBC1WriteRAMBank:this.memoryWriter[e]=this.MBC1WriteType:this.cMBC2?e<4096?this.memoryWriter[e]=this.MBCWriteEnable:e>=8448&&e<8704?this.memoryWriter[e]=this.MBC2WriteROMBank:this.memoryWriter[e]=this.cartIgnoreWrite:this.cMBC3?e<8192?this.memoryWriter[e]=this.MBCWriteEnable:e<16384?this.memoryWriter[e]=this.MBC3WriteROMBank:e<24576?this.memoryWriter[e]=this.MBC3WriteRAMBank:this.memoryWriter[e]=this.MBC3WriteRTCLatch:this.cMBC5||this.cRUMBLE||this.cMBC7?e<8192?this.memoryWriter[e]=this.MBCWriteEnable:e<12288?this.memoryWriter[e]=this.MBC5WriteROMBankLow:e<16384?this.memoryWriter[e]=this.MBC5WriteROMBankHigh:e<24576?this.memoryWriter[e]=this.cRUMBLE?this.RUMBLEWriteRAMBank:this.MBC5WriteRAMBank:this.memoryWriter[e]=this.cartIgnoreWrite:this.cHuC3?e<8192?this.memoryWriter[e]=this.MBCWriteEnable:e<16384?this.memoryWriter[e]=this.MBC3WriteROMBank:e<24576?this.memoryWriter[e]=this.HuC3WriteRAMBank:this.memoryWriter[e]=this.cartIgnoreWrite:this.memoryWriter[e]=this.cartIgnoreWrite:e<36864?this.memoryWriter[e]=this.cGBC?this.VRAMGBCDATAWrite:this.VRAMGBDATAWrite:e<38912?this.memoryWriter[e]=this.cGBC?this.VRAMGBCDATAWrite:this.VRAMGBDATAUpperWrite:e<40960?this.memoryWriter[e]=this.cGBC?this.VRAMGBCCHRMAPWrite:this.VRAMGBCHRMAPWrite:e<49152?this.numRAMBanks==1/16&&e<41472||this.numRAMBanks>=1?this.cMBC3?this.memoryWriter[e]=this.memoryWriteMBC3RAM:this.memoryWriter[e]=this.memoryWriteMBCRAM:this.memoryWriter[e]=this.cartIgnoreWrite:e<57344?this.cGBC&&e>=53248?this.memoryWriter[e]=this.memoryWriteGBCRAM:this.memoryWriter[e]=this.memoryWriteNormal:e<65024?this.cGBC&&e>=61440?this.memoryWriter[e]=this.memoryWriteECHOGBCRAM:this.memoryWriter[e]=this.memoryWriteECHONormal:e<=65184?this.memoryWriter[e]=this.memoryWriteOAMRAM:e<65280?this.cGBC?this.memoryWriter[e]=this.memoryWriteNormal:this.memoryWriter[e]=this.cartIgnoreWrite:(//Start the I/O initialization by filling in the slots as normal memory:
this.memoryWriter[e]=this.memoryWriteNormal,this.memoryHighWriter[255&e]=this.memoryHighWriteNormal);this.registerWriteJumpCompile();//Compile the I/O write functions separately...
},M.prototype.MBCWriteEnable=function(e,t,r){//MBC RAM Bank Enable/Disable:
e.MBCRAMBanksEnabled=(15&r)==10;//If lower nibble is 0x0A, then enable, otherwise disable.
},M.prototype.MBC1WriteROMBank=function(e,t,r){//MBC1 ROM bank switching:
e.ROMBank1offs=96&e.ROMBank1offs|31&r,e.setCurrentMBC1ROMBank()},M.prototype.MBC1WriteRAMBank=function(e,t,r){//MBC1 RAM bank switching
e.MBC1Mode?(//4/32 Mode
e.currMBCRAMBank=3&r,e.currMBCRAMBankPosition=(e.currMBCRAMBank<<13)-40960):(//16/8 Mode
e.ROMBank1offs=(3&r)<<5|31&e.ROMBank1offs,e.setCurrentMBC1ROMBank())},M.prototype.MBC1WriteType=function(e,t,r){//MBC1 mode setting:
e.MBC1Mode=(1&r)==1,e.MBC1Mode?(e.ROMBank1offs&=31,e.setCurrentMBC1ROMBank()):(e.currMBCRAMBank=0,e.currMBCRAMBankPosition=-40960)},M.prototype.MBC2WriteROMBank=function(e,t,r){//MBC2 ROM bank switching:
e.ROMBank1offs=15&r,e.setCurrentMBC2AND3ROMBank()},M.prototype.MBC3WriteROMBank=function(e,t,r){//MBC3 ROM bank switching:
e.ROMBank1offs=127&r,e.setCurrentMBC2AND3ROMBank()},M.prototype.MBC3WriteRAMBank=function(e,t,r){e.currMBCRAMBank=r,r<4&&(e.currMBCRAMBankPosition=(e.currMBCRAMBank<<13)-40960)},M.prototype.MBC3WriteRTCLatch=function(e,t,r){0==r?e.RTCisLatched=!1:e.RTCisLatched||(//Copy over the current RTC time for reading.
e.RTCisLatched=!0,e.latchedSeconds=0|e.RTCSeconds,e.latchedMinutes=e.RTCMinutes,e.latchedHours=e.RTCHours,e.latchedLDays=255&e.RTCDays,e.latchedHDays=e.RTCDays>>8)},M.prototype.MBC5WriteROMBankLow=function(e,t,r){//MBC5 ROM bank switching:
e.ROMBank1offs=256&e.ROMBank1offs|r,e.setCurrentMBC5ROMBank()},M.prototype.MBC5WriteROMBankHigh=function(e,t,r){//MBC5 ROM bank switching (by least significant bit):
e.ROMBank1offs=(1&r)<<8|255&e.ROMBank1offs,e.setCurrentMBC5ROMBank()},M.prototype.MBC5WriteRAMBank=function(e,t,r){//MBC5 RAM bank switching
e.currMBCRAMBank=15&r,e.currMBCRAMBankPosition=(e.currMBCRAMBank<<13)-40960},M.prototype.RUMBLEWriteRAMBank=function(e,t,r){//MBC5 RAM bank switching
//Like MBC5, but bit 3 of the lower nibble is used for rumbling and bit 2 is ignored.
e.currMBCRAMBank=3&r,e.currMBCRAMBankPosition=(e.currMBCRAMBank<<13)-40960},M.prototype.HuC3WriteRAMBank=function(e,t,r){//HuC3 RAM bank switching
e.currMBCRAMBank=3&r,e.currMBCRAMBankPosition=(e.currMBCRAMBank<<13)-40960},M.prototype.cartIgnoreWrite=function(e,t,r){//We might have encountered illegal RAM writing or such, so just do nothing...
},M.prototype.memoryWriteNormal=function(e,t,r){e.memory[t]=r},M.prototype.memoryHighWriteNormal=function(e,t,r){e.memory[65280|t]=r},M.prototype.memoryWriteMBCRAM=function(e,t,r){(e.MBCRAMBanksEnabled||A[10])&&(e.MBCRam[t+e.currMBCRAMBankPosition]=r)},M.prototype.memoryWriteMBC3RAM=function(e,t,r){if(e.MBCRAMBanksEnabled||A[10])switch(e.currMBCRAMBank){case 0:case 1:case 2:case 3:e.MBCRam[t+e.currMBCRAMBankPosition]=r;break;case 8:r<60?e.RTCSeconds=r:e.currMBCRAMBank;break;case 9:r<60?e.RTCMinutes=r:e.currMBCRAMBank;break;case 10:r<24?e.RTCHours=r:e.currMBCRAMBank;break;case 11:e.RTCDays=255&r|256&e.RTCDays;break;case 12:e.RTCDayOverFlow=r>127,e.RTCHalt=(64&r)==64,e.RTCDays=(1&r)<<8|255&e.RTCDays;break;default:e.currMBCRAMBank}},M.prototype.memoryWriteGBCRAM=function(e,t,r){e.GBCMemory[t+e.gbcRamBankPosition]=r},M.prototype.memoryWriteOAMRAM=function(e,t,r){e.modeSTAT<2&&e.memory[t]!=r&&(e.graphicsJIT(),e.memory[t]=r)},M.prototype.memoryWriteECHOGBCRAM=function(e,t,r){e.GBCMemory[t+e.gbcRamBankPositionECHO]=r},M.prototype.memoryWriteECHONormal=function(e,t,r){e.memory[t-8192]=r},M.prototype.VRAMGBDATAWrite=function(e,t,r){e.modeSTAT<3&&e.memory[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.memory[t]=r,e.generateGBOAMTileLine(t))},M.prototype.VRAMGBDATAUpperWrite=function(e,t,r){e.modeSTAT<3&&e.memory[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.memory[t]=r,e.generateGBTileLine(t))},M.prototype.VRAMGBCDATAWrite=function(e,t,r){e.modeSTAT<3&&(0==e.currVRAMBank?e.memory[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.memory[t]=r,e.generateGBCTileLineBank1(t)):(t&=8191,e.VRAM[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.VRAM[t]=r,e.generateGBCTileLineBank2(t))))},M.prototype.VRAMGBCHRMAPWrite=function(e,t,r){e.modeSTAT<3&&(t&=2047,e.BGCHRBank1[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.BGCHRBank1[t]=r))},M.prototype.VRAMGBCCHRMAPWrite=function(e,t,r){e.modeSTAT<3&&(t&=2047,e.BGCHRCurrentBank[t]!=r&&(//JIT the graphics render queue:
e.graphicsJIT(),e.BGCHRCurrentBank[t]=r))},M.prototype.DMAWrite=function(e){this.halt||(this.CPUTicks+=4|e<<5<<this.doubleSpeedShifter);//Source address of the transfer:
var t=this.memory[65361]<<8|this.memory[65362],r=this.memory[65363]<<8|this.memory[65364],i=this.memoryReader;//JIT the graphics render queue:
this.graphicsJIT();var n=this.memory;//Determining which bank we're working on so we can optimize:
if(0==this.currVRAMBank)do r<6144?(n[32768|r]=i[t](this,t++),n[32769|r]=i[t](this,t++),n[32770|r]=i[t](this,t++),n[32771|r]=i[t](this,t++),n[32772|r]=i[t](this,t++),n[32773|r]=i[t](this,t++),n[32774|r]=i[t](this,t++),n[32775|r]=i[t](this,t++),n[32776|r]=i[t](this,t++),n[32777|r]=i[t](this,t++),n[32778|r]=i[t](this,t++),n[32779|r]=i[t](this,t++),n[32780|r]=i[t](this,t++),n[32781|r]=i[t](this,t++),n[32782|r]=i[t](this,t++),n[32783|r]=i[t](this,t++),this.generateGBCTileBank1(r),r+=16):(r&=2032,this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),this.BGCHRBank1[r++]=i[t](this,t++),r=r+6144&8176),t&=65520,--e;while(e>0)else{var s=this.VRAM;//DMA transfer for VRAM bank 1:
do r<6144?(s[r]=i[t](this,t++),s[1|r]=i[t](this,t++),s[2|r]=i[t](this,t++),s[3|r]=i[t](this,t++),s[4|r]=i[t](this,t++),s[5|r]=i[t](this,t++),s[6|r]=i[t](this,t++),s[7|r]=i[t](this,t++),s[8|r]=i[t](this,t++),s[9|r]=i[t](this,t++),s[10|r]=i[t](this,t++),s[11|r]=i[t](this,t++),s[12|r]=i[t](this,t++),s[13|r]=i[t](this,t++),s[14|r]=i[t](this,t++),s[15|r]=i[t](this,t++),this.generateGBCTileBank2(r),r+=16):(r&=2032,this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),this.BGCHRBank2[r++]=i[t](this,t++),r=r+6144&8176),t&=65520,--e;while(e>0)}//Update the HDMA registers to their next addresses:
n[65361]=t>>8,n[65362]=240&t,n[65363]=r>>8,n[65364]=240&r},M.prototype.registerWriteJumpCompile=function(){//I/O Registers (GB + GBC):
//JoyPad
this.memoryHighWriter[0]=this.memoryWriter[65280]=function(e,t,r){e.memory[65280]=48&r|((32&r)==0?e.JoyPad>>4:15)&((16&r)==0?15&e.JoyPad:15)},//SB (Serial Transfer Data)
this.memoryHighWriter[1]=this.memoryWriter[65281]=function(e,t,r){e.memory[65282]<128&&(e.memory[65281]=r)},//SC (Serial Transfer Control):
this.memoryHighWriter[2]=this.memoryHighWriteNormal,this.memoryWriter[65282]=this.memoryWriteNormal,//Unmapped I/O:
this.memoryHighWriter[3]=this.memoryWriter[65283]=this.cartIgnoreWrite,//DIV
this.memoryHighWriter[4]=this.memoryWriter[65284]=function(e,t,r){e.DIVTicks&=255,e.memory[65284]=0},//TIMA
this.memoryHighWriter[5]=this.memoryWriter[65285]=function(e,t,r){e.memory[65285]=r},//TMA
this.memoryHighWriter[6]=this.memoryWriter[65286]=function(e,t,r){e.memory[65286]=r},//TAC
this.memoryHighWriter[7]=this.memoryWriter[65287]=function(e,t,r){e.memory[65287]=7&r,e.TIMAEnabled=(4&r)==4,e.TACClocker=Math.pow(4,(3&r)!=0?3&r:4)<<2},//Unmapped I/O:
this.memoryHighWriter[8]=this.memoryWriter[65288]=this.cartIgnoreWrite,this.memoryHighWriter[9]=this.memoryWriter[65289]=this.cartIgnoreWrite,this.memoryHighWriter[10]=this.memoryWriter[65290]=this.cartIgnoreWrite,this.memoryHighWriter[11]=this.memoryWriter[65291]=this.cartIgnoreWrite,this.memoryHighWriter[12]=this.memoryWriter[65292]=this.cartIgnoreWrite,this.memoryHighWriter[13]=this.memoryWriter[65293]=this.cartIgnoreWrite,this.memoryHighWriter[14]=this.memoryWriter[65294]=this.cartIgnoreWrite,//IF (Interrupt Request)
this.memoryHighWriter[15]=this.memoryWriter[65295]=function(e,t,r){e.interruptsRequested=r,e.checkIRQMatching()},//NR10:
this.memoryHighWriter[16]=this.memoryWriter[65296]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel1decreaseSweep&&(8&r)==0&&e.channel1Swept&&(e.channel1SweepFault=!0),e.channel1lastTimeSweep=(112&r)>>4,e.channel1frequencySweepDivider=7&r,e.channel1decreaseSweep=(8&r)==8,e.memory[65296]=r,e.channel1EnableCheck())},//NR11:
this.memoryHighWriter[17]=this.memoryWriter[65297]=function(e,t,r){(e.soundMasterEnabled||!e.cGBC)&&(e.soundMasterEnabled?e.audioJIT():r&=63,e.channel1CachedDuty=e.dutyLookup[r>>6],e.channel1totalLength=64-(63&r),e.memory[65297]=r,e.channel1EnableCheck())},//NR12:
this.memoryHighWriter[18]=this.memoryWriter[65298]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel1Enabled&&0==e.channel1envelopeSweeps&&(((e.memory[65298]^r)&8)==8?((8&e.memory[65298])==0&&((7&e.memory[65298])==7?e.channel1envelopeVolume+=2:++e.channel1envelopeVolume),e.channel1envelopeVolume=16-e.channel1envelopeVolume&15):(15&e.memory[65298])==8&&(e.channel1envelopeVolume=1+e.channel1envelopeVolume&15),e.channel1OutputLevelCache()),e.channel1envelopeType=(8&r)==8,e.memory[65298]=r,e.channel1VolumeEnableCheck())},//NR13:
this.memoryHighWriter[19]=this.memoryWriter[65299]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel1frequency=1792&e.channel1frequency|r,e.channel1FrequencyTracker=2048-e.channel1frequency<<2)},//NR14:
this.memoryHighWriter[20]=this.memoryWriter[65300]=function(e,t,r){if(e.soundMasterEnabled){if(e.audioJIT(),e.channel1consecutive=(64&r)==0,e.channel1frequency=(7&r)<<8|255&e.channel1frequency,e.channel1FrequencyTracker=2048-e.channel1frequency<<2,r>127){//Reload 0xFF10:
e.channel1timeSweep=e.channel1lastTimeSweep,e.channel1Swept=!1;//Reload 0xFF12:
var i=e.memory[65298];e.channel1envelopeVolume=i>>4,e.channel1OutputLevelCache(),e.channel1envelopeSweepsLast=(7&i)-1,0==e.channel1totalLength&&(e.channel1totalLength=64),e.channel1lastTimeSweep>0||e.channel1frequencySweepDivider>0?e.memory[65318]|=1:e.memory[65318]&=254,(64&r)==64&&(e.memory[65318]|=1),e.channel1ShadowFrequency=e.channel1frequency,//Reset frequency overflow check + frequency sweep type check:
e.channel1SweepFault=!1,//Supposed to run immediately:
e.channel1AudioSweepPerformDummy()}e.channel1EnableCheck(),e.memory[65300]=r}},//NR20 (Unused I/O):
this.memoryHighWriter[21]=this.memoryWriter[65301]=this.cartIgnoreWrite,//NR21:
this.memoryHighWriter[22]=this.memoryWriter[65302]=function(e,t,r){(e.soundMasterEnabled||!e.cGBC)&&(e.soundMasterEnabled?e.audioJIT():r&=63,e.channel2CachedDuty=e.dutyLookup[r>>6],e.channel2totalLength=64-(63&r),e.memory[65302]=r,e.channel2EnableCheck())},//NR22:
this.memoryHighWriter[23]=this.memoryWriter[65303]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel2Enabled&&0==e.channel2envelopeSweeps&&(((e.memory[65303]^r)&8)==8?((8&e.memory[65303])==0&&((7&e.memory[65303])==7?e.channel2envelopeVolume+=2:++e.channel2envelopeVolume),e.channel2envelopeVolume=16-e.channel2envelopeVolume&15):(15&e.memory[65303])==8&&(e.channel2envelopeVolume=1+e.channel2envelopeVolume&15),e.channel2OutputLevelCache()),e.channel2envelopeType=(8&r)==8,e.memory[65303]=r,e.channel2VolumeEnableCheck())},//NR23:
this.memoryHighWriter[24]=this.memoryWriter[65304]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel2frequency=1792&e.channel2frequency|r,e.channel2FrequencyTracker=2048-e.channel2frequency<<2)},//NR24:
this.memoryHighWriter[25]=this.memoryWriter[65305]=function(e,t,r){if(e.soundMasterEnabled){if(e.audioJIT(),r>127){//Reload 0xFF17:
var i=e.memory[65303];e.channel2envelopeVolume=i>>4,e.channel2OutputLevelCache(),e.channel2envelopeSweepsLast=(7&i)-1,0==e.channel2totalLength&&(e.channel2totalLength=64),(64&r)==64&&(e.memory[65318]|=2)}e.channel2consecutive=(64&r)==0,e.channel2frequency=(7&r)<<8|255&e.channel2frequency,e.channel2FrequencyTracker=2048-e.channel2frequency<<2,e.memory[65305]=r,e.channel2EnableCheck()}},//NR30:
this.memoryHighWriter[26]=this.memoryWriter[65306]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),!e.channel3canPlay&&r>=128&&(e.channel3lastSampleLookup=0,e.channel3UpdateCache()),e.channel3canPlay=r>127,e.channel3canPlay&&e.memory[65306]>127&&!e.channel3consecutive&&(e.memory[65318]|=4),e.memory[65306]=r)},//NR31:
this.memoryHighWriter[27]=this.memoryWriter[65307]=function(e,t,r){(e.soundMasterEnabled||!e.cGBC)&&(e.soundMasterEnabled&&e.audioJIT(),e.channel3totalLength=256-r,e.channel3EnableCheck())},//NR32:
this.memoryHighWriter[28]=this.memoryWriter[65308]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),r&=96,e.memory[65308]=r,e.channel3patternType=0==r?4:(r>>5)-1)},//NR33:
this.memoryHighWriter[29]=this.memoryWriter[65309]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel3frequency=1792&e.channel3frequency|r,e.channel3FrequencyPeriod=2048-e.channel3frequency<<1)},//NR34:
this.memoryHighWriter[30]=this.memoryWriter[65310]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),r>127&&(0==e.channel3totalLength&&(e.channel3totalLength=256),e.channel3lastSampleLookup=0,(64&r)==64&&(e.memory[65318]|=4)),e.channel3consecutive=(64&r)==0,e.channel3frequency=(7&r)<<8|255&e.channel3frequency,e.channel3FrequencyPeriod=2048-e.channel3frequency<<1,e.memory[65310]=r,e.channel3EnableCheck())},//NR40 (Unused I/O):
this.memoryHighWriter[31]=this.memoryWriter[65311]=this.cartIgnoreWrite,//NR41:
this.memoryHighWriter[32]=this.memoryWriter[65312]=function(e,t,r){(e.soundMasterEnabled||!e.cGBC)&&(e.soundMasterEnabled&&e.audioJIT(),e.channel4totalLength=64-(63&r),e.channel4EnableCheck())},//NR42:
this.memoryHighWriter[33]=this.memoryWriter[65313]=function(e,t,r){e.soundMasterEnabled&&(e.audioJIT(),e.channel4Enabled&&0==e.channel4envelopeSweeps&&(((e.memory[65313]^r)&8)==8?((8&e.memory[65313])==0&&((7&e.memory[65313])==7?e.channel4envelopeVolume+=2:++e.channel4envelopeVolume),e.channel4envelopeVolume=16-e.channel4envelopeVolume&15):(15&e.memory[65313])==8&&(e.channel4envelopeVolume=1+e.channel4envelopeVolume&15),e.channel4currentVolume=e.channel4envelopeVolume<<e.channel4VolumeShifter),e.channel4envelopeType=(8&r)==8,e.memory[65313]=r,e.channel4UpdateCache(),e.channel4VolumeEnableCheck())},//NR43:
this.memoryHighWriter[34]=this.memoryWriter[65314]=function(e,t,r){if(e.soundMasterEnabled){e.audioJIT(),e.channel4FrequencyPeriod=Math.max((7&r)<<4,8)<<(r>>4);var i=8&r;(8==i&&32767==e.channel4BitRange||0==i&&127==e.channel4BitRange)&&(e.channel4lastSampleLookup=0,e.channel4BitRange=8==i?127:32767,e.channel4VolumeShifter=8==i?7:15,e.channel4currentVolume=e.channel4envelopeVolume<<e.channel4VolumeShifter,e.noiseSampleTable=8==i?e.LSFR7Table:e.LSFR15Table),e.memory[65314]=r,e.channel4UpdateCache()}},//NR44:
this.memoryHighWriter[35]=this.memoryWriter[65315]=function(e,t,r){if(e.soundMasterEnabled){if(e.audioJIT(),e.memory[65315]=r,e.channel4consecutive=(64&r)==0,r>127){var i=e.memory[65313];e.channel4envelopeVolume=i>>4,e.channel4currentVolume=e.channel4envelopeVolume<<e.channel4VolumeShifter,e.channel4envelopeSweepsLast=(7&i)-1,0==e.channel4totalLength&&(e.channel4totalLength=64),(64&r)==64&&(e.memory[65318]|=8)}e.channel4EnableCheck()}},//NR50:
this.memoryHighWriter[36]=this.memoryWriter[65316]=function(e,t,r){e.soundMasterEnabled&&e.memory[65316]!=r&&(e.audioJIT(),e.memory[65316]=r,e.VinLeftChannelMasterVolume=(r>>4&7)+1,e.VinRightChannelMasterVolume=(7&r)+1,e.mixerOutputLevelCache())},//NR51:
this.memoryHighWriter[37]=this.memoryWriter[65317]=function(e,t,r){e.soundMasterEnabled&&e.memory[65317]!=r&&(e.audioJIT(),e.memory[65317]=r,e.rightChannel1=(1&r)==1,e.rightChannel2=(2&r)==2,e.rightChannel3=(4&r)==4,e.rightChannel4=(8&r)==8,e.leftChannel1=(16&r)==16,e.leftChannel2=(32&r)==32,e.leftChannel3=(64&r)==64,e.leftChannel4=r>127,e.channel1OutputLevelCache(),e.channel2OutputLevelCache(),e.channel3OutputLevelCache(),e.channel4OutputLevelCache())},//NR52:
this.memoryHighWriter[38]=this.memoryWriter[65318]=function(e,t,r){if(e.audioJIT(),!e.soundMasterEnabled&&r>127)e.memory[65318]=128,e.soundMasterEnabled=!0,e.initializeAudioStartState();else if(e.soundMasterEnabled&&r<128){e.memory[65318]=0,e.soundMasterEnabled=!1;//GBDev wiki says the registers are written with zeros on power off:
for(var i=65296;i<65318;i++)e.memoryWriter[i](e,i,0)}},//0xFF27 to 0xFF2F don't do anything...
this.memoryHighWriter[39]=this.memoryWriter[65319]=this.cartIgnoreWrite,this.memoryHighWriter[40]=this.memoryWriter[65320]=this.cartIgnoreWrite,this.memoryHighWriter[41]=this.memoryWriter[65321]=this.cartIgnoreWrite,this.memoryHighWriter[42]=this.memoryWriter[65322]=this.cartIgnoreWrite,this.memoryHighWriter[43]=this.memoryWriter[65323]=this.cartIgnoreWrite,this.memoryHighWriter[44]=this.memoryWriter[65324]=this.cartIgnoreWrite,this.memoryHighWriter[45]=this.memoryWriter[65325]=this.cartIgnoreWrite,this.memoryHighWriter[46]=this.memoryWriter[65326]=this.cartIgnoreWrite,this.memoryHighWriter[47]=this.memoryWriter[65327]=this.cartIgnoreWrite,//WAVE PCM RAM:
this.memoryHighWriter[48]=this.memoryWriter[65328]=function(e,t,r){e.channel3WriteRAM(0,r)},this.memoryHighWriter[49]=this.memoryWriter[65329]=function(e,t,r){e.channel3WriteRAM(1,r)},this.memoryHighWriter[50]=this.memoryWriter[65330]=function(e,t,r){e.channel3WriteRAM(2,r)},this.memoryHighWriter[51]=this.memoryWriter[65331]=function(e,t,r){e.channel3WriteRAM(3,r)},this.memoryHighWriter[52]=this.memoryWriter[65332]=function(e,t,r){e.channel3WriteRAM(4,r)},this.memoryHighWriter[53]=this.memoryWriter[65333]=function(e,t,r){e.channel3WriteRAM(5,r)},this.memoryHighWriter[54]=this.memoryWriter[65334]=function(e,t,r){e.channel3WriteRAM(6,r)},this.memoryHighWriter[55]=this.memoryWriter[65335]=function(e,t,r){e.channel3WriteRAM(7,r)},this.memoryHighWriter[56]=this.memoryWriter[65336]=function(e,t,r){e.channel3WriteRAM(8,r)},this.memoryHighWriter[57]=this.memoryWriter[65337]=function(e,t,r){e.channel3WriteRAM(9,r)},this.memoryHighWriter[58]=this.memoryWriter[65338]=function(e,t,r){e.channel3WriteRAM(10,r)},this.memoryHighWriter[59]=this.memoryWriter[65339]=function(e,t,r){e.channel3WriteRAM(11,r)},this.memoryHighWriter[60]=this.memoryWriter[65340]=function(e,t,r){e.channel3WriteRAM(12,r)},this.memoryHighWriter[61]=this.memoryWriter[65341]=function(e,t,r){e.channel3WriteRAM(13,r)},this.memoryHighWriter[62]=this.memoryWriter[65342]=function(e,t,r){e.channel3WriteRAM(14,r)},this.memoryHighWriter[63]=this.memoryWriter[65343]=function(e,t,r){e.channel3WriteRAM(15,r)},//SCY
this.memoryHighWriter[66]=this.memoryWriter[65346]=function(e,t,r){e.backgroundY!=r&&(e.midScanLineJIT(),e.backgroundY=r)},//SCX
this.memoryHighWriter[67]=this.memoryWriter[65347]=function(e,t,r){e.backgroundX!=r&&(e.midScanLineJIT(),e.backgroundX=r)},//LY
this.memoryHighWriter[68]=this.memoryWriter[65348]=function(e,t,r){//Read Only:
e.LCDisOn&&(//Gambatte says to do this:
e.modeSTAT=2,e.midScanlineOffset=-1,e.totalLinesPassed=e.currentX=e.queuedScanLines=e.lastUnrenderedLine=e.LCDTicks=e.STATTracker=e.actualScanLine=e.memory[65348]=0)},//LYC
this.memoryHighWriter[69]=this.memoryWriter[65349]=function(e,t,r){e.memory[65349]!=r&&(e.memory[65349]=r,e.LCDisOn&&e.matchLYC())},//WY
this.memoryHighWriter[74]=this.memoryWriter[65354]=function(e,t,r){e.windowY!=r&&(e.midScanLineJIT(),e.windowY=r)},//WX
this.memoryHighWriter[75]=this.memoryWriter[65355]=function(e,t,r){e.memory[65355]!=r&&(e.midScanLineJIT(),e.memory[65355]=r,e.windowX=r-7)},this.memoryHighWriter[114]=this.memoryWriter[65394]=function(e,t,r){e.memory[65394]=r},this.memoryHighWriter[115]=this.memoryWriter[65395]=function(e,t,r){e.memory[65395]=r},this.memoryHighWriter[117]=this.memoryWriter[65397]=function(e,t,r){e.memory[65397]=r},this.memoryHighWriter[118]=this.memoryWriter[65398]=this.cartIgnoreWrite,this.memoryHighWriter[119]=this.memoryWriter[65399]=this.cartIgnoreWrite,//IE (Interrupt Enable)
this.memoryHighWriter[255]=this.memoryWriter[65535]=function(e,t,r){e.interruptsEnabled=r,e.checkIRQMatching()},this.recompileModelSpecificIOWriteHandling(),this.recompileBootIOWriteHandling()},M.prototype.recompileModelSpecificIOWriteHandling=function(){this.cGBC?(//GameBoy Color Specific I/O:
//SC (Serial Transfer Control Register)
this.memoryHighWriter[2]=this.memoryWriter[65282]=function(e,t,r){(1&r)==1?(//Internal clock:
e.memory[65282]=127&r,e.serialTimer=(2&r)==0?4096:128,e.serialShiftTimer=e.serialShiftTimerAllocated=(2&r)==0?512:16):(//External clock:
e.memory[65282]=r,e.serialShiftTimer=e.serialShiftTimerAllocated=e.serialTimer=0)},this.memoryHighWriter[64]=this.memoryWriter[65344]=function(e,t,r){if(e.memory[65344]!=r){e.midScanLineJIT();var i=r>127;i!=e.LCDisOn&&(//When the display mode changes...
e.LCDisOn=i,e.memory[65345]&=120,e.midScanlineOffset=-1,e.totalLinesPassed=e.currentX=e.queuedScanLines=e.lastUnrenderedLine=e.STATTracker=e.LCDTicks=e.actualScanLine=e.memory[65348]=0,e.LCDisOn?(e.modeSTAT=2,e.matchLYC(),e.LCDCONTROL=e.LINECONTROL):(e.modeSTAT=0,e.LCDCONTROL=e.DISPLAYOFFCONTROL,e.DisplayShowOff()),e.interruptsRequested&=253),e.gfxWindowCHRBankPosition=(64&r)==64?1024:0,e.gfxWindowDisplay=(32&r)==32,e.gfxBackgroundBankOffset=(16&r)==16?0:128,e.gfxBackgroundCHRBankPosition=(8&r)==8?1024:0,e.gfxSpriteNormalHeight=(4&r)==0,e.gfxSpriteShow=(2&r)==2,e.BGPriorityEnabled=(1&r)==1,e.priorityFlaggingPathRebuild(),e.memory[65344]=r}},this.memoryHighWriter[65]=this.memoryWriter[65345]=function(e,t,r){e.LYCMatchTriggerSTAT=(64&r)==64,e.mode2TriggerSTAT=(32&r)==32,e.mode1TriggerSTAT=(16&r)==16,e.mode0TriggerSTAT=(8&r)==8,e.memory[65345]=120&r},this.memoryHighWriter[70]=this.memoryWriter[65350]=function(e,t,r){if(e.memory[65350]=r,r<224){r<<=8,t=65024;var i=e.modeSTAT;e.modeSTAT=0;var n=0;do if((n=e.memoryReader[r](e,r++))!=e.memory[t]){//JIT the graphics render queue:
e.modeSTAT=i,e.graphicsJIT(),e.modeSTAT=0,e.memory[t++]=n;break}while(++t<65184)if(t<65184)do e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++);while(t<65184)e.modeSTAT=i}},//KEY1
this.memoryHighWriter[77]=this.memoryWriter[65357]=function(e,t,r){e.memory[65357]=127&r|128&e.memory[65357]},this.memoryHighWriter[79]=this.memoryWriter[65359]=function(e,t,r){e.currVRAMBank=1&r,e.currVRAMBank>0?e.BGCHRCurrentBank=e.BGCHRBank2:e.BGCHRCurrentBank=e.BGCHRBank1;//Only writable by GBC.
},this.memoryHighWriter[81]=this.memoryWriter[65361]=function(e,t,r){e.hdmaRunning||(e.memory[65361]=r)},this.memoryHighWriter[82]=this.memoryWriter[65362]=function(e,t,r){e.hdmaRunning||(e.memory[65362]=240&r)},this.memoryHighWriter[83]=this.memoryWriter[65363]=function(e,t,r){e.hdmaRunning||(e.memory[65363]=31&r)},this.memoryHighWriter[84]=this.memoryWriter[65364]=function(e,t,r){e.hdmaRunning||(e.memory[65364]=240&r)},this.memoryHighWriter[85]=this.memoryWriter[65365]=function(e,t,r){e.hdmaRunning?(128&r)==0?(//Stop H-Blank DMA
e.hdmaRunning=!1,e.memory[65365]|=128):e.memory[65365]=127&r:(128&r)==0?(//DMA
e.DMAWrite((127&r)+1),e.memory[65365]=255):(//H-Blank DMA
e.hdmaRunning=!0,e.memory[65365]=127&r)},this.memoryHighWriter[104]=this.memoryWriter[65384]=function(e,t,r){e.memory[65385]=e.gbcBGRawPalette[63&r],e.memory[65384]=r},this.memoryHighWriter[105]=this.memoryWriter[65385]=function(e,t,r){if(e.updateGBCBGPalette(63&e.memory[65384],r),e.memory[65384]>127){var i=e.memory[65384]+1&63;e.memory[65384]=128|i,e.memory[65385]=e.gbcBGRawPalette[i]}else e.memory[65385]=r},this.memoryHighWriter[106]=this.memoryWriter[65386]=function(e,t,r){e.memory[65387]=e.gbcOBJRawPalette[63&r],e.memory[65386]=r},this.memoryHighWriter[107]=this.memoryWriter[65387]=function(e,t,r){if(e.updateGBCOBJPalette(63&e.memory[65386],r),e.memory[65386]>127){var i=e.memory[65386]+1&63;e.memory[65386]=128|i,e.memory[65387]=e.gbcOBJRawPalette[i]}else e.memory[65387]=r},//SVBK
this.memoryHighWriter[112]=this.memoryWriter[65392]=function(e,t,r){var i=e.memory[65361]<<8|e.memory[65362];//Cannot change the RAM bank while WRAM is the source of a running HDMA.
(!e.hdmaRunning||i<53248||i>=57344)&&(e.gbcRamBank=Math.max(7&r,1),e.gbcRamBankPosition=(e.gbcRamBank-1<<12)-53248,e.gbcRamBankPositionECHO=e.gbcRamBankPosition-8192),e.memory[65392]=r},this.memoryHighWriter[116]=this.memoryWriter[65396]=function(e,t,r){e.memory[65396]=r}):(//Fill in the GameBoy Color I/O registers as normal RAM for GameBoy compatibility:
//SC (Serial Transfer Control Register)
this.memoryHighWriter[2]=this.memoryWriter[65282]=function(e,t,r){(1&r)==1?(//Internal clock:
e.memory[65282]=127&r,e.serialTimer=4096,e.serialShiftTimer=e.serialShiftTimerAllocated=512):(//External clock:
e.memory[65282]=r,e.serialShiftTimer=e.serialShiftTimerAllocated=e.serialTimer=0)},this.memoryHighWriter[64]=this.memoryWriter[65344]=function(e,t,r){if(e.memory[65344]!=r){e.midScanLineJIT();var i=r>127;i!=e.LCDisOn&&(//When the display mode changes...
e.LCDisOn=i,e.memory[65345]&=120,e.midScanlineOffset=-1,e.totalLinesPassed=e.currentX=e.queuedScanLines=e.lastUnrenderedLine=e.STATTracker=e.LCDTicks=e.actualScanLine=e.memory[65348]=0,e.LCDisOn?(e.modeSTAT=2,e.matchLYC(),e.LCDCONTROL=e.LINECONTROL):(e.modeSTAT=0,e.LCDCONTROL=e.DISPLAYOFFCONTROL,e.DisplayShowOff()),e.interruptsRequested&=253),e.gfxWindowCHRBankPosition=(64&r)==64?1024:0,e.gfxWindowDisplay=(32&r)==32,e.gfxBackgroundBankOffset=(16&r)==16?0:128,e.gfxBackgroundCHRBankPosition=(8&r)==8?1024:0,e.gfxSpriteNormalHeight=(4&r)==0,e.gfxSpriteShow=(2&r)==2,e.bgEnabled=(1&r)==1,e.memory[65344]=r}},this.memoryHighWriter[65]=this.memoryWriter[65345]=function(e,t,r){e.LYCMatchTriggerSTAT=(64&r)==64,e.mode2TriggerSTAT=(32&r)==32,e.mode1TriggerSTAT=(16&r)==16,e.mode0TriggerSTAT=(8&r)==8,e.memory[65345]=120&r,(!e.usedBootROM||!e.usedGBCBootROM)&&e.LCDisOn&&e.modeSTAT<2&&(e.interruptsRequested|=2,e.checkIRQMatching())},this.memoryHighWriter[70]=this.memoryWriter[65350]=function(e,t,r){if(e.memory[65350]=r,r>127&&r<224){r<<=8,t=65024;var i=e.modeSTAT;e.modeSTAT=0;var n=0;do if((n=e.memoryReader[r](e,r++))!=e.memory[t]){//JIT the graphics render queue:
e.modeSTAT=i,e.graphicsJIT(),e.modeSTAT=0,e.memory[t++]=n;break}while(++t<65184)if(t<65184)do e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++),e.memory[t++]=e.memoryReader[r](e,r++);while(t<65184)e.modeSTAT=i}},this.memoryHighWriter[71]=this.memoryWriter[65351]=function(e,t,r){e.memory[65351]!=r&&(e.midScanLineJIT(),e.updateGBBGPalette(r),e.memory[65351]=r)},this.memoryHighWriter[72]=this.memoryWriter[65352]=function(e,t,r){e.memory[65352]!=r&&(e.midScanLineJIT(),e.updateGBOBJPalette(0,r),e.memory[65352]=r)},this.memoryHighWriter[73]=this.memoryWriter[65353]=function(e,t,r){e.memory[65353]!=r&&(e.midScanLineJIT(),e.updateGBOBJPalette(4,r),e.memory[65353]=r)},this.memoryHighWriter[77]=this.memoryWriter[65357]=function(e,t,r){e.memory[65357]=r},this.memoryHighWriter[79]=this.memoryWriter[65359]=this.cartIgnoreWrite,this.memoryHighWriter[85]=this.memoryWriter[65365]=this.cartIgnoreWrite,this.memoryHighWriter[104]=this.memoryWriter[65384]=this.cartIgnoreWrite,this.memoryHighWriter[105]=this.memoryWriter[65385]=this.cartIgnoreWrite,this.memoryHighWriter[106]=this.memoryWriter[65386]=this.cartIgnoreWrite,this.memoryHighWriter[107]=this.memoryWriter[65387]=this.cartIgnoreWrite,this.memoryHighWriter[108]=this.memoryWriter[65388]=this.cartIgnoreWrite,this.memoryHighWriter[112]=this.memoryWriter[65392]=this.cartIgnoreWrite,this.memoryHighWriter[116]=this.memoryWriter[65396]=this.cartIgnoreWrite)},M.prototype.recompileBootIOWriteHandling=function(){//Boot I/O Registers:
this.inBootstrap?(this.memoryHighWriter[80]=this.memoryWriter[65360]=function(e,t,r){e.inBootstrap=!1,e.disableBootROM(),e.memory[65360]=r},this.cGBC&&(this.memoryHighWriter[108]=this.memoryWriter[65388]=function(e,t,r){e.inBootstrap&&(e.cGBC=(1&r)==0,e.name+e.gameCode+e.ROM[323]=="Game and Watch 50"&&(e.cGBC=!0),e.cGBC),e.memory[65388]=r})):this.memoryHighWriter[80]=this.memoryWriter[65360]=this.cartIgnoreWrite},//Helper Functions
M.prototype.toTypedArray=function(e,t){try{if(A[5])return e;if(!e||!e.length)return[];var r=e.length;switch(t){case"uint8":var i=new Uint8Array(r);break;case"int8":var i=new Int8Array(r);break;case"int32":var i=new Int32Array(r);break;case"float32":var i=new Float32Array(r)}for(var n=0;n<r;n++)i[n]=e[n];return i}catch(t){return t.message,e}},M.prototype.fromTypedArray=function(e){try{if(!e||!e.length)return[];for(var t=[],r=0;r<e.length;++r)t[r]=e[r];return t}catch(t){return t.message,e}},M.prototype.getTypedArray=function(e,t,r){try{if(A[5])throw Error("Settings forced typed arrays to be disabled.");switch(r){case"int8":var i=new Int8Array(e);break;case"uint8":var i=new Uint8Array(e);break;case"int32":var i=new Int32Array(e);break;case"float32":var i=new Float32Array(e)}if(0!=t)for(var n=0;n<e;)i[n++]=t}catch(r){r.message;for(var i=[],n=0;n<e;)i[n++]=t}return i},L=M;const P={RIGHT:0,LEFT:1,UP:2,DOWN:3,A:4,B:5,SELECT:6,START:7},v="_"+g.hrtime().join(".");function O(){let e=this[v]={__proto__:O._prototype,gameboy:null,frames:0,pressed:Array(Object.keys(P).length)};e[v]=e}O._prototype={//Check to make sure the gameboy object has been created.
initialized:function(){let e=this[v];return"object"==typeof e.gameboy&&null!=e.gameboy},/*
     *Make sure that the emulator is "running" (note that this is different than play/pause)
     *Think of it like turning the key in your ignition before you start driving your car
     *TODO: does `true` mean it's running or does `true` mean it's stopped?
     */running:function(){return(2&this[v].gameboy.stopEmulator)==0},/*
     * Presses or releases a key
     * - note that in the gameboy core, a key will stay pressed until it has been explicitly released.
     * - will do nothing if the emulator is running
     *
     * @param keycode 1-8 number of the key to press (see Interface.KEYCODES)
     * @param `true` to press key, `false` to release
     */sendKey:function(e,t){let r=this[v];r.initialized()&&r.running()&&r.gameboy.JoyPadEvent(e,t)},//Stop emulator, reset relevant variables
shutdownEmulation:function(){let e=this[v];e.initialized()&&e.running()&&(e.gameboy.stopEmulator|=2,e.frames=0)}},O.prototype={constructor:O,/*
     * Load a ROM - like popping in a new cartridge
     * - Won't do anything if the emulator hasn't been initialized.
     *
     * TODO: better documentation on what ROMs are and how they should be formatted.
     */loadRom:function(e,t){let r=this[v];return(// if (!_that.initialized()) {
//     return false;
// }
//TODO: autosave last state?
r.shutdownEmulation(),r.gameboy=new L(e),r.gameboy.openMBC=function(e){/* TODO: you can load in from a specific title? Kind of cool, I guess. */return t||[]},//Start emulator (some logic in here that needs to be documented)
r.gameboy.start(),r.gameboy.stopEmulator&=1,r.gameboy.iterations=0,!0)},/*
     * Emulates a single frame
     *
     * TODO: add documentation for imageData
     * @param partial - DEPRECATED - whether or not to render the entire screen or just the changed bits
     * @returns Array - image data for that frame, which can later be converted into a canvas writeable format
     */doFrame:function(e){let t=this[v];//Press required keys
for(let e=t.pressed.length-1;e>=0;e--)t.pressed[e]&&t.sendKey(e,!0);for(t.gameboy.frameDone=!1;!t.gameboy.frameDone;)t.gameboy.run();//Run internal logic until the entire frame as finished.
//Release all keys
for(let e=t.pressed.length-1;e>=0;e--)t.pressed[e]=!1,t.sendKey(e,!1);return++t.frames,e?t.gameboy.partialScreen:t.gameboy.currentScreen},/*
     * Pass in an array of keys you want pressed
     * - this array should be propogated with values from ``Interface.KEYMAP``
     * - you can not undo a press. Once a key is pressed it stays pressed until the end of the frame.
     */pressKeys:function(e){e=e||[];for(let t=e.length-1;t>=0;t--)this.pressKey(e[t])},/*
     * Presses a key corresponding with ``Interface.KEYMAP``
     * - you can not undo a press. Once a key is pressed it stays pressed until the end of the frame.
     */pressKey:function(e){let t=this[v];"string"==typeof e&&(e=P[e.toUpperCase()]),e<t.pressed.length&&null!=e&&(t.pressed[e]=!0)},/*
     * Returns an array of all currently pressed keys
     * - built using the enum ``Interface.KEYMAP``
     */getKeys:function(){return this[v].pressed.slice(0)},getScreen:function(){return this[v].gameboy.currentScreen},/*
     * Gets a block of memory, you can specify a start and an end if you want
     * - this is an expensive operation and should be called sparingly
     *
     * TODO perf test ``slice`` vs a ``for`` loop
     */getMemory:function(e,t){let r=this[v];return(e=e||0,t=t||r.gameboy.memory.length-1,e=Math.max(e,0),t=Math.min(t,r.gameboy.memory.length-1),0===e&&t===r.gameboy.memory.length-1)?r.gameboy.memory:r.gameboy.memory.slice(e,t);//Is it for speed?
},getAudio:function(){return this[v].gameboy.audioBuffer},getSaveData:function(){return this[v].gameboy.saveSRAMState()},setMemory:function(e,t){let r=this[v];e=Math.max(e,0);for(let i=0;i<e.length;i++)r.gameboy.memory[e+i]=t[i]}},O.KEYMAP=P,f=O;var E={};E=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},n=function(e){// go through the array every three bytes, we'll deal with trailing stuff later
for(var t,r=e.length,i=r%3// if we have 1 byte left, pad 2 bytes
,n=[],s=0,a=r-i;s<a;s+=16383// must be multiple of 3
)n.push(function(e,t,r){for(var i,n=[],s=t;s<r;s+=3)n.push(W[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+W[i>>12&63]+W[i>>6&63]+W[63&i]);return n.join("")}(e,s,s+16383>a?a:s+16383));return 1===i?n.push(W[(t=e[r-1])>>2]+W[t<<4&63]+"=="):2===i&&n.push(W[(t=(e[r-2]<<8)+e[r-1])>>10]+W[t>>4&63]+W[t<<2&63]+"="),n.join("")};for(var W=[],w=[],G="undefined"!=typeof Uint8Array?Uint8Array:Array,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=0,U=I.length;D<U;++D)W[D]=I[D],w[I.charCodeAt(D)]=D;// Support decoding URL-safe base64 strings, as Node.js does.
// See: https://en.wikipedia.org/wiki/Base64#URL_applications
w["-".charCodeAt(0)]=62,w["_".charCodeAt(0)]=63,s=function(e,t,r,i,n){var s,a,o=8*n-i-1,h=(1<<o)-1,c=h>>1,u=-7,l=r?n-1:0,m=r?-1:1,f=e[t+l];for(l+=m,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+e[t+l],l+=m,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=i;u>0;a=256*a+e[t+l],l+=m,u-=8);if(0===s)s=1-c;else{if(s===h)return a?NaN:(f?-1:1)*(1/0);a+=Math.pow(2,i),s-=c}return(f?-1:1)*a*Math.pow(2,s-i)},a=function(e,t,r,i,n,s){var a,o,h,c=8*s-n-1,u=(1<<c)-1,l=u>>1,m=23===n?5960464477539062e-23:0,f=i?0:s-1,g=i?1:-1,y=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+l>=1?t+=m/h:t+=m*Math.pow(2,1-l),t*h>=2&&(a++,h/=2),a+l>=u?(o=0,a=u):a+l>=1?(o=(t*h-1)*Math.pow(2,n),a+=l):(o=t*Math.pow(2,l-1)*Math.pow(2,n),a=0));n>=8;e[r+f]=255&o,f+=g,o/=256,n-=8);for(a=a<<n|o,c+=n;c>0;e[r+f]=255&a,f+=g,a/=256,c-=8);e[r+f-g]|=128*y};const Z="function"==typeof Symbol&&"function"// eslint-disable-line dot-notation
==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom")// eslint-disable-line dot-notation
:null;function x(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');// Return an augmented `Uint8Array` instance
let t=new Uint8Array(e);return Object.setPrototypeOf(t,q.prototype),t}/**
 * The Buffer constructor returns instances of `Uint8Array` that have their
 * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
 * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
 * and the `Uint8Array` methods. Square bracket notation works as expected -- it
 * returns a single octet.
 *
 * The `Uint8Array` prototype remains unmodified.
 */function q(e,t,r){// Common case.
if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return N(e)}return V(e,t,r)}function V(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!q.isEncoding(t))throw TypeError("Unknown encoding: "+t);let r=0|_(e,t),i=x(r),n=i.write(e,t);return n!==r&&// cause everything after the first invalid character to be ignored. (e.g.
// 'abxxcd' will be treated as 'ab')
(i=i.slice(0,n)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(ed(e,Uint8Array)){let t=new Uint8Array(e);return Y(t.buffer,t.byteOffset,t.byteLength)}return z(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(ed(e,ArrayBuffer)||e&&ed(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(ed(e,SharedArrayBuffer)||e&&ed(e.buffer,SharedArrayBuffer)))return Y(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return q.from(i,t,r);let n=function(e){var t;if(q.isBuffer(e)){let t=0|X(e.length),r=x(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t// eslint-disable-line no-self-compare
?x(0):z(e):"Buffer"===e.type&&Array.isArray(e.data)?z(e.data):void 0}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return q.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function J(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function N(e){return J(e),x(e<0?0:0|X(e))}function z(e){let t=e.length<0?0:0|X(e.length),r=x(t);for(let i=0;i<t;i+=1)r[i]=255&e[i];return r}function Y(e,t,r){let i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return(// Return an augmented `Uint8Array` instance
Object.setPrototypeOf(i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),q.prototype),i)}function X(e){// Note: cannot use `length < K_MAX_LENGTH` here because that fails when
// length is NaN (which is otherwise coerced to zero.)
if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function _(e,t){if(q.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||ed(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;// Use a for loop to avoid recursion
let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return ey(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return eC(e).length;default:if(n)return i?-1:ey(e).length// assume utf8
;t=(""+t).toLowerCase(),n=!0}}function Q(e,t,r){let i=!1;// Return early if start > this.length. Done here to prevent potential uint32
// coercion fail below.
if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||// Force coercion to uint32. This will also coerce falsey/NaN values to 0.
(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){let i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=t;i<r;++i)n+=eB[e[i]];return n}(this,t,r);case"utf8":case"utf-8":return ee(this,t,r);case"ascii":return function(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}(this,t,r);case"latin1":case"binary":return function(e,t,r){let i="";r=Math.min(e.length,r);for(let n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}(this,t,r);case"base64":var s,a;return s=t,a=r,0===s&&a===this.length?n(this):n(this.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){let i=e.slice(t,r),n="";// If bytes.length is odd, the last 8 bits must be ignored (same as node.js)
for(let e=0;e<i.length-1;e+=2)n+=String.fromCharCode(i[e]+256*i[e+1]);return n}(this,t,r);default:if(i)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function K(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
// OR the last index of `val` in `buffer` at offset <= `byteOffset`.
//
// Arguments:
// - buffer - a Buffer to search
// - val - a string, Buffer, or number
// - byteOffset - an index into `buffer`; will be clamped to an int32
// - encoding - an optional encoding, relevant is val is a string
// - dir - true for indexOf, false for lastIndexOf
function $(e,t,r,i,n){var s;// Empty buffer means no match
if(0===e.length)return -1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(s=r=+r// Coerce to Number.
)!=s&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return -1;r=e.length-1}else if(r<0){if(!n)return -1;r=0}// Finally, search either indexOf (if dir is true) or lastIndexOf
if("string"==typeof t&&(t=q.from(t,i)),q.isBuffer(t))return(// Special case: looking for empty string/buffer always fails
0===t.length?-1:j(e,t,r,i,n));if("number"==typeof t)return(t&=255// Search for a byte value [0-255]
,"function"==typeof Uint8Array.prototype.indexOf)?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):j(e,[t],r,i,n);throw TypeError("val must be string, number or Buffer")}function j(e,t,r,i,n){let s,a=1,o=e.length,h=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;a=2,o/=2,h/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){let i=-1;for(s=r;s<o;s++)if(c(e,s)===c(t,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===h)return i*a}else -1!==i&&(s-=s-i),i=-1}else for(r+h>o&&(r=o-h),s=r;s>=0;s--){let r=!0;for(let i=0;i<h;i++)if(c(e,s+i)!==c(t,i)){r=!1;break}if(r)return s}return -1}function ee(e,t,r){r=Math.min(e.length,r);let i=[],n=t;for(;n<r;){let t=e[n],s=null,a=t>239?4:t>223?3:t>191?2:1;if(n+a<=r){let r,i,o,h;switch(a){case 1:t<128&&(s=t);break;case 2:(192&(r=e[n+1]))==128&&(h=(31&t)<<6|63&r)>127&&(s=h);break;case 3:r=e[n+1],i=e[n+2],(192&r)==128&&(192&i)==128&&(h=(15&t)<<12|(63&r)<<6|63&i)>2047&&(h<55296||h>57343)&&(s=h);break;case 4:r=e[n+1],i=e[n+2],o=e[n+3],(192&r)==128&&(192&i)==128&&(192&o)==128&&(h=(15&t)<<18|(63&r)<<12|(63&i)<<6|63&o)>65535&&h<1114112&&(s=h)}}null===s?(// we did not generate a valid codePoint so insert a
// replacement char (U+FFFD) and advance only 1 byte
s=65533,a=1):s>65535&&(// encode to utf16 (surrogate pair dance)
s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),n+=a}return function(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e)// avoid extra slice()
;// Decode in chunks to avoid "call stack size exceeded".
let r="",i=0;for(;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return r}(i)}/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */function et(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function er(e,t,r,i,n,s){if(!q.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw RangeError('"value" argument is out of bounds');if(r+i>e.length)throw RangeError("Index out of range")}function ei(e,t,r,i,n){el(t,i,n,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,r}function en(e,t,r,i,n){el(t,i,n,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=a,a>>=8,e[r+2]=a,a>>=8,e[r+1]=a,a>>=8,e[r]=a,r+8}function es(e,t,r,i,n,s){if(r+i>e.length||r<0)throw RangeError("Index out of range")}function ea(e,t,r,i,n){return t=+t,r>>>=0,n||es(e,t,r,4,34028234663852886e22,-34028234663852886e22),a(e,t,r,i,23,4),r+4}function eo(e,t,r,i,n){return t=+t,r>>>=0,n||es(e,t,r,8,17976931348623157e292,-17976931348623157e292),a(e,t,r,i,52,8),r+8}/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Print warning and recommend using `buffer` v4.x which has an Object
 *               implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * We report that the browser does not support typed arrays if the are not subclassable
 * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`
 * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support
 * for __proto__ and has a buggy typed array implementation.
 */q.TYPED_ARRAY_SUPPORT=function(){// Can typed array instances can be augmented?
try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),q.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(q.prototype,"parent",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.buffer}}),Object.defineProperty(q.prototype,"offset",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.byteOffset}}),q.poolSize=8192// not used by this implementation
,/**
 * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
 * if value is a number.
 * Buffer.from(str[, encoding])
 * Buffer.from(array)
 * Buffer.from(buffer)
 * Buffer.from(arrayBuffer[, byteOffset[, length]])
 **/q.from=function(e,t,r){return V(e,t,r)},// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:
// https://github.com/feross/buffer/pull/148
Object.setPrototypeOf(q.prototype,Uint8Array.prototype),Object.setPrototypeOf(q,Uint8Array),/**
 * Creates a new filled Buffer instance.
 * alloc(size[, fill[, encoding]])
 **/q.alloc=function(e,t,r){return(J(e),e<=0)?x(e):void 0!==t?"string"==typeof r?x(e).fill(t,r):x(e).fill(t):x(e)},/**
 * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
 * */q.allocUnsafe=function(e){return N(e)},/**
 * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
 */q.allocUnsafeSlow=function(e){return N(e)},q.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==q.prototype// so Buffer.isBuffer(Buffer.prototype) will be false
},q.compare=function(e,t){if(ed(e,Uint8Array)&&(e=q.from(e,e.offset,e.byteLength)),ed(t,Uint8Array)&&(t=q.from(t,t.offset,t.byteLength)),!q.isBuffer(e)||!q.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,i=t.length;for(let n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},q.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},q.concat=function(e,t){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return q.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;let i=q.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){let t=e[r];if(ed(t,Uint8Array))n+t.length>i.length?(q.isBuffer(t)||(t=q.from(t)),t.copy(i,n)):Uint8Array.prototype.set.call(i,t,n);else if(q.isBuffer(t))t.copy(i,n);else throw TypeError('"list" argument must be an Array of Buffers');n+=t.length}return i},q.byteLength=_,// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)
// to detect a Buffer instance. It's not possible to use `instanceof Buffer`
// reliably in a browserify context because there could be multiple different
// copies of the 'buffer' package in use. This method works even for Buffer
// instances that were created from another copy of the `buffer` package.
// See: https://github.com/feross/buffer/issues/154
q.prototype._isBuffer=!0,q.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)K(this,t,t+1);return this},q.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)K(this,t,t+3),K(this,t+1,t+2);return this},q.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)K(this,t,t+7),K(this,t+1,t+6),K(this,t+2,t+5),K(this,t+3,t+4);return this},q.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?ee(this,0,e):Q.apply(this,arguments)},q.prototype.toLocaleString=q.prototype.toString,q.prototype.equals=function(e){if(!q.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===q.compare(this,e)},q.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},Z&&(q.prototype[Z]=q.prototype.inspect),q.prototype.compare=function(e,t,r,i,n){if(ed(e,Uint8Array)&&(e=q.from(e,e.offset,e.byteLength)),!q.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,n>>>=0,this===e)return 0;let s=n-i,a=r-t,o=Math.min(s,a),h=this.slice(i,n),c=e.slice(t,r);for(let e=0;e<o;++e)if(h[e]!==c[e]){s=h[e],a=c[e];break}return s<a?-1:a<s?1:0},q.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},q.prototype.indexOf=function(e,t,r){return $(this,e,t,r,!0)},q.prototype.lastIndexOf=function(e,t,r){return $(this,e,t,r,!1)},q.prototype.write=function(e,t,r,i){var n,s,a,o,h,c,u,l;// Buffer#write(string)
if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let m=this.length-t;if((void 0===r||r>m)&&(r=m),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let f=!1;for(;;)switch(i){case"hex":return function(e,t,r,i){let n;r=Number(r)||0;let s=e.length-r;i?(i=Number(i))>s&&(i=s):i=s;let a=t.length;for(i>a/2&&(i=a/2),n=0;n<i;++n){let i=parseInt(t.substr(2*n,2),16);if(i!=i)break;e[r+n]=i}return n}(this,e,t,r);case"utf8":case"utf-8":return n=t,s=r,ep(ey(e,this.length-n),this,n,s);case"ascii":case"latin1":case"binary":return a=t,o=r,ep(function(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,a,o);case"base64":// Warning: maxLength not taken into account in base64Write
return h=t,c=r,ep(eC(e),this,h,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,l=r,ep(function(e,t){let r,i;let n=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n.push(r%256),n.push(i);return n}(e,this.length-u),this,u,l);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},q.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},q.prototype.slice=function(e,t){let r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let i=this.subarray(e,t);return(// Return an augmented `Uint8Array` instance
Object.setPrototypeOf(i,q.prototype),i)},q.prototype.readUintLE=q.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||et(e,t,this.length);let i=this[e],n=1,s=0;for(;++s<t&&(n*=256);)i+=this[e+s]*n;return i},q.prototype.readUintBE=q.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||et(e,t,this.length);let i=this[e+--t],n=1;for(;t>0&&(n*=256);)i+=this[e+--t]*n;return i},q.prototype.readUint8=q.prototype.readUInt8=function(e,t){return e>>>=0,t||et(e,1,this.length),this[e]},q.prototype.readUint16LE=q.prototype.readUInt16LE=function(e,t){return e>>>=0,t||et(e,2,this.length),this[e]|this[e+1]<<8},q.prototype.readUint16BE=q.prototype.readUInt16BE=function(e,t){return e>>>=0,t||et(e,2,this.length),this[e]<<8|this[e+1]},q.prototype.readUint32LE=q.prototype.readUInt32LE=function(e,t){return e>>>=0,t||et(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},q.prototype.readUint32BE=q.prototype.readUInt32BE=function(e,t){return e>>>=0,t||et(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},q.prototype.readBigUInt64LE=eR(function(e){em(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&ef(e,this.length-8);let i=t+256*this[++e]+65536*this[++e]+16777216*this[++e],n=this[++e]+256*this[++e]+65536*this[++e]+16777216*r;return BigInt(i)+(BigInt(n)<<BigInt(32))}),q.prototype.readBigUInt64BE=eR(function(e){em(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&ef(e,this.length-8);let i=16777216*t+65536*this[++e]+256*this[++e]+this[++e],n=16777216*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)}),q.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||et(e,t,this.length);let i=this[e],n=1,s=0;for(;++s<t&&(n*=256);)i+=this[e+s]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},q.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||et(e,t,this.length);let i=t,n=1,s=this[e+--i];for(;i>0&&(n*=256);)s+=this[e+--i]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},q.prototype.readInt8=function(e,t){return(e>>>=0,t||et(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},q.prototype.readInt16LE=function(e,t){e>>>=0,t||et(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},q.prototype.readInt16BE=function(e,t){e>>>=0,t||et(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},q.prototype.readInt32LE=function(e,t){return e>>>=0,t||et(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},q.prototype.readInt32BE=function(e,t){return e>>>=0,t||et(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},q.prototype.readBigInt64LE=eR(function(e){em(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&ef(e,this.length-8);let i=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24// Overflow
);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+16777216*this[++e])}),q.prototype.readBigInt64BE=eR(function(e){em(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&ef(e,this.length-8);let i=(t<<24)+// Overflow
65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(16777216*this[++e]+65536*this[++e]+256*this[++e]+r)}),q.prototype.readFloatLE=function(e,t){return e>>>=0,t||et(e,4,this.length),s(this,e,!0,23,4)},q.prototype.readFloatBE=function(e,t){return e>>>=0,t||et(e,4,this.length),s(this,e,!1,23,4)},q.prototype.readDoubleLE=function(e,t){return e>>>=0,t||et(e,8,this.length),s(this,e,!0,52,8)},q.prototype.readDoubleBE=function(e,t){return e>>>=0,t||et(e,8,this.length),s(this,e,!1,52,8)},q.prototype.writeUintLE=q.prototype.writeUIntLE=function(e,t,r,i){if(e=+e,t>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;er(this,e,t,r,i,0)}let n=1,s=0;for(this[t]=255&e;++s<r&&(n*=256);)this[t+s]=e/n&255;return t+r},q.prototype.writeUintBE=q.prototype.writeUIntBE=function(e,t,r,i){if(e=+e,t>>>=0,r>>>=0,!i){let i=Math.pow(2,8*r)-1;er(this,e,t,r,i,0)}let n=r-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+r},q.prototype.writeUint8=q.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,1,255,0),this[t]=255&e,t+1},q.prototype.writeUint16LE=q.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},q.prototype.writeUint16BE=q.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},q.prototype.writeUint32LE=q.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},q.prototype.writeUint32BE=q.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},q.prototype.writeBigUInt64LE=eR(function(e,t=0){return ei(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),q.prototype.writeBigUInt64BE=eR(function(e,t=0){return en(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),q.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*r-1);er(this,e,t,r,i-1,-i)}let n=0,s=1,a=0;for(this[t]=255&e;++n<r&&(s*=256);)e<0&&0===a&&0!==this[t+n-1]&&(a=1),this[t+n]=(e/s>>0)-a&255;return t+r},q.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*r-1);er(this,e,t,r,i-1,-i)}let n=r-1,s=1,a=0;for(this[t+n]=255&e;--n>=0&&(s*=256);)e<0&&0===a&&0!==this[t+n+1]&&(a=1),this[t+n]=(e/s>>0)-a&255;return t+r},q.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},q.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},q.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},q.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},q.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||er(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},q.prototype.writeBigInt64LE=eR(function(e,t=0){return ei(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),q.prototype.writeBigInt64BE=eR(function(e,t=0){return en(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),q.prototype.writeFloatLE=function(e,t,r){return ea(this,e,t,!0,r)},q.prototype.writeFloatBE=function(e,t,r){return ea(this,e,t,!1,r)},q.prototype.writeDoubleLE=function(e,t,r){return eo(this,e,t,!0,r)},q.prototype.writeDoubleBE=function(e,t,r){return eo(this,e,t,!1,r)},// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
q.prototype.copy=function(e,t,r,i){if(!q.isBuffer(e))throw TypeError("argument should be a Buffer");// Copy 0 bytes; we're done
if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||0===e.length||0===this.length)return 0;// Fatal error conditions
if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);let n=i-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,i):Uint8Array.prototype.set.call(e,this.subarray(r,i),t),n},// Usage:
//    buffer.fill(number[, offset[, end]])
//    buffer.fill(buffer[, offset[, end]])
//    buffer.fill(string[, offset[, end]][, encoding])
q.prototype.fill=function(e,t,r,i){let n;// Handle string cases:
if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!q.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){let t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));// Invalid ranges are not set to a default, so can range check early.
if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(n=t;n<r;++n)this[n]=e;else{let s=q.isBuffer(e)?e:q.from(e,i),a=s.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=s[n%a]}return this};// CUSTOM ERRORS
// =============
// Simplified versions from Node, changed for Buffer-only usage
const eh={};function ec(e,t,r){eh[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),// Add the error code to the name to include it in the stack trace.
this.name=`${this.name} [${e}]`,// Access the stack to generate the error message including the error code
// from the name.
this.stack// eslint-disable-line no-unused-expressions
,// Reset the name to the actual name.
delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function eu(e){let t="",r=e.length,i="-"===e[0]?1:0;for(;r>=i+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function el(e,t,r,i,n,s){if(e>r||e<t){let i;let n="bigint"==typeof t?"n":"";throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${(s+1)*8}${n}`:`>= -(2${n} ** ${(s+1)*8-1}${n}) and < 2 ** ${(s+1)*8-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new eh.ERR_OUT_OF_RANGE("value",i,e)}em(n,"offset"),(void 0===i[n]||void 0===i[n+s])&&ef(n,i.length-(s+1))}function em(e,t){if("number"!=typeof e)throw new eh.ERR_INVALID_ARG_TYPE(t,"number",e)}function ef(e,t,r){if(Math.floor(e)!==e)throw em(e,r),new eh.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new eh.ERR_BUFFER_OUT_OF_BOUNDS;throw new eh.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}ec("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ec("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),ec("ERR_OUT_OF_RANGE",function(e,t,r){let i=`The value of "${e}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?n=eu(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=eu(n)),n+="n"),i+=` It must be ${t}. Received ${n}`},RangeError);// HELPER FUNCTIONS
// ================
const eg=/[^+/0-9A-Za-z-_]/g;function ey(e,t){let r;t=t||1/0;let i=e.length,n=null,s=[];for(let a=0;a<i;++a){// is surrogate component
if((r=e.charCodeAt(a))>55295&&r<57344){// last char was a lead
if(!n){// no lead yet
if(r>56319||a+1===i){// unexpected trail
(t-=3)>-1&&s.push(239,191,189);continue}// valid lead
n=r;continue}// 2 leads in a row
if(r<56320){(t-=3)>-1&&s.push(239,191,189),n=r;continue}// valid surrogate pair
r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&s.push(239,191,189);// encode utf8
if(n=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function eC(e){return function(e){var t,r,i=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");// Trim off extra bytes after placeholder bytes are found
// See: https://github.com/beatgammit/base64-js/issues/42
var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}(e),n=i[0],s=i[1],a=new G((n+s)*3/4-s),o=0,h=s>0?n-4:n;for(r=0;r<h;r+=4)t=w[e.charCodeAt(r)]<<18|w[e.charCodeAt(r+1)]<<12|w[e.charCodeAt(r+2)]<<6|w[e.charCodeAt(r+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=w[e.charCodeAt(r)]<<2|w[e.charCodeAt(r+1)]>>4,a[o++]=255&t),1===s&&(t=w[e.charCodeAt(r)]<<10|w[e.charCodeAt(r+1)]<<4|w[e.charCodeAt(r+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a}(function(e){// Node converts strings with length < 2 to ''
if(// Node strips out invalid characters like \n and \t from the string, base64-js does not
(e=// Node takes equal signs as end of the Base64 encoding
(e=e.split("=")[0]).trim().replace(eg,"")).length<2)return"";// Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
for(;e.length%4!=0;)e+="=";return e}(e))}function ep(e,t,r,i){let n;for(n=0;n<i&&!(n+r>=t.length)&&!(n>=e.length);++n)t[n+r]=e[n];return n}// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass
// the `instanceof` check but they should be treated as of that type.
// See: https://github.com/feross/buffer/issues/166
function ed(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}// Create lookup table for `toString('hex')`
// See: https://github.com/feross/buffer/issues/219
const eB=function(){let e="0123456789abcdef",t=Array(256);for(let r=0;r<16;++r){let i=16*r;for(let n=0;n<16;++n)t[i+n]=e[r]+e[n]}return t}();// Return not function with Error if BigInt not supported
function eR(e){return"undefined"==typeof BigInt?eF:e}function eF(){throw Error("BigInt not supported")}const eS=new E.WebSocketServer({port:6969}),eT=[{A:/*@__PURE__*/e(f).KEYMAP.A},{B:/*@__PURE__*/e(f).KEYMAP.B},{R:/*@__PURE__*/e(f).KEYMAP.RIGHT},{L:/*@__PURE__*/e(f).KEYMAP.LEFT},{U:/*@__PURE__*/e(f).KEYMAP.DOWN},{D:/*@__PURE__*/e(f).KEYMAP.UP},{SL:/*@__PURE__*/e(f).KEYMAP.SELECT},{ST:/*@__PURE__*/e(f).KEYMAP.START}],eH=["pokemon_emerald.gba","pokemon_crystal.gbc","doom_2.gba"];eS.on("connection",async function(t){var r=!1;let i=new/*@__PURE__*/(e(f));var n=setInterval(()=>{r&&i.doFrame()},1e3/120),s=setInterval(()=>{if(r){var e=i.getScreen(),n="scrn"+q.from(e,"ascii");t.send(n)}},1e3/30);t.on("message",e=>{var n=e.toString();if(n.length<4)i.pressKey(eT[n]);else switch(n.substring(0,3)){case"save":var s="save"+i.getSaveData();t.send(s);break;case"load":var a=n.split("|");(function(e,t,r){t=t<0?0:t>=eH.length?eH.length-1:t;var i=`./roms/${eH[t]}`;let n=m.readFileSync(i);r?e.loadRom(n,r):e.loadRom(n)})(i,Number.parseInt(a[1]),a[2]),r=!0}}),t.on("close",async function(){clearInterval(s),clearInterval(n)})});//# sourceMappingURL=index.44f191b0.js.map

//# sourceMappingURL=index.44f191b0.js.map
